<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN""http://www.w3.org/TR/html4/loose.dtd">
<HTML
><HEAD
><TITLE
>物理タイマ機能</TITLE
><META
NAME="GENERATOR"
CONTENT="Modular DocBook HTML Stylesheet Version 1.79"><LINK
REL="HOME"
TITLE="μT-Kernel 3.0仕様書"
HREF="index.html"><LINK
REL="UP"
TITLE="μT-Kernel/SMの機能"
HREF="utk_sm_functions.html"><LINK
REL="PREVIOUS"
TITLE="メモリキャッシュ制御機能"
HREF="memory_cache_control_functions.html"><LINK
REL="NEXT"
TITLE="ユーティリティ機能"
HREF="utility_functions.html"></HEAD
><BODY
CLASS="section"
BGCOLOR="#FFFFFF"
TEXT="#000000"
LINK="#0000FF"
VLINK="#840084"
ALINK="#0000FF"
><DIV
CLASS="NAVHEADER"
><TABLE
SUMMARY="Header navigation table"
WIDTH="100%"
BORDER="0"
CELLPADDING="0"
CELLSPACING="0"
><TR
><TH
COLSPAN="3"
ALIGN="center"
>μT-Kernel 3.0仕様書</TH
></TR
><TR
><TD
WIDTH="10%"
ALIGN="left"
VALIGN="bottom"
><A
HREF="memory_cache_control_functions.html"
ACCESSKEY="P"
>前のページ</A
></TD
><TD
WIDTH="80%"
ALIGN="center"
VALIGN="bottom"
>μT-Kernel/SMの機能</TD
><TD
WIDTH="10%"
ALIGN="right"
VALIGN="bottom"
><A
HREF="utility_functions.html"
ACCESSKEY="N"
>次のページ</A
></TD
></TR
></TABLE
><HR
ALIGN="LEFT"
WIDTH="100%"></DIV
><DIV
CLASS="section"
><H1
CLASS="section"
><A
NAME="physical_timer_functions"
>物理タイマ機能</A
></H1
><P
>物理タイマ機能は、複数のハードウェアタイマが使えるシステムにおいて、タイマ割込み間隔(<TT
CLASS="literal"
>TTimPeriod</TT
>)よりも細かい単位の時間経過を条件とした処理を行う場合に有効な機能である。</P
><P
>物理タイマとは、一定の時間間隔で、0から1つずつカウント値が単調増加していくハードウェアのカウンタである。カウント値が、物理タイマごとに指定された特定の値(上限値)に達すると、物理タイマ毎に指定されたハンドラ(物理タイマハンドラ)を起動するとともに、カウント値が0に戻る。</P
><P
>システムで利用可能なハードウェアタイマの数に応じて、複数個の物理タイマが利用できる。利用可能な物理タイマの個数は実装依存である。通常のμT-Kernelの実装では、時間管理機能を実現するためにハードウェアタイマを1つ使用するので、残りのハードウェアタイマを物理タイマ機能で使用することを想定している。</P
><P
>物理タイマ番号としては、1, 2, ...のように正の整数を小さい方から使う。たとえば、4個のハードウェアタイマがある場合、このうちの1個はμT-Kernelの時間管理機能で使うため、残り3個の物理タイマが利用でき、物理タイマ番号は1, 2, 3となる。</P
><P
>μT-Kernel/SMの物理タイマ機能において、個々の物理タイマと、それを使用するタスク等との対応を管理することはない。複数のタスク等が1つの物理タイマを共用したい場合は、アプリケーション側で排他制御などの調整を行う必要がある。</P
><DIV
CLASS="note"
><P
></P
><TABLE
CLASS="note"
WIDTH="100%"
BORDER="0"
><TR
><TD
WIDTH="25"
ALIGN="CENTER"
VALIGN="TOP"
><IMG
SRC="../images/note.gif"
HSPACE="5"
ALT="注意"></TD
><TH
ALIGN="LEFT"
VALIGN="MIDDLE"
><B
>補足事項</B
></TH
></TR
><TR
><TD
>&nbsp;</TD
><TD
ALIGN="LEFT"
VALIGN="TOP"
><P
>μT-Kernelの時間管理機能では、<A
HREF="system_configuration_information_management_functions.html#standard_system_configuration_information"
><I
>標準システム構成情報</I
>項</A
>の「タイマ割込み間隔」(<TT
CLASS="literal"
>TTimPeriod</TT
>)で指定された時間間隔で起動されるハンドラの中で、カーネルがアラームハンドラや周期ハンドラの起動、タイムアウトの処理など、複数の要求に対する処理を行っている。これに対して、物理タイマ機能は、ハードウェアタイマの設定、カウント値の読み出し、割込み発生といったプリミティブな機能を標準化して提供するだけのものであり、時間管理機能のように複数の要求を処理するわけではない。こういった点から、従来の時間管理機能よりも抽象度が低く、ハードウェアの階層に近い機能であるという意味で、「物理タイマ(Physical Timer)」の名称とした。</P
><P
>上記のような位置付けから、物理タイマ機能はできるだけシンプルで最小限の仕様とし、オーバーヘッドの少ないライブラリ関数で実現することを想定している。動的なID番号ではなく静的に固定された物理タイマ番号を使う仕様や、要求元タスクとの対応の管理や複数タスクからの要求の調整を一切行わないといった仕様も、この方針を反映したものである。</P
><P
>物理タイマの関数は、タイマ(カウンタ)というデバイスを操作するためのAPIを標準化したものである。ただし、タイマというデバイスでは、細かい時間経過に応じて割込みハンドラを呼び出すなど、時間関連の動作に直接関わる部分が多く、この点で他のデバイス(ストレージや通信など)よりもカーネルとの結び付きが強い。こういった理由から、タイマについては、デバイスドライバの仕様として標準化するのではなく、μT-Kernel/SMの一部として仕様を標準化し、より汎用性の高い機能として提供する。</P
><P
>物理タイマ機能はμT-Kernel/SMの機能なので、μT-Kernel/SMの<A
HREF="utk_sm_functions.html"
>【全般的な注意・補足事項】</A
>が適用される。</P
><P
>物理タイマとして利用するハードウェアタイマは、32ビット以下を想定している。そのため、カウント値や上限値を表すデータタイプは32ビットのUWを使っている。将来、64ビットの関数を追加することは可能である。</P
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="section"
><H2
CLASS="section"
><A
NAME="use_case_of_physical_timer"
>物理タイマのユースケース</A
></H2
><P
>物理タイマ機能の有効性が高い例を以下に示す。</P
><P
></P
><DIV
CLASS="variablelist"
><DL
><DT
>(a)実現すべき処理の例</DT
><DD
><P
>2500マイクロ秒毎に行うべき周期的な処理Xと、1800マイクロ秒毎に行うべき周期的な処理Yがあるとする。これを、物理タイマで効率よく実現する。</P
></DD
><DT
>(b)物理タイマ機能を使った実現方法</DT
><DD
><P
>2つの物理タイマを使い、その一方は、ちょうど2500マイクロ秒毎に物理タイマハンドラが起動されるように設定する。</P
><P
>たとえば、物理タイマのクロック周波数が10MHzであれば、1クロックが0.1マイクロ秒(＝100ナノ秒)なので、物理タイマの上限値(<CODE
CLASS="varname"
>limit</CODE
>)として24999(＝25000-1)を設定し、カウント値が24999から0になる時に物理タイマハンドラが起動されるようにする。</P
><P
>周期的に繰り返す処理なので、<A
HREF="physical_timer_functions.html#StartPhysicalTimer"
>StartPhysicalTimer</A
> の <CODE
CLASS="varname"
>mode</CODE
> では <TT
CLASS="literal"
>TA_CYC_PTMR</TT
> を指定する。</P
><P
>この物理タイマハンドラの中で処理Xを行う。</P
><P
>これと同様に、もう一方の物理タイマを使って、ちょうど1800マイクロ秒毎に起動される物理タイマハンドラを設定し、この中で処理Yを行う。</P
><P
>μT-Kernelの時間管理機能が使うタイマ割込み間隔(<TT
CLASS="literal"
>TTimPeriod</TT
>)は、物理タイマ機能とは無関係なので、デフォルト値(10ミリ秒)のままでよい。</P
></DD
><DT
>(c)物理タイマ機能を使わない実現方法</DT
><DD
><P
>物理タイマハンドラの代わりに、マイクロ秒が指定可能なμT-Kernel 3.0のシステムコール(<A
HREF="time_management_functions.html#tk_cre_cyc_u"
>tk_cre_cyc_u</A
>)を使って、2500マイクロ秒毎に起動される周期ハンドラを定義し、その中で処理Xを行う。また、1800マイクロ秒毎に起動される周期ハンドラを定義し、その中で処理Yを行う。</P
><P
>しかし、この場合には、2500マイクロ秒毎および1800マイクロ秒毎という時間がいずれも正確に処理されるように、μT-Kernelの時間管理機能が使うタイマ割込み間隔を十分に短く設定する必要がある。具体的には、2500マイクロ秒と1800マイクロ秒の公約数である100マイクロ秒のタイマ割込み間隔とすることにより、2500マイクロ秒毎の処理も、1800マイクロ秒毎の処理も、ほぼ正確な時間間隔で実現できる。</P
></DD
></DL
></DIV
><P
>物理タイマ機能を使った(b)の方法であれば、μT-Kernelの時間管理機能は使わないので、タイマ割込み間隔はデフォルト(10ミリ秒毎)のままでよい。このほかに、物理タイマによる割込みが2500マイクロ秒毎および1500マイクロ秒毎に入り、その中から呼ばれる物理タイマハンドラの中で処理Xや処理Yを行うことになるが、これら以外に時間に関係した無駄な割込みが入ることはない。</P
><P
>一方、物理タイマ機能を使わない(c)の方法では、タイマ割込み間隔を短くする必要があるため、タイマ割込みの回数が増え、その分のオーバーヘッドが増加する。たとえば、10ミリ秒の間に入ってくる時間関係の割込みの回数で比較すると、(b)では時間管理機能のためのタイマ割込みが1回(＝10ミリ秒÷10ミリ秒)、処理Xのための物理タイマの割込みが4回(＝10ミリ秒÷2500マイクロ秒)、処理Yのための物理タイマの割込みが6回(＝10ミリ秒÷1500マイクロ秒)、合計11回であるのに対し、(c)では時間管理機能のためのタイマ割込みが100回(＝10ミリ秒÷100マイクロ秒)となる。時間の正確さとのトレードオフになるが、処理Xと処理Yの周期や位相の差によっては、タイマ割込み間隔をさらに短くする必要があり、もっと大きなオーバーヘッドを生じる可能性もある。このようなケースにおいて、物理タイマ機能の有効性が高い。</P
><P
>ただし、物理タイマ機能が有効なのは、時間に依存した処理の数が少なくて静的に決まっており、それに対して十分な数のハードウェアタイマが存在する場合である。物理タイマ機能は、文字通り、物理的なハードウェア資源の制約を受ける機能なので、ハードウェアタイマが少なければ、物理タイマ機能が十分に使えない。また、時間に依存した処理が動的に増えてくるようなケースには対応しにくい。そのようなケースでは、周期ハンドラやアラームハンドラなど従来の時間管理機能を使う方が、柔軟な対応が可能である。</P
><P
>マイクロ秒単位の時間管理機能と、物理タイマの機能は、用途の重複する面もあるが、上記のように特性の異なる面もあるため、ハードウェア構成やアプリケーションに応じて適切な方を利用できるとよい。物理タイマの機能は、このような理由で追加されたものである。</P
></DIV
><DIV
CLASS="section"
><H2
CLASS="section"
><A
NAME="StartPhysicalTimer"
>StartPhysicalTimer - 物理タイマの動作開始</A
></H2
><DIV
CLASS="section"
><H3
CLASS="section"
><A
NAME="AEN26273"
>C言語インタフェース</A
></H3
><DIV
CLASS="funcsynopsis"
><P
></P
><A
NAME="AEN26275"
></A
><PRE
CLASS="funcsynopsisinfo"
>#include &#60;tk/tkernel.h&#62;</PRE
><P
><CODE
><CODE
CLASS="FUNCDEF"
>ER ercd = StartPhysicalTimer</CODE
>(UINT ptmrno, UW limit, UINT mode);</CODE
></P
><P
></P
></DIV
></DIV
><DIV
CLASS="section"
><H3
CLASS="section"
><A
NAME="AEN26286"
>パラメータ</A
></H3
><DIV
CLASS="informaltable"
><P
></P
><A
NAME="AEN26288"
></A
><TABLE
BORDER="0"
FRAME="void"
RULES="none"
WIDTH="100%"
CLASS="CALSTABLE"
><COL
WIDTH="8%"><COL
WIDTH="17%"><COL
WIDTH="33%"><COL
WIDTH="42%"><TBODY
VALIGN="top"
><TR
><TD
>UINT</TD
><TD
>&#13;                <CODE
CLASS="varname"
>ptmrno</CODE
>
              </TD
><TD
>Physical Timer Number</TD
><TD
>物理タイマ番号</TD
></TR
><TR
><TD
>UW</TD
><TD
>&#13;                <CODE
CLASS="varname"
>limit</CODE
>
              </TD
><TD
>Limit</TD
><TD
>上限値</TD
></TR
><TR
><TD
>UINT</TD
><TD
>&#13;                <CODE
CLASS="varname"
>mode</CODE
>
              </TD
><TD
>Mode</TD
><TD
>動作モード</TD
></TR
></TBODY
></TABLE
><P
></P
></DIV
></DIV
><DIV
CLASS="section"
><H3
CLASS="section"
><A
NAME="AEN26313"
>リターンパラメータ</A
></H3
><DIV
CLASS="informaltable"
><P
></P
><A
NAME="AEN26315"
></A
><TABLE
BORDER="0"
FRAME="void"
RULES="none"
WIDTH="100%"
CLASS="CALSTABLE"
><COL
WIDTH="8%"
TITLE="c1"><COL
WIDTH="17%"
TITLE="c2"><COL
WIDTH="33%"
TITLE="c3"><COL
WIDTH="42%"
TITLE="c4"><TBODY
VALIGN="top"
><TR
><TD
>ER</TD
><TD
>&#13;                <CODE
CLASS="varname"
>ercd</CODE
>
              </TD
><TD
>Error Code</TD
><TD
>エラーコード</TD
></TR
></TBODY
></TABLE
><P
></P
></DIV
></DIV
><DIV
CLASS="section"
><H3
CLASS="section"
><A
NAME="AEN26328"
>エラーコード</A
></H3
><DIV
CLASS="informaltable"
><P
></P
><A
NAME="AEN26330"
></A
><TABLE
BORDER="0"
FRAME="void"
RULES="none"
WIDTH="100%"
CLASS="CALSTABLE"
><COL
WIDTH="17%"
TITLE="c1"><COL
WIDTH="83%"
TITLE="c2"><TBODY
VALIGN="top"
><TR
><TD
>&#13;                <SPAN
CLASS="errorname"
>E_OK</SPAN
>
              </TD
><TD
>正常終了</TD
></TR
><TR
><TD
>&#13;                <SPAN
CLASS="errorname"
>E_PAR</SPAN
>
              </TD
><TD
>パラメータエラー(<CODE
CLASS="varname"
>ptmrno</CODE
>, <CODE
CLASS="varname"
>limit</CODE
>, <CODE
CLASS="varname"
>mode</CODE
> が不正あるいは利用できない)</TD
></TR
></TBODY
></TABLE
><P
></P
></DIV
></DIV
><DIV
CLASS="section"
><H3
CLASS="section"
><A
NAME="AEN26346"
>利用可能なコンテキスト</A
></H3
><DIV
CLASS="informaltable"
><P
></P
><A
NAME="AEN26348"
></A
><TABLE
BORDER="1"
FRAME="border"
RULES="all"
WIDTH="100%"
CLASS="CALSTABLE"
><COL
WIDTH="33%"><COL
WIDTH="33%"><COL
WIDTH="33%"><THEAD
><TR
><TH
ALIGN="center"
>タスク部</TH
><TH
ALIGN="center"
>準タスク部</TH
><TH
ALIGN="center"
>タスク独立部</TH
></TR
></THEAD
><TBODY
VALIGN="top"
><TR
><TD
ALIGN="center"
>○</TD
><TD
ALIGN="center"
>○</TD
><TD
ALIGN="center"
>×</TD
></TR
></TBODY
></TABLE
><P
></P
></DIV
></DIV
><DIV
CLASS="section"
><H3
CLASS="section"
><A
NAME="AEN26363"
>関連するサービスプロファイル</A
></H3
><P
>以下のサービスプロファイルが有効に設定されている場合に限り、本APIはサポートされる。</P
><DIV
CLASS="informaltable"
><P
></P
><A
NAME="AEN26366"
></A
><TABLE
BORDER="0"
FRAME="void"
RULES="none"
WIDTH="100%"
CLASS="CALSTABLE"
><COL
WIDTH="38%"
TITLE="c1"><COL
WIDTH="62%"><TBODY
VALIGN="top"
><TR
><TD
>&#13;                <TT
CLASS="literal"
>TK_SUPPORT_PTIMER</TT
>
              </TD
><TD
>物理タイマ機能のサポート</TD
></TR
></TBODY
></TABLE
><P
></P
></DIV
><P
>また、以下のサービスプロファイルが本APIに関係する。</P
><DIV
CLASS="informaltable"
><P
></P
><A
NAME="AEN26376"
></A
><TABLE
BORDER="0"
FRAME="void"
RULES="none"
WIDTH="100%"
CLASS="CALSTABLE"
><COL
WIDTH="38%"
TITLE="c1"><COL
WIDTH="62%"><TBODY
VALIGN="top"
><TR
><TD
>&#13;                <TT
CLASS="literal"
>TK_MAX_PTIMER</TT
>
              </TD
><TD
>最大物理タイマ番号</TD
></TR
></TBODY
></TABLE
><P
></P
></DIV
></DIV
><DIV
CLASS="section"
><H3
CLASS="section"
><A
NAME="AEN26385"
>解説</A
></H3
><P
><CODE
CLASS="varname"
>ptmrno</CODE
> で指定された物理タイマのカウント値を0とした後、カウントを開始する。本関数の実行後は、タイマのクロック周波数の逆数の時間間隔ごとに、カウント値が1ずつ増加する。</P
><P
><CODE
CLASS="varname"
>limit</CODE
> ではカウント値の上限値を指定する。カウント値が上限値に達した後、さらにクロック周波数の逆数の時間が経つと、カウント値は0に戻る。この時、この物理タイマに対する物理タイマハンドラが定義されていた場合には、そのハンドラが起動される。<A
HREF="physical_timer_functions.html#StartPhysicalTimer"
>StartPhysicalTimer</A
> の発行により物理タイマがカウントを始めてから、次にカウント値が0になるまでの時間は、(クロック周波数の逆数の時間)×(上限値＋1)である。</P
><P
><CODE
CLASS="varname"
>limit</CODE
> が0の場合は <SPAN
CLASS="errorname"
>E_PAR</SPAN
> のエラーになる。</P
><P
><CODE
CLASS="varname"
>mode</CODE
> では次の指定を行う。</P
><DIV
CLASS="informaltable"
><P
></P
><A
NAME="AEN26397"
></A
><TABLE
BORDER="0"
FRAME="void"
RULES="none"
WIDTH="100%"
CLASS="CALSTABLE"
><COL
WIDTH="14%"
TITLE="c1"><COL
WIDTH="29%"
TITLE="c2"><COL
WIDTH="57%"
TITLE="c3"><TBODY
VALIGN="top"
><TR
><TD
>&#13;                <TT
CLASS="literal"
>TA_ALM_PTMR</TT
>
              </TD
><TD
>0</TD
><TD
>カウント値が上限値から0に戻った後は、カウントを停止する。その後のカウント値は0のままとなる。</TD
></TR
><TR
><TD
>&#13;                <TT
CLASS="literal"
>TA_CYC_PTMR</TT
>
              </TD
><TD
>1</TD
><TD
>カウント値が上限値から0に戻った後も、再度カウント値の増加を続ける。したがって、カウント値は周期的な増加を繰り返す。</TD
></TR
></TBODY
></TABLE
><P
></P
></DIV
></DIV
></DIV
><DIV
CLASS="section"
><H2
CLASS="section"
><A
NAME="StopPhysicalTimer"
>StopPhysicalTimer - 物理タイマの動作停止</A
></H2
><DIV
CLASS="section"
><H3
CLASS="section"
><A
NAME="AEN26415"
>C言語インタフェース</A
></H3
><DIV
CLASS="funcsynopsis"
><P
></P
><A
NAME="AEN26417"
></A
><PRE
CLASS="funcsynopsisinfo"
>#include &#60;tk/tkernel.h&#62;</PRE
><P
><CODE
><CODE
CLASS="FUNCDEF"
>ER ercd = StopPhysicalTimer</CODE
>(UINT ptmrno);</CODE
></P
><P
></P
></DIV
></DIV
><DIV
CLASS="section"
><H3
CLASS="section"
><A
NAME="AEN26424"
>パラメータ</A
></H3
><DIV
CLASS="informaltable"
><P
></P
><A
NAME="AEN26426"
></A
><TABLE
BORDER="0"
FRAME="void"
RULES="none"
WIDTH="100%"
CLASS="CALSTABLE"
><COL
WIDTH="8%"><COL
WIDTH="17%"><COL
WIDTH="33%"><COL
WIDTH="42%"><TBODY
VALIGN="top"
><TR
><TD
>UINT</TD
><TD
>&#13;                <CODE
CLASS="varname"
>ptmrno</CODE
>
              </TD
><TD
>Physical Timer Number</TD
><TD
>物理タイマ番号</TD
></TR
></TBODY
></TABLE
><P
></P
></DIV
></DIV
><DIV
CLASS="section"
><H3
CLASS="section"
><A
NAME="AEN26439"
>リターンパラメータ</A
></H3
><DIV
CLASS="informaltable"
><P
></P
><A
NAME="AEN26441"
></A
><TABLE
BORDER="0"
FRAME="void"
RULES="none"
WIDTH="100%"
CLASS="CALSTABLE"
><COL
WIDTH="8%"
TITLE="c1"><COL
WIDTH="17%"
TITLE="c2"><COL
WIDTH="33%"
TITLE="c3"><COL
WIDTH="42%"
TITLE="c4"><TBODY
VALIGN="top"
><TR
><TD
>ER</TD
><TD
>&#13;                <CODE
CLASS="varname"
>ercd</CODE
>
              </TD
><TD
>Error Code</TD
><TD
>エラーコード</TD
></TR
></TBODY
></TABLE
><P
></P
></DIV
></DIV
><DIV
CLASS="section"
><H3
CLASS="section"
><A
NAME="AEN26454"
>エラーコード</A
></H3
><DIV
CLASS="informaltable"
><P
></P
><A
NAME="AEN26456"
></A
><TABLE
BORDER="0"
FRAME="void"
RULES="none"
WIDTH="100%"
CLASS="CALSTABLE"
><COL
WIDTH="17%"
TITLE="c1"><COL
WIDTH="83%"
TITLE="c2"><TBODY
VALIGN="top"
><TR
><TD
>&#13;                <SPAN
CLASS="errorname"
>E_OK</SPAN
>
              </TD
><TD
>正常終了</TD
></TR
><TR
><TD
>&#13;                <SPAN
CLASS="errorname"
>E_PAR</SPAN
>
              </TD
><TD
>パラメータエラー(<CODE
CLASS="varname"
>ptmrno</CODE
> が不正あるいは利用できない)</TD
></TR
></TBODY
></TABLE
><P
></P
></DIV
></DIV
><DIV
CLASS="section"
><H3
CLASS="section"
><A
NAME="AEN26470"
>利用可能なコンテキスト</A
></H3
><DIV
CLASS="informaltable"
><P
></P
><A
NAME="AEN26472"
></A
><TABLE
BORDER="1"
FRAME="border"
RULES="all"
WIDTH="100%"
CLASS="CALSTABLE"
><COL
WIDTH="33%"><COL
WIDTH="33%"><COL
WIDTH="33%"><THEAD
><TR
><TH
ALIGN="center"
>タスク部</TH
><TH
ALIGN="center"
>準タスク部</TH
><TH
ALIGN="center"
>タスク独立部</TH
></TR
></THEAD
><TBODY
VALIGN="top"
><TR
><TD
ALIGN="center"
>○</TD
><TD
ALIGN="center"
>○</TD
><TD
ALIGN="center"
>×</TD
></TR
></TBODY
></TABLE
><P
></P
></DIV
></DIV
><DIV
CLASS="section"
><H3
CLASS="section"
><A
NAME="AEN26487"
>関連するサービスプロファイル</A
></H3
><P
>以下のサービスプロファイルが有効に設定されている場合に限り、本APIはサポートされる。</P
><DIV
CLASS="informaltable"
><P
></P
><A
NAME="AEN26490"
></A
><TABLE
BORDER="0"
FRAME="void"
RULES="none"
WIDTH="100%"
CLASS="CALSTABLE"
><COL
WIDTH="38%"
TITLE="c1"><COL
WIDTH="62%"><TBODY
VALIGN="top"
><TR
><TD
>&#13;                <TT
CLASS="literal"
>TK_SUPPORT_PTIMER</TT
>
              </TD
><TD
>物理タイマ機能のサポート</TD
></TR
></TBODY
></TABLE
><P
></P
></DIV
><P
>また、以下のサービスプロファイルが本APIに関係する。</P
><DIV
CLASS="informaltable"
><P
></P
><A
NAME="AEN26500"
></A
><TABLE
BORDER="0"
FRAME="void"
RULES="none"
WIDTH="100%"
CLASS="CALSTABLE"
><COL
WIDTH="38%"
TITLE="c1"><COL
WIDTH="62%"><TBODY
VALIGN="top"
><TR
><TD
>&#13;                <TT
CLASS="literal"
>TK_MAX_PTIMER</TT
>
              </TD
><TD
>最大物理タイマ番号</TD
></TR
></TBODY
></TABLE
><P
></P
></DIV
></DIV
><DIV
CLASS="section"
><H3
CLASS="section"
><A
NAME="AEN26509"
>解説</A
></H3
><P
><CODE
CLASS="varname"
>ptmrno</CODE
> で指定された物理タイマのカウントを停止する。</P
><P
>本関数の実行後、物理タイマのカウント値はそのまま保持される。すなわち、本関数の実行後に <A
HREF="physical_timer_functions.html#GetPhysicalTimerCount"
>GetPhysicalTimerCount</A
> を実行した場合には、本関数実行直前の物理タイマのカウント値が返る。</P
><P
>既にカウントを停止している物理タイマに対して、本関数を実行しても、何も起こらない。エラーにもならない。</P
></DIV
><DIV
CLASS="section"
><H3
CLASS="section"
><A
NAME="AEN26516"
>補足事項</A
></H3
><P
>使用の終わった物理タイマを動かしたままにしておいた場合、プログラムの動作上の不都合はなくても、クロックを無駄に使い、省電力などの面で望ましくない可能性がある。そのため、使用していない物理タイマに対しては、本関数を実行し、カウントを停止しておく方が望ましい。</P
><P
>本関数の発行が有効なのは、<A
HREF="physical_timer_functions.html#StartPhysicalTimer"
>StartPhysicalTimer</A
> の <CODE
CLASS="varname"
>mode</CODE
> として <TT
CLASS="literal"
>TA_CYC_PTMR</TT
> を指定した物理タイマの使用が終了した場合である。<CODE
CLASS="varname"
>mode</CODE
> として <TT
CLASS="literal"
>TA_ALM_PTMR</TT
> を指定した場合は、カウント値が上限値から0に戻った後で自動的にカウントを停止し、本関数を実行した後と同じ状態になる。この場合は、本関数を別途発行する必要はない。発行しても問題はないが、何も変化しない。</P
></DIV
></DIV
><DIV
CLASS="section"
><H2
CLASS="section"
><A
NAME="GetPhysicalTimerCount"
>GetPhysicalTimerCount - 物理タイマのカウント値取得</A
></H2
><DIV
CLASS="section"
><H3
CLASS="section"
><A
NAME="AEN26527"
>C言語インタフェース</A
></H3
><DIV
CLASS="funcsynopsis"
><P
></P
><A
NAME="AEN26529"
></A
><PRE
CLASS="funcsynopsisinfo"
>#include &#60;tk/tkernel.h&#62;</PRE
><P
><CODE
><CODE
CLASS="FUNCDEF"
>ER ercd = GetPhysicalTimerCount</CODE
>(UINT ptmrno, UW *p_count);</CODE
></P
><P
></P
></DIV
></DIV
><DIV
CLASS="section"
><H3
CLASS="section"
><A
NAME="AEN26538"
>パラメータ</A
></H3
><DIV
CLASS="informaltable"
><P
></P
><A
NAME="AEN26540"
></A
><TABLE
BORDER="0"
FRAME="void"
RULES="none"
WIDTH="100%"
CLASS="CALSTABLE"
><COL
WIDTH="8%"><COL
WIDTH="17%"><COL
WIDTH="33%"><COL
WIDTH="42%"><TBODY
VALIGN="top"
><TR
><TD
>UINT</TD
><TD
>&#13;                <CODE
CLASS="varname"
>ptmrno</CODE
>
              </TD
><TD
>Physical Timer Number</TD
><TD
>物理タイマ番号</TD
></TR
><TR
><TD
>UW*</TD
><TD
>&#13;                <CODE
CLASS="varname"
>p_count</CODE
>
              </TD
><TD
>Pointer to Physical Timer Count</TD
><TD
>物理タイマの現在カウント値を返す領域へのポインタ</TD
></TR
></TBODY
></TABLE
><P
></P
></DIV
></DIV
><DIV
CLASS="section"
><H3
CLASS="section"
><A
NAME="AEN26559"
>リターンパラメータ</A
></H3
><DIV
CLASS="informaltable"
><P
></P
><A
NAME="AEN26561"
></A
><TABLE
BORDER="0"
FRAME="void"
RULES="none"
WIDTH="100%"
CLASS="CALSTABLE"
><COL
WIDTH="8%"
TITLE="c1"><COL
WIDTH="17%"
TITLE="c2"><COL
WIDTH="33%"
TITLE="c3"><COL
WIDTH="42%"
TITLE="c4"><TBODY
VALIGN="top"
><TR
><TD
>ER</TD
><TD
>&#13;                <CODE
CLASS="varname"
>ercd</CODE
>
              </TD
><TD
>Error Code</TD
><TD
>エラーコード</TD
></TR
><TR
><TD
>UW</TD
><TD
>&#13;                <CODE
CLASS="varname"
>count</CODE
>
              </TD
><TD
>Physical Timer Count</TD
><TD
>現在カウント値</TD
></TR
></TBODY
></TABLE
><P
></P
></DIV
></DIV
><DIV
CLASS="section"
><H3
CLASS="section"
><A
NAME="AEN26580"
>エラーコード</A
></H3
><DIV
CLASS="informaltable"
><P
></P
><A
NAME="AEN26582"
></A
><TABLE
BORDER="0"
FRAME="void"
RULES="none"
WIDTH="100%"
CLASS="CALSTABLE"
><COL
WIDTH="17%"
TITLE="c1"><COL
WIDTH="83%"
TITLE="c2"><TBODY
VALIGN="top"
><TR
><TD
>&#13;                <SPAN
CLASS="errorname"
>E_OK</SPAN
>
              </TD
><TD
>正常終了</TD
></TR
><TR
><TD
>&#13;                <SPAN
CLASS="errorname"
>E_PAR</SPAN
>
              </TD
><TD
>パラメータエラー(<CODE
CLASS="varname"
>ptmrno</CODE
> が不正あるいは利用できない)</TD
></TR
></TBODY
></TABLE
><P
></P
></DIV
></DIV
><DIV
CLASS="section"
><H3
CLASS="section"
><A
NAME="AEN26596"
>利用可能なコンテキスト</A
></H3
><DIV
CLASS="informaltable"
><P
></P
><A
NAME="AEN26598"
></A
><TABLE
BORDER="1"
FRAME="border"
RULES="all"
WIDTH="100%"
CLASS="CALSTABLE"
><COL
WIDTH="33%"><COL
WIDTH="33%"><COL
WIDTH="33%"><THEAD
><TR
><TH
ALIGN="center"
>タスク部</TH
><TH
ALIGN="center"
>準タスク部</TH
><TH
ALIGN="center"
>タスク独立部</TH
></TR
></THEAD
><TBODY
VALIGN="top"
><TR
><TD
ALIGN="center"
>○</TD
><TD
ALIGN="center"
>○</TD
><TD
ALIGN="center"
>×</TD
></TR
></TBODY
></TABLE
><P
></P
></DIV
></DIV
><DIV
CLASS="section"
><H3
CLASS="section"
><A
NAME="AEN26613"
>関連するサービスプロファイル</A
></H3
><P
>以下のサービスプロファイルが有効に設定されている場合に限り、本APIはサポートされる。</P
><DIV
CLASS="informaltable"
><P
></P
><A
NAME="AEN26616"
></A
><TABLE
BORDER="0"
FRAME="void"
RULES="none"
WIDTH="100%"
CLASS="CALSTABLE"
><COL
WIDTH="38%"
TITLE="c1"><COL
WIDTH="62%"><TBODY
VALIGN="top"
><TR
><TD
>&#13;                <TT
CLASS="literal"
>TK_SUPPORT_PTIMER</TT
>
              </TD
><TD
>物理タイマ機能のサポート</TD
></TR
></TBODY
></TABLE
><P
></P
></DIV
><P
>また、以下のサービスプロファイルが本APIに関係する。</P
><DIV
CLASS="informaltable"
><P
></P
><A
NAME="AEN26626"
></A
><TABLE
BORDER="0"
FRAME="void"
RULES="none"
WIDTH="100%"
CLASS="CALSTABLE"
><COL
WIDTH="38%"
TITLE="c1"><COL
WIDTH="62%"><TBODY
VALIGN="top"
><TR
><TD
>&#13;                <TT
CLASS="literal"
>TK_MAX_PTIMER</TT
>
              </TD
><TD
>最大物理タイマ番号</TD
></TR
></TBODY
></TABLE
><P
></P
></DIV
></DIV
><DIV
CLASS="section"
><H3
CLASS="section"
><A
NAME="AEN26635"
>解説</A
></H3
><P
><CODE
CLASS="varname"
>ptmrno</CODE
> で指定された物理タイマの現在のカウント値を取得し、リターンパラメータ <CODE
CLASS="varname"
>count</CODE
> として返す。</P
></DIV
></DIV
><DIV
CLASS="section"
><H2
CLASS="section"
><A
NAME="DefinePhysicalTimerHandler"
>DefinePhysicalTimerHandler - 物理タイマハンドラ定義</A
></H2
><DIV
CLASS="section"
><H3
CLASS="section"
><A
NAME="AEN26642"
>C言語インタフェース</A
></H3
><DIV
CLASS="funcsynopsis"
><P
></P
><A
NAME="AEN26644"
></A
><PRE
CLASS="funcsynopsisinfo"
>#include &#60;tk/tkernel.h&#62;</PRE
><P
><CODE
><CODE
CLASS="FUNCDEF"
>ER ercd = DefinePhysicalTimerHandler</CODE
>(UINT ptmrno, CONST T_DPTMR *pk_dptmr);</CODE
></P
><P
></P
></DIV
></DIV
><DIV
CLASS="section"
><H3
CLASS="section"
><A
NAME="AEN26653"
>パラメータ</A
></H3
><DIV
CLASS="informaltable"
><P
></P
><A
NAME="AEN26655"
></A
><TABLE
BORDER="0"
FRAME="void"
RULES="none"
WIDTH="100%"
CLASS="CALSTABLE"
><COL
WIDTH="21%"><COL
WIDTH="14%"><COL
WIDTH="29%"><COL
WIDTH="36%"><TBODY
VALIGN="top"
><TR
><TD
>UINT</TD
><TD
>&#13;                <CODE
CLASS="varname"
>ptmrno</CODE
>
              </TD
><TD
>Physical Timer Number</TD
><TD
>物理タイマ番号</TD
></TR
><TR
><TD
>CONST T_DPTMR*</TD
><TD
>&#13;                <CODE
CLASS="varname"
>pk_dptmr</CODE
>
              </TD
><TD
>Packet to Define Physical Timer Handler</TD
><TD
>物理タイマハンドラ定義情報</TD
></TR
></TBODY
></TABLE
><P
></P
></DIV
><P
><CODE
CLASS="varname"
>pk_dptmr</CODE
> の内容</P
><DIV
CLASS="informaltable"
><P
></P
><A
NAME="AEN26676"
></A
><TABLE
BORDER="0"
FRAME="void"
RULES="none"
WIDTH="100%"
CLASS="CALSTABLE"
><COL
WIDTH="21%"
TITLE="c1"><COL
WIDTH="14%"><COL
WIDTH="29%"><COL
WIDTH="36%"
TITLE="c4"><TBODY
VALIGN="top"
><TR
><TD
>void*</TD
><TD
>&#13;                <CODE
CLASS="varname"
>exinf</CODE
>
              </TD
><TD
>Extended Information</TD
><TD
>拡張情報</TD
></TR
><TR
><TD
>ATR</TD
><TD
>&#13;                <CODE
CLASS="varname"
>ptmratr</CODE
>
              </TD
><TD
>Physical Timer Attribute</TD
><TD
>物理タイマハンドラ属性(<TT
CLASS="literal"
>TA_ASM</TT
> || <TT
CLASS="literal"
>TA_HLNG</TT
>)</TD
></TR
><TR
><TD
>FP</TD
><TD
>&#13;                <CODE
CLASS="varname"
>ptmrhdr</CODE
>
              </TD
><TD
>Physical Timer Handler Address</TD
><TD
>物理タイマハンドラアドレス</TD
></TR
></TBODY
></TABLE
><P
></P
></DIV
></DIV
><DIV
CLASS="section"
><H3
CLASS="section"
><A
NAME="AEN26703"
>リターンパラメータ</A
></H3
><DIV
CLASS="informaltable"
><P
></P
><A
NAME="AEN26705"
></A
><TABLE
BORDER="0"
FRAME="void"
RULES="none"
WIDTH="100%"
CLASS="CALSTABLE"
><COL
WIDTH="21%"
TITLE="c1"><COL
WIDTH="14%"
TITLE="c2"><COL
WIDTH="29%"
TITLE="c3"><COL
WIDTH="36%"
TITLE="c4"><TBODY
VALIGN="top"
><TR
><TD
>ER</TD
><TD
>&#13;                <CODE
CLASS="varname"
>ercd</CODE
>
              </TD
><TD
>Error Code</TD
><TD
>エラーコード</TD
></TR
></TBODY
></TABLE
><P
></P
></DIV
></DIV
><DIV
CLASS="section"
><H3
CLASS="section"
><A
NAME="AEN26718"
>エラーコード</A
></H3
><DIV
CLASS="informaltable"
><P
></P
><A
NAME="AEN26720"
></A
><TABLE
BORDER="0"
FRAME="void"
RULES="none"
WIDTH="100%"
CLASS="CALSTABLE"
><COL
WIDTH="17%"
TITLE="c1"><COL
WIDTH="83%"
TITLE="c2"><TBODY
VALIGN="top"
><TR
><TD
>&#13;                <SPAN
CLASS="errorname"
>E_OK</SPAN
>
              </TD
><TD
>正常終了</TD
></TR
><TR
><TD
>&#13;                <SPAN
CLASS="errorname"
>E_NOMEM</SPAN
>
              </TD
><TD
>メモリ不足(管理ブロック用の領域が確保できない)</TD
></TR
><TR
><TD
>&#13;                <SPAN
CLASS="errorname"
>E_RSATR</SPAN
>
              </TD
><TD
>予約属性(<CODE
CLASS="varname"
>ptmratr</CODE
> が不正あるいは利用できない)</TD
></TR
><TR
><TD
>&#13;                <SPAN
CLASS="errorname"
>E_PAR</SPAN
>
              </TD
><TD
>パラメータエラー(<CODE
CLASS="varname"
>ptmrno</CODE
>, <CODE
CLASS="varname"
>pk_dptmr</CODE
>, <CODE
CLASS="varname"
>ptmrhdr</CODE
> が不正あるいは利用できない、<CODE
CLASS="varname"
>ptmrno</CODE
> に対する物理タイマハンドラを定義できない)</TD
></TR
></TBODY
></TABLE
><P
></P
></DIV
></DIV
><DIV
CLASS="section"
><H3
CLASS="section"
><A
NAME="AEN26746"
>利用可能なコンテキスト</A
></H3
><DIV
CLASS="informaltable"
><P
></P
><A
NAME="AEN26748"
></A
><TABLE
BORDER="1"
FRAME="border"
RULES="all"
WIDTH="100%"
CLASS="CALSTABLE"
><COL
WIDTH="33%"><COL
WIDTH="33%"><COL
WIDTH="33%"><THEAD
><TR
><TH
ALIGN="center"
>タスク部</TH
><TH
ALIGN="center"
>準タスク部</TH
><TH
ALIGN="center"
>タスク独立部</TH
></TR
></THEAD
><TBODY
VALIGN="top"
><TR
><TD
ALIGN="center"
>○</TD
><TD
ALIGN="center"
>○</TD
><TD
ALIGN="center"
>×</TD
></TR
></TBODY
></TABLE
><P
></P
></DIV
></DIV
><DIV
CLASS="section"
><H3
CLASS="section"
><A
NAME="AEN26763"
>関連するサービスプロファイル</A
></H3
><P
>以下のサービスプロファイルが有効に設定されている場合に限り、本APIはサポートされる。</P
><DIV
CLASS="informaltable"
><P
></P
><A
NAME="AEN26766"
></A
><TABLE
BORDER="0"
FRAME="void"
RULES="none"
WIDTH="100%"
CLASS="CALSTABLE"
><COL
WIDTH="38%"
TITLE="c1"><COL
WIDTH="62%"><TBODY
VALIGN="top"
><TR
><TD
>&#13;                <TT
CLASS="literal"
>TK_SUPPORT_PTIMER</TT
>
              </TD
><TD
>物理タイマ機能のサポート</TD
></TR
></TBODY
></TABLE
><P
></P
></DIV
><P
>また、以下のサービスプロファイルが本APIに関係する。</P
><DIV
CLASS="informaltable"
><P
></P
><A
NAME="AEN26776"
></A
><TABLE
BORDER="0"
FRAME="void"
RULES="none"
WIDTH="100%"
CLASS="CALSTABLE"
><COL
WIDTH="38%"
TITLE="c1"><COL
WIDTH="62%"><TBODY
VALIGN="top"
><TR
><TD
>&#13;                <TT
CLASS="literal"
>TK_MAX_PTIMER</TT
>
              </TD
><TD
>最大物理タイマ番号</TD
></TR
></TBODY
></TABLE
><P
></P
></DIV
></DIV
><DIV
CLASS="section"
><H3
CLASS="section"
><A
NAME="AEN26785"
>解説</A
></H3
><P
><CODE
CLASS="varname"
>pk_dptmr</CODE
> が <TT
CLASS="literal"
>NULL</TT
> でない場合は、<CODE
CLASS="varname"
>ptmrno</CODE
> で指定された物理タイマに対する物理タイマハンドラを定義する。物理タイマハンドラは、タスク独立部として実行されるハンドラであり、物理タイマのカウント値が <A
HREF="physical_timer_functions.html#StartPhysicalTimer"
>StartPhysicalTimer</A
> の <CODE
CLASS="varname"
>limit</CODE
> で指定された上限値から0に戻る時に起動される。</P
><P
>物理タイマハンドラのプログラム形式は、周期ハンドラやアラームハンドラと同様である。すなわち、<TT
CLASS="literal"
>TA_HLNG</TT
> 属性が指定された場合は、高級言語対応ルーチンを経由して物理タイマハンドラが起動され、関数からのリターンによって終了する。<TT
CLASS="literal"
>TA_ASM</TT
> 属性が指定された場合の物理タイマハンドラの形式は実装依存である。いずれの属性を指定した場合も、物理タイマハンドラの起動時のパラメータとして <CODE
CLASS="varname"
>exinf</CODE
> を渡す。</P
><P
><CODE
CLASS="varname"
>pk_dptmr</CODE
> が <TT
CLASS="literal"
>NULL</TT
> の場合は、<CODE
CLASS="varname"
>ptmrno</CODE
> で指定された物理タイマに対する物理タイマハンドラの定義を解除する。システム起動直後は、すべての物理タイマに対する物理タイマハンドラの定義が解除された状態となっている。</P
><P
><CODE
CLASS="varname"
>ptmrno</CODE
> で指定された物理タイマに対する物理タイマハンドラを定義できない場合(<A
HREF="physical_timer_functions.html#GetPhysicalTimerConfig"
>GetPhysicalTimerConfig</A
> の <CODE
CLASS="varname"
>pk_rptmr</CODE
>-&#62;<CODE
CLASS="varname"
>defhdr</CODE
> で <TT
CLASS="literal"
>FALSE</TT
> を返す場合)は、<SPAN
CLASS="errorname"
>E_PAR</SPAN
> のエラーになる。<CODE
CLASS="varname"
>ptmrno</CODE
> で指定された番号を持つ物理タイマが存在しない場合や、利用できない場合にも、<SPAN
CLASS="errorname"
>E_PAR</SPAN
> のエラーになる。</P
></DIV
><DIV
CLASS="section"
><H3
CLASS="section"
><A
NAME="AEN26810"
>補足事項</A
></H3
><P
>実装上は、物理タイマの機能を実現するための割込みハンドラを μT-Kernel/SMの内部で定義し、物理タイマのカウント値が上限値から0に戻る時に、この割込みハンドラが起動されるように設定しておく。この割込みハンドラの中では、本関数で定義された物理タイマハンドラを呼び出すとともに、物理タイマの実装に関わる処理(たとえば、<TT
CLASS="literal"
>TA_ALM_PTMR</TT
> と <TT
CLASS="literal"
>TA_CYC_PTMR</TT
> に関する処理など)を行う。</P
></DIV
></DIV
><DIV
CLASS="section"
><H2
CLASS="section"
><A
NAME="GetPhysicalTimerConfig"
>GetPhysicalTimerConfig - 物理タイマのコンフィグレーション情報取得</A
></H2
><DIV
CLASS="section"
><H3
CLASS="section"
><A
NAME="AEN26817"
>C言語インタフェース</A
></H3
><DIV
CLASS="funcsynopsis"
><P
></P
><A
NAME="AEN26819"
></A
><PRE
CLASS="funcsynopsisinfo"
>#include &#60;tk/tkernel.h&#62;</PRE
><P
><CODE
><CODE
CLASS="FUNCDEF"
>ER ercd = GetPhysicalTimerConfig</CODE
>(UINT ptmrno, T_RPTMR *pk_rptmr);</CODE
></P
><P
></P
></DIV
></DIV
><DIV
CLASS="section"
><H3
CLASS="section"
><A
NAME="AEN26828"
>パラメータ</A
></H3
><DIV
CLASS="informaltable"
><P
></P
><A
NAME="AEN26830"
></A
><TABLE
BORDER="0"
FRAME="void"
RULES="none"
WIDTH="100%"
CLASS="CALSTABLE"
><COL
WIDTH="15%"><COL
WIDTH="15%"><COL
WIDTH="31%"><COL
WIDTH="38%"><TBODY
VALIGN="top"
><TR
><TD
>UINT</TD
><TD
>&#13;                <CODE
CLASS="varname"
>ptmrno</CODE
>
              </TD
><TD
>Physical Timer Number</TD
><TD
>物理タイマ番号</TD
></TR
><TR
><TD
>T_RPTMR*</TD
><TD
>&#13;                <CODE
CLASS="varname"
>pk_rptmr</CODE
>
              </TD
><TD
>Packet to Refer Physical Timer</TD
><TD
>物理タイマのコンフィグレーション情報を返す領域へのポインタ</TD
></TR
></TBODY
></TABLE
><P
></P
></DIV
></DIV
><DIV
CLASS="section"
><H3
CLASS="section"
><A
NAME="AEN26849"
>リターンパラメータ</A
></H3
><DIV
CLASS="informaltable"
><P
></P
><A
NAME="AEN26851"
></A
><TABLE
BORDER="0"
FRAME="void"
RULES="none"
WIDTH="100%"
CLASS="CALSTABLE"
><COL
WIDTH="15%"
TITLE="c1"><COL
WIDTH="15%"
TITLE="c2"><COL
WIDTH="31%"
TITLE="c3"><COL
WIDTH="38%"
TITLE="c4"><TBODY
VALIGN="top"
><TR
><TD
>ER</TD
><TD
>&#13;                <CODE
CLASS="varname"
>ercd</CODE
>
              </TD
><TD
>Error Code</TD
><TD
>エラーコード</TD
></TR
></TBODY
></TABLE
><P
></P
></DIV
><P
><CODE
CLASS="varname"
>pk_rptmr</CODE
> の内容</P
><DIV
CLASS="informaltable"
><P
></P
><A
NAME="AEN26866"
></A
><TABLE
BORDER="0"
FRAME="void"
RULES="none"
WIDTH="100%"
CLASS="CALSTABLE"
><COL
WIDTH="15%"
TITLE="c1"><COL
WIDTH="15%"><COL
WIDTH="31%"><COL
WIDTH="38%"
TITLE="c4"><TBODY
VALIGN="top"
><TR
><TD
>UW</TD
><TD
>&#13;                <CODE
CLASS="varname"
>ptmrclk</CODE
>
              </TD
><TD
>Physical Timer Clock Frequency</TD
><TD
>物理タイマのクロック周波数</TD
></TR
><TR
><TD
>UW</TD
><TD
>&#13;                <CODE
CLASS="varname"
>maxcount</CODE
>
              </TD
><TD
>Maximum Count</TD
><TD
>最大カウント値</TD
></TR
><TR
><TD
>BOOL</TD
><TD
>&#13;                <CODE
CLASS="varname"
>defhdr</CODE
>
              </TD
><TD
>Handler Support</TD
><TD
>物理タイマハンドラサポートの有無</TD
></TR
></TBODY
></TABLE
><P
></P
></DIV
></DIV
><DIV
CLASS="section"
><H3
CLASS="section"
><A
NAME="AEN26891"
>エラーコード</A
></H3
><DIV
CLASS="informaltable"
><P
></P
><A
NAME="AEN26893"
></A
><TABLE
BORDER="0"
FRAME="void"
RULES="none"
WIDTH="100%"
CLASS="CALSTABLE"
><COL
WIDTH="17%"
TITLE="c1"><COL
WIDTH="83%"
TITLE="c2"><TBODY
VALIGN="top"
><TR
><TD
>&#13;                <SPAN
CLASS="errorname"
>E_OK</SPAN
>
              </TD
><TD
>正常終了</TD
></TR
><TR
><TD
>&#13;                <SPAN
CLASS="errorname"
>E_PAR</SPAN
>
              </TD
><TD
>パラメータエラー(<CODE
CLASS="varname"
>ptmrno</CODE
>, <CODE
CLASS="varname"
>pk_rptmr</CODE
> が不正あるいは利用できない)</TD
></TR
></TBODY
></TABLE
><P
></P
></DIV
></DIV
><DIV
CLASS="section"
><H3
CLASS="section"
><A
NAME="AEN26908"
>利用可能なコンテキスト</A
></H3
><DIV
CLASS="informaltable"
><P
></P
><A
NAME="AEN26910"
></A
><TABLE
BORDER="1"
FRAME="border"
RULES="all"
WIDTH="100%"
CLASS="CALSTABLE"
><COL
WIDTH="33%"><COL
WIDTH="33%"><COL
WIDTH="33%"><THEAD
><TR
><TH
ALIGN="center"
>タスク部</TH
><TH
ALIGN="center"
>準タスク部</TH
><TH
ALIGN="center"
>タスク独立部</TH
></TR
></THEAD
><TBODY
VALIGN="top"
><TR
><TD
ALIGN="center"
>○</TD
><TD
ALIGN="center"
>○</TD
><TD
ALIGN="center"
>×</TD
></TR
></TBODY
></TABLE
><P
></P
></DIV
></DIV
><DIV
CLASS="section"
><H3
CLASS="section"
><A
NAME="AEN26925"
>関連するサービスプロファイル</A
></H3
><P
>以下のサービスプロファイルが有効に設定されている場合に限り、本APIはサポートされる。</P
><DIV
CLASS="informaltable"
><P
></P
><A
NAME="AEN26928"
></A
><TABLE
BORDER="0"
FRAME="void"
RULES="none"
WIDTH="100%"
CLASS="CALSTABLE"
><COL
WIDTH="38%"
TITLE="c1"><COL
WIDTH="62%"><TBODY
VALIGN="top"
><TR
><TD
>&#13;                <TT
CLASS="literal"
>TK_SUPPORT_PTIMER</TT
>
              </TD
><TD
>物理タイマ機能のサポート</TD
></TR
></TBODY
></TABLE
><P
></P
></DIV
><P
>また、以下のサービスプロファイルが本APIに関係する。</P
><DIV
CLASS="informaltable"
><P
></P
><A
NAME="AEN26938"
></A
><TABLE
BORDER="0"
FRAME="void"
RULES="none"
WIDTH="100%"
CLASS="CALSTABLE"
><COL
WIDTH="38%"
TITLE="c1"><COL
WIDTH="62%"><TBODY
VALIGN="top"
><TR
><TD
>&#13;                <TT
CLASS="literal"
>TK_MAX_PTIMER</TT
>
              </TD
><TD
>最大物理タイマ番号</TD
></TR
></TBODY
></TABLE
><P
></P
></DIV
></DIV
><DIV
CLASS="section"
><H3
CLASS="section"
><A
NAME="AEN26947"
>解説</A
></H3
><P
><CODE
CLASS="varname"
>ptmrno</CODE
> で指定された物理タイマに関するコンフィグレーション情報を取得する。</P
><P
>取得可能なコンフィグレーション情報には、物理タイマのクロック周波数 <CODE
CLASS="varname"
>ptmrclk</CODE
>、最大カウント値 <CODE
CLASS="varname"
>maxcount</CODE
>、物理タイマハンドラサポートの有無 <CODE
CLASS="varname"
>defhdr</CODE
> がある。</P
><P
><CODE
CLASS="varname"
>ptmrclk</CODE
> は、対象物理タイマのカウントアップに使用されるクロックの周波数である。<CODE
CLASS="varname"
>ptmrclk</CODE
> が1の場合はクロックが1Hz、<CODE
CLASS="varname"
>ptmrclk</CODE
> が (2<SUP
>32</SUP
>-1) の場合は (2<SUP
>32</SUP
>-1)Hz、すなわち約4GHzである。1Hz未満の長いクロックの場合は、<CODE
CLASS="varname"
>ptmrclk</CODE
> が0となる。<CODE
CLASS="varname"
>ptmrclk</CODE
> が0以外の場合は、<CODE
CLASS="varname"
>ptmrclk</CODE
> の逆数の時間間隔ごとに、物理タイマのカウント値が0から上限値 <CODE
CLASS="varname"
>limit</CODE
> の値まで単調増加していく。</P
><P
><CODE
CLASS="varname"
>maxcount</CODE
> は、対象物理タイマでカウント可能な最大値であり、上限値として設定可能な最大値でもある。一般的には、16ビットのタイマカウンタの場合は <CODE
CLASS="varname"
>maxcount</CODE
> が(2<SUP
>16</SUP
>-1)、32ビットのタイマカウンタの場合は <CODE
CLASS="varname"
>maxcount</CODE
> が(2<SUP
>32</SUP
>-1)となるが、ハードウェアやシステム構成によっては、それ以外の値をとる場合もある。</P
><P
><CODE
CLASS="varname"
>defhdr</CODE
> が <TT
CLASS="literal"
>TRUE</TT
> の場合は、対象物理タイマのカウント値が上限値に達した時に起動される物理タイマハンドラを定義できる。<CODE
CLASS="varname"
>defhdr</CODE
> が <TT
CLASS="literal"
>FALSE</TT
> の場合は、この物理タイマに対する物理タイマハンドラを定義することはできない。</P
><P
><CODE
CLASS="varname"
>ptmrno</CODE
> で指定された番号を持つ物理タイマが存在せず、利用できない場合には、<SPAN
CLASS="errorname"
>E_PAR</SPAN
> のエラーになる。物理タイマ番号は正の整数を小さい方から使っていくため、N個の物理タイマが使えるシステムでは、<CODE
CLASS="varname"
>ptmrno</CODE
> が0または(N+1)以上の場合に <SPAN
CLASS="errorname"
>E_PAR</SPAN
> のエラーになる。</P
></DIV
><DIV
CLASS="section"
><H3
CLASS="section"
><A
NAME="AEN26981"
>補足事項</A
></H3
><P
>本関数の「コンフィグレーション」の名称にも見られるとおり、本関数で取得する <CODE
CLASS="varname"
>ptmrclk</CODE
>, <CODE
CLASS="varname"
>maxcount</CODE
>, <CODE
CLASS="varname"
>defhdr</CODE
> の情報は、ハードウェアあるいはシステム起動時の設定により静的に固定されたものであり、システム動作中の変更がないことを想定している。しかしながら、将来あるいは実装依存の追加機能として、物理タイマのコンフィグレーション、たとえばクロック周波数を積極的に設定あるいは変更する機能を導入する可能性はあり、その場合は、本関数で取得する情報についても、システム動作中に変化する動的な情報となる。このような使い方の差異は、運用や用途に依存する部分が大きく、μT-Kernelの仕様として決めるよりは、物理タイマを使った上位のライブラリ等の中で吸収するのがよいと考えられる。したがって、μT-Kernelの仕様としては、本関数で取得するコンフィグレーション情報がシステムの動作中に変化する可能性について、特に定めないことにする。すなわち、本関数で取得した情報が途中で変化する可能性があるかどうかは、実装依存である。</P
></DIV
></DIV
></DIV
><DIV
CLASS="NAVFOOTER"
><HR
ALIGN="LEFT"
WIDTH="100%"><TABLE
SUMMARY="Footer navigation table"
WIDTH="100%"
BORDER="0"
CELLPADDING="0"
CELLSPACING="0"
><TR
><TD
WIDTH="33%"
ALIGN="left"
VALIGN="top"
><A
HREF="memory_cache_control_functions.html"
ACCESSKEY="P"
>前のページ</A
></TD
><TD
WIDTH="34%"
ALIGN="center"
VALIGN="top"
><A
HREF="index.html"
ACCESSKEY="H"
>ホーム</A
></TD
><TD
WIDTH="33%"
ALIGN="right"
VALIGN="top"
><A
HREF="utility_functions.html"
ACCESSKEY="N"
>次のページ</A
></TD
></TR
><TR
><TD
WIDTH="33%"
ALIGN="left"
VALIGN="top"
>メモリキャッシュ制御機能</TD
><TD
WIDTH="34%"
ALIGN="center"
VALIGN="top"
><A
HREF="utk_sm_functions.html"
ACCESSKEY="U"
>上に戻る</A
></TD
><TD
WIDTH="33%"
ALIGN="right"
VALIGN="top"
>ユーティリティ機能</TD
></TR
></TABLE
></DIV
></BODY
></HTML
>