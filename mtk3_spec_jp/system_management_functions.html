<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN""http://www.w3.org/TR/html4/loose.dtd">
<HTML
><HEAD
><TITLE
>システム状態管理機能</TITLE
><META
NAME="GENERATOR"
CONTENT="Modular DocBook HTML Stylesheet Version 1.79"><LINK
REL="HOME"
TITLE="μT-Kernel 3.0仕様書"
HREF="index.html"><LINK
REL="UP"
TITLE="μT-Kernel/OSの機能"
HREF="utk_os_functions.html"><LINK
REL="PREVIOUS"
TITLE="割込み管理機能"
HREF="interrupt_management_functions_os.html"><LINK
REL="NEXT"
TITLE="サブシステム管理機能"
HREF="subsystem_management_functions.html"></HEAD
><BODY
CLASS="section"
BGCOLOR="#FFFFFF"
TEXT="#000000"
LINK="#0000FF"
VLINK="#840084"
ALINK="#0000FF"
><DIV
CLASS="NAVHEADER"
><TABLE
SUMMARY="Header navigation table"
WIDTH="100%"
BORDER="0"
CELLPADDING="0"
CELLSPACING="0"
><TR
><TH
COLSPAN="3"
ALIGN="center"
>μT-Kernel 3.0仕様書</TH
></TR
><TR
><TD
WIDTH="10%"
ALIGN="left"
VALIGN="bottom"
><A
HREF="interrupt_management_functions_os.html"
ACCESSKEY="P"
>前のページ</A
></TD
><TD
WIDTH="80%"
ALIGN="center"
VALIGN="bottom"
>μT-Kernel/OSの機能</TD
><TD
WIDTH="10%"
ALIGN="right"
VALIGN="bottom"
><A
HREF="subsystem_management_functions.html"
ACCESSKEY="N"
>次のページ</A
></TD
></TR
></TABLE
><HR
ALIGN="LEFT"
WIDTH="100%"></DIV
><DIV
CLASS="section"
><H1
CLASS="section"
><A
NAME="system_management_functions"
>システム状態管理機能</A
></H1
><P
>システム状態管理機能は、システムの状態を変更／参照するための機能である。タスクの優先順位を回転する機能、実行状態のタスクIDを参照する機能、タスクディスパッチを禁止／解除する機能、コンテキストやシステム状態を参照する機能、省電力モードを設定する機能、カーネルのバージョンを参照する機能が含まれる。</P
><DIV
CLASS="section"
><H2
CLASS="section"
><A
NAME="tk_rot_rdq"
>tk_rot_rdq - タスクの優先順位の回転</A
></H2
><DIV
CLASS="section"
><H3
CLASS="section"
><A
NAME="AEN17035"
>C言語インタフェース</A
></H3
><DIV
CLASS="funcsynopsis"
><P
></P
><A
NAME="AEN17037"
></A
><PRE
CLASS="funcsynopsisinfo"
>#include &#60;tk/tkernel.h&#62;</PRE
><P
><CODE
><CODE
CLASS="FUNCDEF"
>ER ercd = tk_rot_rdq</CODE
>(PRI tskpri);</CODE
></P
><P
></P
></DIV
></DIV
><DIV
CLASS="section"
><H3
CLASS="section"
><A
NAME="AEN17044"
>パラメータ</A
></H3
><DIV
CLASS="informaltable"
><P
></P
><A
NAME="AEN17046"
></A
><TABLE
BORDER="0"
FRAME="void"
RULES="none"
WIDTH="100%"
CLASS="CALSTABLE"
><COL
WIDTH="8%"
TITLE="c1"><COL
WIDTH="17%"
TITLE="c2"><COL
WIDTH="33%"
TITLE="c3"><COL
WIDTH="42%"
TITLE="c4"><TBODY
VALIGN="top"
><TR
><TD
>PRI</TD
><TD
>&#13;                <CODE
CLASS="varname"
>tskpri</CODE
>
              </TD
><TD
>Task Priority</TD
><TD
>タスク優先度</TD
></TR
></TBODY
></TABLE
><P
></P
></DIV
></DIV
><DIV
CLASS="section"
><H3
CLASS="section"
><A
NAME="AEN17059"
>リターンパラメータ</A
></H3
><DIV
CLASS="informaltable"
><P
></P
><A
NAME="AEN17061"
></A
><TABLE
BORDER="0"
FRAME="void"
RULES="none"
WIDTH="100%"
CLASS="CALSTABLE"
><COL
WIDTH="8%"
TITLE="c1"><COL
WIDTH="17%"
TITLE="c2"><COL
WIDTH="33%"
TITLE="c3"><COL
WIDTH="42%"
TITLE="c4"><TBODY
VALIGN="top"
><TR
><TD
>ER</TD
><TD
>&#13;                <CODE
CLASS="varname"
>ercd</CODE
>
              </TD
><TD
>Error Code</TD
><TD
>エラーコード</TD
></TR
></TBODY
></TABLE
><P
></P
></DIV
></DIV
><DIV
CLASS="section"
><H3
CLASS="section"
><A
NAME="AEN17074"
>エラーコード</A
></H3
><DIV
CLASS="informaltable"
><P
></P
><A
NAME="AEN17076"
></A
><TABLE
BORDER="0"
FRAME="void"
RULES="none"
WIDTH="100%"
CLASS="CALSTABLE"
><COL
WIDTH="17%"
TITLE="c1"><COL
WIDTH="83%"
TITLE="c2"><TBODY
VALIGN="top"
><TR
><TD
>&#13;                <SPAN
CLASS="errorname"
>E_OK</SPAN
>
              </TD
><TD
>正常終了</TD
></TR
><TR
><TD
>&#13;                <SPAN
CLASS="errorname"
>E_PAR</SPAN
>
              </TD
><TD
>パラメータエラー(<CODE
CLASS="varname"
>tskpri</CODE
> が不正)</TD
></TR
></TBODY
></TABLE
><P
></P
></DIV
></DIV
><DIV
CLASS="section"
><H3
CLASS="section"
><A
NAME="AEN17090"
>利用可能なコンテキスト</A
></H3
><DIV
CLASS="informaltable"
><P
></P
><A
NAME="AEN17092"
></A
><TABLE
BORDER="1"
FRAME="border"
RULES="all"
WIDTH="100%"
CLASS="CALSTABLE"
><COL
WIDTH="33%"><COL
WIDTH="33%"><COL
WIDTH="33%"><THEAD
><TR
><TH
ALIGN="center"
>タスク部</TH
><TH
ALIGN="center"
>準タスク部</TH
><TH
ALIGN="center"
>タスク独立部</TH
></TR
></THEAD
><TBODY
VALIGN="top"
><TR
><TD
ALIGN="center"
>○</TD
><TD
ALIGN="center"
>○</TD
><TD
ALIGN="center"
>○</TD
></TR
></TBODY
></TABLE
><P
></P
></DIV
></DIV
><DIV
CLASS="section"
><H3
CLASS="section"
><A
NAME="AEN17107"
>関連するサービスプロファイル</A
></H3
><P
>なし</P
></DIV
><DIV
CLASS="section"
><H3
CLASS="section"
><A
NAME="AEN17110"
>解説</A
></H3
><P
><CODE
CLASS="varname"
>tskpri</CODE
> で指定される優先度のタスクの優先順位を回転する。すなわち、対象優先度を持った実行できる状態のタスクの中で、最も高い優先順位を持つタスクを、同じ優先度を持つタスクの中で最低の優先順位とする。</P
><P
><CODE
CLASS="varname"
>tskpri</CODE
>＝<TT
CLASS="literal"
>TPRI_RUN</TT
>＝0により、その時実行状態(RUNNING)にあるタスクの優先度のタスクの優先順位を回転する。一般のタスクから発行される <A
HREF="system_management_functions.html#tk_rot_rdq"
>tk_rot_rdq</A
> では、これは自タスクの持つ優先度のタスクの優先順位を回転するのと同じ意味であるが、周期ハンドラなどのタスク独立部から <A
HREF="system_management_functions.html#tk_rot_rdq"
>tk_rot_rdq</A
>(<CODE
CLASS="varname"
>tskpri</CODE
>=<TT
CLASS="literal"
>TPRI_RUN</TT
>) を発行することも可能である。</P
></DIV
><DIV
CLASS="section"
><H3
CLASS="section"
><A
NAME="AEN17121"
>補足事項</A
></H3
><P
>対象優先度を持った実行できる状態のタスクがない場合や、一つしかない場合には、何もしない(エラーとはしない)。</P
><P
>ディスパッチ許可状態で、対象優先度に <TT
CLASS="literal"
>TPRI_RUN</TT
> または自タスクの現在優先度を指定してこのシステムコールが呼び出されると、自タスクの実行順位は同じ優先度を持つタスクの中で最低となる。そのため、このシステムコールを用いて、実行権の放棄を行うことができる。</P
><P
>ディスパッチ禁止状態では、同じ優先度を持つタスクの中で最高の優先順位を持ったタスクが実行されているとは限らないため、この方法で自タスクの実行順位が同じ優先度を持つタスクの中で最低となるとは限らない。</P
><P
><A
HREF="system_management_functions.html#tk_rot_rdq"
>tk_rot_rdq</A
> の実行例を[<A
HREF="system_management_functions.html#figure_a_tk_rot_rdq"
>図5</A
>], [<A
HREF="system_management_functions.html#figure_b_tk_rot_rdq"
>図6</A
>]に示す。[<A
HREF="system_management_functions.html#figure_a_tk_rot_rdq"
>図5</A
>]の状態で、<CODE
CLASS="varname"
>tskpri</CODE
>＝2をパラメータとしてこのシステムコールが呼ばれると、新しい優先順位は[<A
HREF="system_management_functions.html#figure_b_tk_rot_rdq"
>図6</A
>]のようになり、次に実行されるのはタスクCとなる。</P
><DIV
CLASS="figure"
><A
NAME="figure_a_tk_rot_rdq"
></A
><P
><B
>図 5. tk_rot_rdq実行前の優先順位</B
></P
><DIV
CLASS="mediaobject"
><P
><IMG
SRC="images/f_15_as.png"></P
></DIV
></DIV
><DIV
CLASS="figure"
><A
NAME="figure_b_tk_rot_rdq"
></A
><P
><B
>図 6. tk_rot_rdq(<CODE
CLASS="varname"
>tskpri</CODE
>=2)実行後の優先順位</B
></P
><DIV
CLASS="mediaobject"
><P
><IMG
SRC="images/f_15_bs.png"></P
></DIV
></DIV
></DIV
></DIV
><DIV
CLASS="section"
><H2
CLASS="section"
><A
NAME="tk_get_tid"
>tk_get_tid - 実行状態タスクのタスクID参照</A
></H2
><DIV
CLASS="section"
><H3
CLASS="section"
><A
NAME="AEN17152"
>C言語インタフェース</A
></H3
><DIV
CLASS="funcsynopsis"
><P
></P
><A
NAME="AEN17154"
></A
><PRE
CLASS="funcsynopsisinfo"
>#include &#60;tk/tkernel.h&#62;</PRE
><P
><CODE
><CODE
CLASS="FUNCDEF"
>ID tskid = tk_get_tid</CODE
>(void);</CODE
></P
><P
></P
></DIV
></DIV
><DIV
CLASS="section"
><H3
CLASS="section"
><A
NAME="AEN17160"
>パラメータ</A
></H3
><P
>なし</P
></DIV
><DIV
CLASS="section"
><H3
CLASS="section"
><A
NAME="AEN17163"
>リターンパラメータ</A
></H3
><DIV
CLASS="informaltable"
><P
></P
><A
NAME="AEN17165"
></A
><TABLE
BORDER="0"
FRAME="void"
RULES="none"
WIDTH="100%"
CLASS="CALSTABLE"
><COL
WIDTH="8%"
TITLE="c1"><COL
WIDTH="17%"
TITLE="c2"><COL
WIDTH="33%"
TITLE="c3"><COL
WIDTH="42%"
TITLE="c4"><TBODY
VALIGN="top"
><TR
><TD
>ID</TD
><TD
>&#13;                <CODE
CLASS="varname"
>tskid</CODE
>
              </TD
><TD
>Task ID</TD
><TD
>実行状態タスクのID</TD
></TR
></TBODY
></TABLE
><P
></P
></DIV
></DIV
><DIV
CLASS="section"
><H3
CLASS="section"
><A
NAME="AEN17178"
>エラーコード</A
></H3
><P
>なし</P
></DIV
><DIV
CLASS="section"
><H3
CLASS="section"
><A
NAME="AEN17181"
>利用可能なコンテキスト</A
></H3
><DIV
CLASS="informaltable"
><P
></P
><A
NAME="AEN17183"
></A
><TABLE
BORDER="1"
FRAME="border"
RULES="all"
WIDTH="100%"
CLASS="CALSTABLE"
><COL
WIDTH="33%"><COL
WIDTH="33%"><COL
WIDTH="33%"><THEAD
><TR
><TH
ALIGN="center"
>タスク部</TH
><TH
ALIGN="center"
>準タスク部</TH
><TH
ALIGN="center"
>タスク独立部</TH
></TR
></THEAD
><TBODY
VALIGN="top"
><TR
><TD
ALIGN="center"
>○</TD
><TD
ALIGN="center"
>○</TD
><TD
ALIGN="center"
>○</TD
></TR
></TBODY
></TABLE
><P
></P
></DIV
></DIV
><DIV
CLASS="section"
><H3
CLASS="section"
><A
NAME="AEN17198"
>関連するサービスプロファイル</A
></H3
><P
>なし</P
></DIV
><DIV
CLASS="section"
><H3
CLASS="section"
><A
NAME="AEN17201"
>解説</A
></H3
><P
>現在実行状態にあるタスクのID番号を得る。タスク独立部の実行中を除けば、現在実行状態にあるタスクは自タスクである。</P
><P
>現在実行状態のタスクがない場合は、0が返される。</P
></DIV
><DIV
CLASS="section"
><H3
CLASS="section"
><A
NAME="AEN17205"
>補足事項</A
></H3
><P
><A
HREF="system_management_functions.html#tk_get_tid"
>tk_get_tid</A
> で返されるタスクIDは、<A
HREF="system_management_functions.html#tk_ref_sys"
>tk_ref_sys</A
> で返される <CODE
CLASS="varname"
>runtskid</CODE
> と同一である。</P
></DIV
></DIV
><DIV
CLASS="section"
><H2
CLASS="section"
><A
NAME="tk_dis_dsp"
>tk_dis_dsp - ディスパッチ禁止</A
></H2
><DIV
CLASS="section"
><H3
CLASS="section"
><A
NAME="AEN17213"
>C言語インタフェース</A
></H3
><DIV
CLASS="funcsynopsis"
><P
></P
><A
NAME="AEN17215"
></A
><PRE
CLASS="funcsynopsisinfo"
>#include &#60;tk/tkernel.h&#62;</PRE
><P
><CODE
><CODE
CLASS="FUNCDEF"
>ER ercd = tk_dis_dsp</CODE
>(void);</CODE
></P
><P
></P
></DIV
></DIV
><DIV
CLASS="section"
><H3
CLASS="section"
><A
NAME="AEN17221"
>パラメータ</A
></H3
><P
>なし</P
></DIV
><DIV
CLASS="section"
><H3
CLASS="section"
><A
NAME="AEN17224"
>リターンパラメータ</A
></H3
><DIV
CLASS="informaltable"
><P
></P
><A
NAME="AEN17226"
></A
><TABLE
BORDER="0"
FRAME="void"
RULES="none"
WIDTH="100%"
CLASS="CALSTABLE"
><COL
WIDTH="8%"
TITLE="c1"><COL
WIDTH="17%"
TITLE="c2"><COL
WIDTH="33%"
TITLE="c3"><COL
WIDTH="42%"
TITLE="c4"><TBODY
VALIGN="top"
><TR
><TD
>ER</TD
><TD
>&#13;                <CODE
CLASS="varname"
>ercd</CODE
>
              </TD
><TD
>Error Code</TD
><TD
>エラーコード</TD
></TR
></TBODY
></TABLE
><P
></P
></DIV
></DIV
><DIV
CLASS="section"
><H3
CLASS="section"
><A
NAME="AEN17239"
>エラーコード</A
></H3
><DIV
CLASS="informaltable"
><P
></P
><A
NAME="AEN17241"
></A
><TABLE
BORDER="0"
FRAME="void"
RULES="none"
WIDTH="100%"
CLASS="CALSTABLE"
><COL
WIDTH="17%"
TITLE="c1"><COL
WIDTH="83%"
TITLE="c2"><TBODY
VALIGN="top"
><TR
><TD
>&#13;                <SPAN
CLASS="errorname"
>E_OK</SPAN
>
              </TD
><TD
>正常終了</TD
></TR
><TR
><TD
>&#13;                <SPAN
CLASS="errorname"
>E_CTX</SPAN
>
              </TD
><TD
>コンテキストエラー(タスク独立部から発行)</TD
></TR
></TBODY
></TABLE
><P
></P
></DIV
></DIV
><DIV
CLASS="section"
><H3
CLASS="section"
><A
NAME="AEN17254"
>利用可能なコンテキスト</A
></H3
><DIV
CLASS="informaltable"
><P
></P
><A
NAME="AEN17256"
></A
><TABLE
BORDER="1"
FRAME="border"
RULES="all"
WIDTH="100%"
CLASS="CALSTABLE"
><COL
WIDTH="33%"><COL
WIDTH="33%"><COL
WIDTH="33%"><THEAD
><TR
><TH
ALIGN="center"
>タスク部</TH
><TH
ALIGN="center"
>準タスク部</TH
><TH
ALIGN="center"
>タスク独立部</TH
></TR
></THEAD
><TBODY
VALIGN="top"
><TR
><TD
ALIGN="center"
>○</TD
><TD
ALIGN="center"
>○</TD
><TD
ALIGN="center"
>×</TD
></TR
></TBODY
></TABLE
><P
></P
></DIV
></DIV
><DIV
CLASS="section"
><H3
CLASS="section"
><A
NAME="AEN17271"
>関連するサービスプロファイル</A
></H3
><P
>なし</P
></DIV
><DIV
CLASS="section"
><H3
CLASS="section"
><A
NAME="AEN17274"
>解説</A
></H3
><P
>タスクのディスパッチを禁止する。これ以後 <A
HREF="system_management_functions.html#tk_ena_dsp"
>tk_ena_dsp</A
> が実行されるまでの間はディスパッチ禁止状態となり、自タスクが実行状態(RUNNING)から実行可能状態(READY)に移ることはなくなる。また、待ち状態に移ることもできなくなる。ただし、外部割込みは禁止しないので、ディスパッチ禁止状態であっても割込みハンドラは起動される。ディスパッチ禁止状態においては、実行中のタスクが割込みハンドラによってプリエンプト(CPUの実行権の横取り)される可能性はあるが、他のタスクによってプリエンプトされる可能性はない。</P
><P
>ディスパッチ禁止状態の間は、具体的には次のような動作をする。</P
><P
></P
><UL
><LI
><P
>割込みハンドラあるいは <A
HREF="system_management_functions.html#tk_dis_dsp"
>tk_dis_dsp</A
> を実行したタスクから発行されたシステムコールによって、<A
HREF="system_management_functions.html#tk_dis_dsp"
>tk_dis_dsp</A
> を実行したタスクより高い優先度を持つタスクが実行可能状態(READY)となっても、そのタスクにはディスパッチされない。優先度の高いタスクへのディスパッチは、ディスパッチ禁止状態が終了するまで遅延される。</P
></LI
><LI
><P
><A
HREF="system_management_functions.html#tk_dis_dsp"
>tk_dis_dsp</A
> を実行したタスクが、自タスクを待ち状態に移す可能性のあるシステムコール(<A
HREF="task_dependent_synchronization_functions.html#tk_slp_tsk"
>tk_slp_tsk</A
>、<A
HREF="synchronzation_and_communication_functions.html#tk_wai_sem"
>tk_wai_sem</A
> など) を発行した場合には、<SPAN
CLASS="errorname"
>E_CTX</SPAN
> のエラーとなる。</P
></LI
><LI
><P
><A
HREF="system_management_functions.html#tk_ref_sys"
>tk_ref_sys</A
> によってシステム状態を参照した場合、<CODE
CLASS="varname"
>sysstat</CODE
> として <TT
CLASS="literal"
>TSS_DDSP</TT
> が返る。</P
></LI
></UL
><P
>既にディスパッチ禁止状態にあるタスクが <A
HREF="system_management_functions.html#tk_dis_dsp"
>tk_dis_dsp</A
> を発行した場合は、ディスパッチ禁止状態がそのまま継続するだけで、エラーとはならない。ただし、<A
HREF="system_management_functions.html#tk_dis_dsp"
>tk_dis_dsp</A
> を何回か発行しても、その後 <A
HREF="system_management_functions.html#tk_ena_dsp"
>tk_ena_dsp</A
> を1回発行するだけでディスパッチ禁止状態が解除される。したがって、<A
HREF="system_management_functions.html#tk_dis_dsp"
>tk_dis_dsp</A
>～<A
HREF="system_management_functions.html#tk_ena_dsp"
>tk_ena_dsp</A
> の対がネストした場合の動作は、必要に応じてユーザ側で管理しなければならない。</P
></DIV
><DIV
CLASS="section"
><H3
CLASS="section"
><A
NAME="AEN17301"
>補足事項</A
></H3
><P
>ディスパッチ禁止状態では、実行状態のタスクが休止状態(DORMANT)や未登録状態(NON-EXISTENT)に移行することはできない。割込みおよびディスパッチ禁止状態で、実行状態のタスクが <A
HREF="utk_os_functions.html#tk_ext_tsk"
>tk_ext_tsk</A
> または <A
HREF="utk_os_functions.html#tk_exd_tsk"
>tk_exd_tsk</A
> を発行した場合には、<SPAN
CLASS="errorname"
>E_CTX</SPAN
> のエラーを検出する。ただし、<A
HREF="utk_os_functions.html#tk_ext_tsk"
>tk_ext_tsk</A
> や <A
HREF="utk_os_functions.html#tk_exd_tsk"
>tk_exd_tsk</A
> は元のコンテキストに戻らないシステムコールなので、これらのシステムコールのリターンパラメータとしてエラーを通知することはできない。</P
></DIV
></DIV
><DIV
CLASS="section"
><H2
CLASS="section"
><A
NAME="tk_ena_dsp"
>tk_ena_dsp - ディスパッチ許可</A
></H2
><DIV
CLASS="section"
><H3
CLASS="section"
><A
NAME="AEN17311"
>C言語インタフェース</A
></H3
><DIV
CLASS="funcsynopsis"
><P
></P
><A
NAME="AEN17313"
></A
><PRE
CLASS="funcsynopsisinfo"
>#include &#60;tk/tkernel.h&#62;</PRE
><P
><CODE
><CODE
CLASS="FUNCDEF"
>ER ercd = tk_ena_dsp</CODE
>(void);</CODE
></P
><P
></P
></DIV
></DIV
><DIV
CLASS="section"
><H3
CLASS="section"
><A
NAME="AEN17319"
>パラメータ</A
></H3
><P
>なし</P
></DIV
><DIV
CLASS="section"
><H3
CLASS="section"
><A
NAME="AEN17322"
>リターンパラメータ</A
></H3
><DIV
CLASS="informaltable"
><P
></P
><A
NAME="AEN17324"
></A
><TABLE
BORDER="0"
FRAME="void"
RULES="none"
WIDTH="100%"
CLASS="CALSTABLE"
><COL
WIDTH="8%"
TITLE="c1"><COL
WIDTH="17%"
TITLE="c2"><COL
WIDTH="33%"
TITLE="c3"><COL
WIDTH="42%"
TITLE="c4"><TBODY
VALIGN="top"
><TR
><TD
>ER</TD
><TD
>&#13;                <CODE
CLASS="varname"
>ercd</CODE
>
              </TD
><TD
>Error Code</TD
><TD
>エラーコード</TD
></TR
></TBODY
></TABLE
><P
></P
></DIV
></DIV
><DIV
CLASS="section"
><H3
CLASS="section"
><A
NAME="AEN17337"
>エラーコード</A
></H3
><DIV
CLASS="informaltable"
><P
></P
><A
NAME="AEN17339"
></A
><TABLE
BORDER="0"
FRAME="void"
RULES="none"
WIDTH="100%"
CLASS="CALSTABLE"
><COL
WIDTH="17%"
TITLE="c1"><COL
WIDTH="83%"
TITLE="c2"><TBODY
VALIGN="top"
><TR
><TD
>&#13;                <SPAN
CLASS="errorname"
>E_OK</SPAN
>
              </TD
><TD
>正常終了</TD
></TR
><TR
><TD
>&#13;                <SPAN
CLASS="errorname"
>E_CTX</SPAN
>
              </TD
><TD
>コンテキストエラー(タスク独立部から発行)</TD
></TR
></TBODY
></TABLE
><P
></P
></DIV
></DIV
><DIV
CLASS="section"
><H3
CLASS="section"
><A
NAME="AEN17352"
>利用可能なコンテキスト</A
></H3
><DIV
CLASS="informaltable"
><P
></P
><A
NAME="AEN17354"
></A
><TABLE
BORDER="1"
FRAME="border"
RULES="all"
WIDTH="100%"
CLASS="CALSTABLE"
><COL
WIDTH="33%"><COL
WIDTH="33%"><COL
WIDTH="33%"><THEAD
><TR
><TH
ALIGN="center"
>タスク部</TH
><TH
ALIGN="center"
>準タスク部</TH
><TH
ALIGN="center"
>タスク独立部</TH
></TR
></THEAD
><TBODY
VALIGN="top"
><TR
><TD
ALIGN="center"
>○</TD
><TD
ALIGN="center"
>○</TD
><TD
ALIGN="center"
>×</TD
></TR
></TBODY
></TABLE
><P
></P
></DIV
></DIV
><DIV
CLASS="section"
><H3
CLASS="section"
><A
NAME="AEN17369"
>関連するサービスプロファイル</A
></H3
><P
>なし</P
></DIV
><DIV
CLASS="section"
><H3
CLASS="section"
><A
NAME="AEN17372"
>解説</A
></H3
><P
>タスクのディスパッチを許可する。すなわち、<A
HREF="system_management_functions.html#tk_dis_dsp"
>tk_dis_dsp</A
> によって設定されていたディスパッチ禁止状態を解除する。</P
><P
>ディスパッチ禁止状態ではないタスクが <A
HREF="system_management_functions.html#tk_ena_dsp"
>tk_ena_dsp</A
> を発行した場合は、ディスパッチを許可した状態がそのまま継続するだけで、エラーとはならない。</P
></DIV
></DIV
><DIV
CLASS="section"
><H2
CLASS="section"
><A
NAME="tk_ref_sys"
>tk_ref_sys - システム状態参照</A
></H2
><DIV
CLASS="section"
><H3
CLASS="section"
><A
NAME="AEN17380"
>C言語インタフェース</A
></H3
><DIV
CLASS="funcsynopsis"
><P
></P
><A
NAME="AEN17382"
></A
><PRE
CLASS="funcsynopsisinfo"
>#include &#60;tk/tkernel.h&#62;</PRE
><P
><CODE
><CODE
CLASS="FUNCDEF"
>ER ercd = tk_ref_sys</CODE
>(T_RSYS *pk_rsys);</CODE
></P
><P
></P
></DIV
></DIV
><DIV
CLASS="section"
><H3
CLASS="section"
><A
NAME="AEN17389"
>パラメータ</A
></H3
><DIV
CLASS="informaltable"
><P
></P
><A
NAME="AEN17391"
></A
><TABLE
BORDER="0"
FRAME="void"
RULES="none"
WIDTH="100%"
CLASS="CALSTABLE"
><COL
WIDTH="8%"
TITLE="c1"><COL
WIDTH="17%"
TITLE="c2"><COL
WIDTH="33%"
TITLE="c3"><COL
WIDTH="42%"
TITLE="c4"><TBODY
VALIGN="top"
><TR
><TD
>T_RSYS*</TD
><TD
>&#13;                <CODE
CLASS="varname"
>pk_rsys</CODE
>
              </TD
><TD
>Packet to Refer System Status</TD
><TD
>システム状態を返す領域へのポインタ</TD
></TR
></TBODY
></TABLE
><P
></P
></DIV
></DIV
><DIV
CLASS="section"
><H3
CLASS="section"
><A
NAME="AEN17404"
>リターンパラメータ</A
></H3
><DIV
CLASS="informaltable"
><P
></P
><A
NAME="AEN17406"
></A
><TABLE
BORDER="0"
FRAME="void"
RULES="none"
WIDTH="100%"
CLASS="CALSTABLE"
><COL
WIDTH="8%"
TITLE="c1"><COL
WIDTH="17%"
TITLE="c2"><COL
WIDTH="33%"
TITLE="c3"><COL
WIDTH="42%"
TITLE="c4"><TBODY
VALIGN="top"
><TR
><TD
>ER</TD
><TD
>&#13;                <CODE
CLASS="varname"
>ercd</CODE
>
              </TD
><TD
>Error Code</TD
><TD
>エラーコード</TD
></TR
></TBODY
></TABLE
><P
></P
></DIV
><P
><CODE
CLASS="varname"
>pk_rsys</CODE
> の内容</P
><DIV
CLASS="informaltable"
><P
></P
><A
NAME="AEN17421"
></A
><TABLE
BORDER="0"
FRAME="void"
RULES="none"
WIDTH="100%"
CLASS="CALSTABLE"
><COL
WIDTH="8%"
TITLE="c1"><COL
WIDTH="17%"
TITLE="c2"><COL
WIDTH="33%"
TITLE="c3"><COL
WIDTH="42%"
TITLE="c4"><TBODY
VALIGN="top"
><TR
><TD
>UINT</TD
><TD
>&#13;                <CODE
CLASS="varname"
>sysstat</CODE
>
              </TD
><TD
>System State</TD
><TD
>システム状態</TD
></TR
><TR
><TD
>ID</TD
><TD
>&#13;                <CODE
CLASS="varname"
>runtskid</CODE
>
              </TD
><TD
>Running Task ID</TD
><TD
>現在実行状態にあるタスクのID</TD
></TR
><TR
><TD
>ID</TD
><TD
>&#13;                <CODE
CLASS="varname"
>schedtskid</CODE
>
              </TD
><TD
>Scheduled Task ID</TD
><TD
>実行状態にすべきタスクのID</TD
></TR
><TR
><TD
COLSPAN="4"
>──(以下に実装独自に他の情報を追加してもよい)──</TD
></TR
></TBODY
></TABLE
><P
></P
></DIV
></DIV
><DIV
CLASS="section"
><H3
CLASS="section"
><A
NAME="AEN17448"
>エラーコード</A
></H3
><DIV
CLASS="informaltable"
><P
></P
><A
NAME="AEN17450"
></A
><TABLE
BORDER="0"
FRAME="void"
RULES="none"
WIDTH="100%"
CLASS="CALSTABLE"
><COL
WIDTH="17%"
TITLE="c1"><COL
WIDTH="83%"
TITLE="c2"><TBODY
VALIGN="top"
><TR
><TD
>&#13;                <SPAN
CLASS="errorname"
>E_OK</SPAN
>
              </TD
><TD
>正常終了</TD
></TR
><TR
><TD
>&#13;                <SPAN
CLASS="errorname"
>E_PAR</SPAN
>
              </TD
><TD
>パラメータエラー(<CODE
CLASS="varname"
>pk_rsys</CODE
> が不正)</TD
></TR
></TBODY
></TABLE
><P
></P
></DIV
></DIV
><DIV
CLASS="section"
><H3
CLASS="section"
><A
NAME="AEN17464"
>利用可能なコンテキスト</A
></H3
><DIV
CLASS="informaltable"
><P
></P
><A
NAME="AEN17466"
></A
><TABLE
BORDER="1"
FRAME="border"
RULES="all"
WIDTH="100%"
CLASS="CALSTABLE"
><COL
WIDTH="33%"><COL
WIDTH="33%"><COL
WIDTH="33%"><THEAD
><TR
><TH
ALIGN="center"
>タスク部</TH
><TH
ALIGN="center"
>準タスク部</TH
><TH
ALIGN="center"
>タスク独立部</TH
></TR
></THEAD
><TBODY
VALIGN="top"
><TR
><TD
ALIGN="center"
>○</TD
><TD
ALIGN="center"
>○</TD
><TD
ALIGN="center"
>○</TD
></TR
></TBODY
></TABLE
><P
></P
></DIV
></DIV
><DIV
CLASS="section"
><H3
CLASS="section"
><A
NAME="AEN17481"
>関連するサービスプロファイル</A
></H3
><P
>なし</P
></DIV
><DIV
CLASS="section"
><H3
CLASS="section"
><A
NAME="AEN17484"
>解説</A
></H3
><P
>実行状態を参照し、ディスパッチ禁止中、タスク独立部実行中などといった情報をリターンパラメータとして返す。</P
><P
><CODE
CLASS="varname"
>sysstat</CODE
> は次のような値をとる。</P
><PRE
CLASS="synopsis"
>&#13;sysstat := ( TSS_TSK  | [TSS_DDSP] | [TSS_DINT] )
           || ( TSS_QTSK | [TSS_DDSP] | [TSS_DINT] )
           || ( TSS_INDP )
</PRE
><DIV
CLASS="informaltable"
><P
></P
><A
NAME="AEN17490"
></A
><TABLE
BORDER="0"
FRAME="void"
RULES="none"
WIDTH="100%"
CLASS="CALSTABLE"
><COL
WIDTH="14%"
TITLE="c1"><COL
WIDTH="14%"
TITLE="c2"><COL
WIDTH="71%"><TBODY
VALIGN="top"
><TR
><TD
>&#13;                <TT
CLASS="literal"
>TSS_TSK</TT
>
              </TD
><TD
>0</TD
><TD
>タスク部実行中</TD
></TR
><TR
><TD
>&#13;                <TT
CLASS="literal"
>TSS_DDSP</TT
>
              </TD
><TD
>1</TD
><TD
>ディスパッチ禁止中</TD
></TR
><TR
><TD
>&#13;                <TT
CLASS="literal"
>TSS_DINT</TT
>
              </TD
><TD
>2</TD
><TD
>割込み禁止中</TD
></TR
><TR
><TD
>&#13;                <TT
CLASS="literal"
>TSS_INDP</TT
>
              </TD
><TD
>4</TD
><TD
>タスク独立部実行中</TD
></TR
><TR
><TD
>&#13;                <TT
CLASS="literal"
>TSS_QTSK</TT
>
              </TD
><TD
>8</TD
><TD
>準タスク部実行中</TD
></TR
></TBODY
></TABLE
><P
></P
></DIV
><P
><CODE
CLASS="varname"
>runtskid</CODE
> には現在実行中のタスクのID、<CODE
CLASS="varname"
>schedtskid</CODE
> には実行状態にすべきタスクのIDが返される。通常は <CODE
CLASS="varname"
>runtskid</CODE
>＝<CODE
CLASS="varname"
>schedtskid</CODE
> となるが、ディスパッチ禁止中により優先度の高いタスクが起床された場合などに <CODE
CLASS="varname"
>runtskid</CODE
>≠<CODE
CLASS="varname"
>schedtskid</CODE
> となる場合がある。なお、該当タスクがない場合は0を返す。</P
><P
>割込みハンドラやタイムイベントハンドラからも発行できなければならない。</P
></DIV
><DIV
CLASS="section"
><H3
CLASS="section"
><A
NAME="AEN17529"
>補足事項</A
></H3
><P
><A
HREF="system_management_functions.html#tk_ref_sys"
>tk_ref_sys</A
> で返される情報は、カーネルの実装によっては、必ずしも常に正しい情報を返すとは限らない。</P
></DIV
></DIV
><DIV
CLASS="section"
><H2
CLASS="section"
><A
NAME="tk_set_pow"
>tk_set_pow - 省電力モード設定</A
></H2
><DIV
CLASS="section"
><H3
CLASS="section"
><A
NAME="AEN17535"
>C言語インタフェース</A
></H3
><DIV
CLASS="funcsynopsis"
><P
></P
><A
NAME="AEN17537"
></A
><PRE
CLASS="funcsynopsisinfo"
>#include &#60;tk/tkernel.h&#62;</PRE
><P
><CODE
><CODE
CLASS="FUNCDEF"
>ER ercd = tk_set_pow</CODE
>(UINT powmode);</CODE
></P
><P
></P
></DIV
></DIV
><DIV
CLASS="section"
><H3
CLASS="section"
><A
NAME="AEN17544"
>パラメータ</A
></H3
><DIV
CLASS="informaltable"
><P
></P
><A
NAME="AEN17546"
></A
><TABLE
BORDER="0"
FRAME="void"
RULES="none"
WIDTH="100%"
CLASS="CALSTABLE"
><COL
WIDTH="8%"
TITLE="c1"><COL
WIDTH="17%"
TITLE="c2"><COL
WIDTH="33%"
TITLE="c3"><COL
WIDTH="42%"
TITLE="c4"><TBODY
VALIGN="top"
><TR
><TD
>UINT</TD
><TD
>&#13;                <CODE
CLASS="varname"
>powmode</CODE
>
              </TD
><TD
>Power Mode</TD
><TD
>省電力モード</TD
></TR
></TBODY
></TABLE
><P
></P
></DIV
></DIV
><DIV
CLASS="section"
><H3
CLASS="section"
><A
NAME="AEN17559"
>リターンパラメータ</A
></H3
><DIV
CLASS="informaltable"
><P
></P
><A
NAME="AEN17561"
></A
><TABLE
BORDER="0"
FRAME="void"
RULES="none"
WIDTH="100%"
CLASS="CALSTABLE"
><COL
WIDTH="8%"
TITLE="c1"><COL
WIDTH="17%"
TITLE="c2"><COL
WIDTH="33%"
TITLE="c3"><COL
WIDTH="42%"
TITLE="c4"><TBODY
VALIGN="top"
><TR
><TD
>ER</TD
><TD
>&#13;                <CODE
CLASS="varname"
>ercd</CODE
>
              </TD
><TD
>Error Code</TD
><TD
>エラーコード</TD
></TR
></TBODY
></TABLE
><P
></P
></DIV
></DIV
><DIV
CLASS="section"
><H3
CLASS="section"
><A
NAME="AEN17574"
>エラーコード</A
></H3
><DIV
CLASS="informaltable"
><P
></P
><A
NAME="AEN17576"
></A
><TABLE
BORDER="0"
FRAME="void"
RULES="none"
WIDTH="100%"
CLASS="CALSTABLE"
><COL
WIDTH="17%"
TITLE="c1"><COL
WIDTH="83%"
TITLE="c2"><TBODY
VALIGN="top"
><TR
><TD
>&#13;                <SPAN
CLASS="errorname"
>E_OK</SPAN
>
              </TD
><TD
>正常終了</TD
></TR
><TR
><TD
>&#13;                <SPAN
CLASS="errorname"
>E_PAR</SPAN
>
              </TD
><TD
>パラメータエラー(<CODE
CLASS="varname"
>powmode</CODE
> が使用できない値)</TD
></TR
><TR
><TD
>&#13;                <SPAN
CLASS="errorname"
>E_QOVR</SPAN
>
              </TD
><TD
>低消費電力モード切替禁止カウントのオーバーフロー</TD
></TR
><TR
><TD
>&#13;                <SPAN
CLASS="errorname"
>E_OBJ</SPAN
>
              </TD
><TD
>低消費電力モード切替禁止カウントが0の状態で更に <TT
CLASS="literal"
>TPW_ENALOWPOW</TT
> を要求した</TD
></TR
></TBODY
></TABLE
><P
></P
></DIV
></DIV
><DIV
CLASS="section"
><H3
CLASS="section"
><A
NAME="AEN17599"
>利用可能なコンテキスト</A
></H3
><DIV
CLASS="informaltable"
><P
></P
><A
NAME="AEN17601"
></A
><TABLE
BORDER="1"
FRAME="border"
RULES="all"
WIDTH="100%"
CLASS="CALSTABLE"
><COL
WIDTH="33%"><COL
WIDTH="33%"><COL
WIDTH="33%"><THEAD
><TR
><TH
ALIGN="center"
>タスク部</TH
><TH
ALIGN="center"
>準タスク部</TH
><TH
ALIGN="center"
>タスク独立部</TH
></TR
></THEAD
><TBODY
VALIGN="top"
><TR
><TD
ALIGN="center"
>○</TD
><TD
ALIGN="center"
>○</TD
><TD
ALIGN="center"
>×</TD
></TR
></TBODY
></TABLE
><P
></P
></DIV
></DIV
><DIV
CLASS="section"
><H3
CLASS="section"
><A
NAME="AEN17616"
>関連するサービスプロファイル</A
></H3
><P
>以下のサービスプロファイルが有効に設定されている場合に限り、本システムコールはサポートされる。</P
><DIV
CLASS="informaltable"
><P
></P
><A
NAME="AEN17619"
></A
><TABLE
BORDER="0"
FRAME="void"
RULES="none"
WIDTH="100%"
CLASS="CALSTABLE"
><COL
WIDTH="38%"
TITLE="c1"><COL
WIDTH="62%"><TBODY
VALIGN="top"
><TR
><TD
>&#13;                <TT
CLASS="literal"
>TK_SUPPORT_LOWPOWER</TT
>
              </TD
><TD
>省電力機能のサポート</TD
></TR
></TBODY
></TABLE
><P
></P
></DIV
></DIV
><DIV
CLASS="section"
><H3
CLASS="section"
><A
NAME="AEN17628"
>解説</A
></H3
><P
>省電力機能は、次の2つの機能からなる。</P
><P
></P
><DIV
CLASS="variablelist"
><DL
><DT
>●アイドル(無負荷)中の消費電力低減</DT
><DD
><P
>実行すべきタスクがない状態のとき、ハードウェアに用意されている低消費電力モードに切り替える。</P
><P
>低消費電力モードは、タイマ割込みから次のタイマ割込みの間のようにごく短い時間の電力消費を抑えるための機能で、CPUのクロック周波数を下げることなどにより行われる。したがって、ソフトウェアによる複雑なモード切替を必要とせず、主にハードウェアの機能によって実現される。</P
></DD
><DT
>●自動電源オフ</DT
><DD
><P
>オペレータが何も操作しない状態が一定時間以上続いた場合、自動的に電源を切りサスペンド状態に移行する。周辺機器からの起動要求(割込みなど)またはオペレータが電源を入れることによりリジュームされ、電源が切れたときの状態に復帰する。</P
><P
>また、バッテリー切れなどの電源異常によっても、自動的に電源を切りサスペンド状態に移行する。</P
><P
>サスペンド中は、周辺機器や周辺回路およびCPUの電源が切れる。しかし、メインメモリの内容は保持される。</P
></DD
></DL
></DIV
><P
><A
HREF="system_management_functions.html#tk_set_pow"
>tk_set_pow</A
> は、省電力モードの設定を行う。</P
><PRE
CLASS="synopsis"
>&#13;powmode:= ( TPW_DOSUSPEND || TPW_DISLOWPOW || TPW_ENALOWPOW )
</PRE
><PRE
CLASS="programlisting"
>&#13;#define TPW_DOSUSPEND   1       サスペンド状態へ移行
#define TPW_DISLOWPOW   2       低消費電力モード切替禁止
#define TPW_ENALOWPOW   3       低消費電力モード切替許可(デフォルト)
</PRE
><P
></P
><UL
><LI
><P
>&#13;            <TT
CLASS="literal"
>TPW_DOSUSPEND</TT
>
          </P
><P
>すべてのタスク及びハンドラの実行を停止し、周辺回路(タイマや割込みコントローラ)を停止し、電源を切る(サスペンドする)。(<A
HREF="power_management_functions.html#off_pow"
>off_pow</A
> を呼び出す)</P
><P
>電源オンされたら、周辺回路の再起動をし、すべてのタスク及びハンドラの実行を再開して、電源を切る前の状態に復帰(リジューム)し、リターンする。</P
><P
>何らかの理由によりリジュームに失敗したときには、通常(リセット時)のスタートアップ処理を行い、新たにシステムを立ち上げなおす。</P
></LI
><LI
><P
>&#13;            <TT
CLASS="literal"
>TPW_DISLOWPOW</TT
>
          </P
><P
>ディスパッチャ内で行われる低消費電力モードへの切替を禁止する。(<A
HREF="power_management_functions.html#low_pow"
>low_pow</A
> を呼び出さない)</P
></LI
><LI
><P
>&#13;            <TT
CLASS="literal"
>TPW_ENALOWPOW</TT
>
          </P
><P
>ディスパッチャ内で行われる低消費電力モードへの切替を許可する。(<A
HREF="power_management_functions.html#low_pow"
>low_pow</A
> を呼び出す)</P
></LI
></UL
><P
>起動時のデフォルトは切替許可(<TT
CLASS="literal"
>TPW_ENALOWPOW</TT
>)となる。</P
><P
><TT
CLASS="literal"
>TPW_DISLOWPOW</TT
> が指定された場合、その要求回数がカウントされる。<TT
CLASS="literal"
>TPW_DISLOWPOW</TT
> が要求された回数と同じだけ <TT
CLASS="literal"
>TPW_ENALOWPOW</TT
> が要求されないと、低消費電力モードは許可されない。要求カウント数の最大値は実装定義だが、少なくとも255回以上カウントできなければならない。</P
></DIV
><DIV
CLASS="section"
><H3
CLASS="section"
><A
NAME="AEN17671"
>補足事項</A
></H3
><P
><A
HREF="power_management_functions.html#off_pow"
>off_pow</A
>, <A
HREF="power_management_functions.html#low_pow"
>low_pow</A
> はμT-Kernel/SMの機能である。詳細は <A
HREF="power_management_functions.html"
><I
>省電力機能</I
>項<I
>μT-Kernel/SMの機能</I
>章</A
> を参照のこと。</P
><P
>μT-Kernelでは、電源異常などのサスペンド移行要因の検出は行わない。また、実際にサスペンドするためには、各周辺機器(デバイスドライバ)のサスペンド処理も必要である。サスペンドするには <A
HREF="system_management_functions.html#tk_set_pow"
>tk_set_pow</A
> を直接呼び出すのではなく、μT-Kernel/SMのサスペンド機能を利用する。</P
></DIV
></DIV
><DIV
CLASS="section"
><H2
CLASS="section"
><A
NAME="tk_ref_ver"
>tk_ref_ver - バージョン参照</A
></H2
><DIV
CLASS="section"
><H3
CLASS="section"
><A
NAME="AEN17681"
>C言語インタフェース</A
></H3
><DIV
CLASS="funcsynopsis"
><P
></P
><A
NAME="AEN17683"
></A
><PRE
CLASS="funcsynopsisinfo"
>#include &#60;tk/tkernel.h&#62;</PRE
><P
><CODE
><CODE
CLASS="FUNCDEF"
>ER ercd = tk_ref_ver</CODE
>(T_RVER *pk_rver);</CODE
></P
><P
></P
></DIV
></DIV
><DIV
CLASS="section"
><H3
CLASS="section"
><A
NAME="AEN17690"
>パラメータ</A
></H3
><DIV
CLASS="informaltable"
><P
></P
><A
NAME="AEN17692"
></A
><TABLE
BORDER="0"
FRAME="void"
RULES="none"
WIDTH="100%"
CLASS="CALSTABLE"
><COL
WIDTH="8%"
TITLE="c1"><COL
WIDTH="17%"
TITLE="c2"><COL
WIDTH="33%"
TITLE="c3"><COL
WIDTH="42%"
TITLE="c4"><TBODY
VALIGN="top"
><TR
><TD
>T_RVER*</TD
><TD
>&#13;                <CODE
CLASS="varname"
>pk_rver</CODE
>
              </TD
><TD
>Packet to Refer Version Information</TD
><TD
>バージョン情報を返す領域へのポインタ</TD
></TR
></TBODY
></TABLE
><P
></P
></DIV
></DIV
><DIV
CLASS="section"
><H3
CLASS="section"
><A
NAME="AEN17705"
>リターンパラメータ</A
></H3
><DIV
CLASS="informaltable"
><P
></P
><A
NAME="AEN17707"
></A
><TABLE
BORDER="0"
FRAME="void"
RULES="none"
WIDTH="100%"
CLASS="CALSTABLE"
><COL
WIDTH="8%"><COL
WIDTH="17%"><COL
WIDTH="33%"><COL
WIDTH="42%"><TBODY
VALIGN="top"
><TR
><TD
>ER</TD
><TD
>&#13;                <CODE
CLASS="varname"
>ercd</CODE
>
              </TD
><TD
>Error Code</TD
><TD
>エラーコード</TD
></TR
></TBODY
></TABLE
><P
></P
></DIV
><P
><CODE
CLASS="varname"
>pk_rver</CODE
> の内容</P
><DIV
CLASS="informaltable"
><P
></P
><A
NAME="AEN17722"
></A
><TABLE
BORDER="0"
FRAME="void"
RULES="none"
WIDTH="100%"
CLASS="CALSTABLE"
><COL
WIDTH="8%"
TITLE="c1"><COL
WIDTH="17%"
TITLE="c2"><COL
WIDTH="33%"
TITLE="c3"><COL
WIDTH="42%"
TITLE="c4"><TBODY
VALIGN="top"
><TR
><TD
>UH</TD
><TD
>&#13;                <CODE
CLASS="varname"
>maker</CODE
>
              </TD
><TD
>Maker Code</TD
><TD
>カーネルのメーカコード</TD
></TR
><TR
><TD
>UH</TD
><TD
>&#13;                <CODE
CLASS="varname"
>prid</CODE
>
              </TD
><TD
>Product ID</TD
><TD
>カーネルの識別番号</TD
></TR
><TR
><TD
>UH</TD
><TD
>&#13;                <CODE
CLASS="varname"
>spver</CODE
>
              </TD
><TD
>Specification Version</TD
><TD
>仕様書バージョン番号</TD
></TR
><TR
><TD
>UH</TD
><TD
>&#13;                <CODE
CLASS="varname"
>prver</CODE
>
              </TD
><TD
>Product Version</TD
><TD
>カーネルのバージョン番号</TD
></TR
><TR
><TD
>UH</TD
><TD
>&#13;                <CODE
CLASS="varname"
>prno[4]</CODE
>
              </TD
><TD
>Product Number</TD
><TD
>カーネル製品の管理情報</TD
></TR
></TBODY
></TABLE
><P
></P
></DIV
></DIV
><DIV
CLASS="section"
><H3
CLASS="section"
><A
NAME="AEN17759"
>エラーコード</A
></H3
><DIV
CLASS="informaltable"
><P
></P
><A
NAME="AEN17761"
></A
><TABLE
BORDER="0"
FRAME="void"
RULES="none"
WIDTH="100%"
CLASS="CALSTABLE"
><COL
WIDTH="17%"
TITLE="c1"><COL
WIDTH="83%"
TITLE="c2"><TBODY
VALIGN="top"
><TR
><TD
>&#13;                <SPAN
CLASS="errorname"
>E_OK</SPAN
>
              </TD
><TD
>正常終了</TD
></TR
><TR
><TD
>&#13;                <SPAN
CLASS="errorname"
>E_PAR</SPAN
>
              </TD
><TD
>パラメータエラー(<CODE
CLASS="varname"
>pk_rver</CODE
> が不正)</TD
></TR
></TBODY
></TABLE
><P
></P
></DIV
></DIV
><DIV
CLASS="section"
><H3
CLASS="section"
><A
NAME="AEN17775"
>利用可能なコンテキスト</A
></H3
><DIV
CLASS="informaltable"
><P
></P
><A
NAME="AEN17777"
></A
><TABLE
BORDER="1"
FRAME="border"
RULES="all"
WIDTH="100%"
CLASS="CALSTABLE"
><COL
WIDTH="33%"><COL
WIDTH="33%"><COL
WIDTH="33%"><THEAD
><TR
><TH
ALIGN="center"
>タスク部</TH
><TH
ALIGN="center"
>準タスク部</TH
><TH
ALIGN="center"
>タスク独立部</TH
></TR
></THEAD
><TBODY
VALIGN="top"
><TR
><TD
ALIGN="center"
>○</TD
><TD
ALIGN="center"
>○</TD
><TD
ALIGN="center"
>×</TD
></TR
></TBODY
></TABLE
><P
></P
></DIV
></DIV
><DIV
CLASS="section"
><H3
CLASS="section"
><A
NAME="AEN17792"
>関連するサービスプロファイル</A
></H3
><P
>なし</P
></DIV
><DIV
CLASS="section"
><H3
CLASS="section"
><A
NAME="AEN17795"
>解説</A
></H3
><P
>使用しているカーネルのバージョン情報を参照し、<CODE
CLASS="varname"
>pk_rver</CODE
>で指定されるパケットに返す。具体的には、次の情報を参照することができる。</P
><P
><CODE
CLASS="varname"
>maker</CODE
> は、このカーネルを実装したμT-Kernel提供者のコードである。<CODE
CLASS="varname"
>maker</CODE
> のフォーマットを[<A
HREF="system_management_functions.html#figure_a_tk_ref_ver"
>図7</A
>]に示す。</P
><DIV
CLASS="figure"
><A
NAME="figure_a_tk_ref_ver"
></A
><P
><B
>図 7. <CODE
CLASS="varname"
>maker</CODE
> のフォーマット</B
></P
><DIV
CLASS="mediaobject"
><P
><IMG
SRC="images/f_16_as.png"></P
></DIV
></DIV
><P
><CODE
CLASS="varname"
>prid</CODE
> は、カーネルの種類を区別するための番号である。<CODE
CLASS="varname"
>prid</CODE
> のフォーマットを[<A
HREF="system_management_functions.html#figure_b_tk_ref_ver"
>図8</A
>]に示す。</P
><P
><CODE
CLASS="varname"
>prid</CODE
>の具体的な値の割付けは、カーネルを実装したμT-Kernel提供者に任される。ただし、製品の区別はあくまでもこの番号のみで行うので、各μT-Kernel提供者において番号の付け方を十分に検討した上、体系づけて使用するようにしなければならない。したがって、 <CODE
CLASS="varname"
>maker</CODE
> と <CODE
CLASS="varname"
>prid</CODE
> の組でカーネルの種類を一意に識別することができる。</P
><P
>μT-Kernelのリファレンスコードは、トロンフォーラムから提供され、その <CODE
CLASS="varname"
>maker</CODE
> と <CODE
CLASS="varname"
>prid</CODE
> は次のようになる。
<PRE
CLASS="synopsis"
>&#13;maker   = 0x0000
prid    = 0x0000
</PRE
>
</P
><DIV
CLASS="figure"
><A
NAME="figure_b_tk_ref_ver"
></A
><P
><B
>図 8. <CODE
CLASS="varname"
>prid</CODE
> のフォーマット</B
></P
><DIV
CLASS="mediaobject"
><P
><IMG
SRC="images/f_16_bs.png"></P
></DIV
></DIV
><P
><CODE
CLASS="varname"
>spver</CODE
> では、上位4ビットでOS仕様の種類と、下位12ビットでカーネルが準拠する仕様のバージョン番号を表す。<CODE
CLASS="varname"
>spver</CODE
> のフォーマットを[<A
HREF="system_management_functions.html#figure_c_tk_ref_ver"
>図9</A
>]に示す。</P
><P
>たとえばμT-Kernelの Ver 3.01.xx の仕様書に対応する <CODE
CLASS="varname"
>spver</CODE
> は次のようになる。</P
><PRE
CLASS="synopsis"
>&#13;MAGIC   = 0x6           (μT-Kernel)
SpecVer = 0x301         (Ver 3.01)
spver   = 0x6301
</PRE
><P
>また、μT-Kernel仕様書のドラフト版であるVer 3.B0.xxの仕様書に対応する <CODE
CLASS="varname"
>spver</CODE
> は次のようになる。</P
><PRE
CLASS="synopsis"
>&#13;MAGIC   = 0x6           (μT-Kernel)
SpecVer = 0x3B0         (Ver 3.B0)
spver   = 0x63B0
</PRE
><DIV
CLASS="figure"
><A
NAME="figure_c_tk_ref_ver"
></A
><P
><B
>図 9. <CODE
CLASS="varname"
>spver</CODE
> のフォーマット</B
></P
><DIV
CLASS="mediaobject"
><P
><IMG
SRC="images/f_16_cs.png"></P
></DIV
></DIV
><P
></P
><DIV
CLASS="variablelist"
><DL
><DT
><TT
CLASS="literal"
>MAGIC</TT
>:</DT
><DD
><P
>OS仕様の種類</P
><DIV
CLASS="informaltable"
><P
></P
><A
NAME="AEN17858"
></A
><TABLE
BORDER="0"
FRAME="void"
RULES="none"
WIDTH="100%"
CLASS="CALSTABLE"
><COL
WIDTH="17%"
TITLE="c1"><COL
WIDTH="83%"><TBODY
VALIGN="top"
><TR
><TD
>0x0</TD
><TD
>TRON共通 (TAD等)</TD
></TR
><TR
><TD
>0x1</TD
><TD
>reserved</TD
></TR
><TR
><TD
>0x2</TD
><TD
>reserved</TD
></TR
><TR
><TD
>0x3</TD
><TD
>reserved</TD
></TR
><TR
><TD
>0x4</TD
><TD
>reserved</TD
></TR
><TR
><TD
>0x5</TD
><TD
>reserved</TD
></TR
><TR
><TD
>0x6</TD
><TD
>μT-Kernel</TD
></TR
><TR
><TD
>0x7</TD
><TD
>T-Kernel</TD
></TR
></TBODY
></TABLE
><P
></P
></DIV
></DD
><DT
><TT
CLASS="literal"
>SpecVer</TT
>:</DT
><DD
><P
>カーネルが準拠する仕様のバージョン番号。3桁のパックト形式BCDコードで入れる。ドラフトの仕様書の場合は、上から2桁目がA, B, Cとなる場合もある。この場合は、対応する16進数のA, B, Cを入れる。</P
></DD
></DL
></DIV
><P
><CODE
CLASS="varname"
>prver</CODE
>は、カーネル実装上のバージョン番号を表す。<CODE
CLASS="varname"
>prver</CODE
> の具体的な値の割付けは、カーネルを実装したT-Kernel提供者に任される。</P
><P
><CODE
CLASS="varname"
>prno</CODE
> は、カーネル製品の管理情報や製品番号などを入れるために使用するためのリターンパラメータである。<CODE
CLASS="varname"
>prno</CODE
> の具体的な値の意味は、カーネルを実装したT-Kernel提供者に任される。</P
></DIV
><DIV
CLASS="section"
><H3
CLASS="section"
><A
NAME="AEN17898"
>補足事項</A
></H3
><P
>バージョン情報を得るためのパケットの形式や構造体の各メンバのフォーマットの仕様は、T-KernelやμT-Kernelの各バージョンの間でほぼ共通になっている。</P
><P
><A
HREF="system_management_functions.html#tk_ref_ver"
>tk_ref_ver</A
> の <TT
CLASS="literal"
>SpecVer</TT
> として得られるのは仕様書のバージョン番号の上位3桁であるが、これより下位の桁はミスプリントの修正などといった表記上の変更を表す桁なので、<A
HREF="system_management_functions.html#tk_ref_ver"
>tk_ref_ver</A
> で得られる情報には含めていない。仕様書の内容との対応という意味では、仕様書のバージョン番号の上位3桁を知ることで必要十分である。</P
><P
>ドラフト版の仕様書を対象として実装されたカーネルでは、<TT
CLASS="literal"
>SpecVer</TT
> の2桁目がA, B, Cとなることがある。この場合、仕様書のリリース順序と <TT
CLASS="literal"
>SpecVer</TT
> の大小関係が必ずしも一致しないので、注意が必要である。仕様書のリリース順は、たとえばVer 2.A1→Ver 2.A2→Ver 2.B1→Ver 2.C1→Ver 2.00→Ver 2.01→... となるが、<TT
CLASS="literal"
>SpecVer</TT
> の大小関係はドラフト版から正式版に移る部分(Ver 2.Cx→Ver 2.00の部分)で逆転する。</P
></DIV
></DIV
></DIV
><DIV
CLASS="NAVFOOTER"
><HR
ALIGN="LEFT"
WIDTH="100%"><TABLE
SUMMARY="Footer navigation table"
WIDTH="100%"
BORDER="0"
CELLPADDING="0"
CELLSPACING="0"
><TR
><TD
WIDTH="33%"
ALIGN="left"
VALIGN="top"
><A
HREF="interrupt_management_functions_os.html"
ACCESSKEY="P"
>前のページ</A
></TD
><TD
WIDTH="34%"
ALIGN="center"
VALIGN="top"
><A
HREF="index.html"
ACCESSKEY="H"
>ホーム</A
></TD
><TD
WIDTH="33%"
ALIGN="right"
VALIGN="top"
><A
HREF="subsystem_management_functions.html"
ACCESSKEY="N"
>次のページ</A
></TD
></TR
><TR
><TD
WIDTH="33%"
ALIGN="left"
VALIGN="top"
>割込み管理機能</TD
><TD
WIDTH="34%"
ALIGN="center"
VALIGN="top"
><A
HREF="utk_os_functions.html"
ACCESSKEY="U"
>上に戻る</A
></TD
><TD
WIDTH="33%"
ALIGN="right"
VALIGN="top"
>サブシステム管理機能</TD
></TR
></TABLE
></DIV
></BODY
></HTML
>