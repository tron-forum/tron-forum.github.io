<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN""http://www.w3.org/TR/html4/loose.dtd">
<HTML
><HEAD
><TITLE
>省電力機能</TITLE
><META
NAME="GENERATOR"
CONTENT="Modular DocBook HTML Stylesheet Version 1.79"><LINK
REL="HOME"
TITLE="μT-Kernel 3.0仕様書"
HREF="index.html"><LINK
REL="UP"
TITLE="μT-Kernel/SMの機能"
HREF="utk_sm_functions.html"><LINK
REL="PREVIOUS"
TITLE="I/Oポートアクセスサポート機能"
HREF="io_port_management_functions.html"><LINK
REL="NEXT"
TITLE="システム構成情報管理機能"
HREF="system_configuration_information_management_functions.html"></HEAD
><BODY
CLASS="section"
BGCOLOR="#FFFFFF"
TEXT="#000000"
LINK="#0000FF"
VLINK="#840084"
ALINK="#0000FF"
><DIV
CLASS="NAVHEADER"
><TABLE
SUMMARY="Header navigation table"
WIDTH="100%"
BORDER="0"
CELLPADDING="0"
CELLSPACING="0"
><TR
><TH
COLSPAN="3"
ALIGN="center"
>μT-Kernel 3.0仕様書</TH
></TR
><TR
><TD
WIDTH="10%"
ALIGN="left"
VALIGN="bottom"
><A
HREF="io_port_management_functions.html"
ACCESSKEY="P"
>前のページ</A
></TD
><TD
WIDTH="80%"
ALIGN="center"
VALIGN="bottom"
>μT-Kernel/SMの機能</TD
><TD
WIDTH="10%"
ALIGN="right"
VALIGN="bottom"
><A
HREF="system_configuration_information_management_functions.html"
ACCESSKEY="N"
>次のページ</A
></TD
></TR
></TABLE
><HR
ALIGN="LEFT"
WIDTH="100%"></DIV
><DIV
CLASS="section"
><H1
CLASS="section"
><A
NAME="power_management_functions"
>省電力機能</A
></H1
><P
>省電力機能は、システムの省電力を実現するための機能である。μT-Kernel/OSの中からコールバック型の関数として呼び出される。</P
><P
>省電力機能で定義されるAPIには、<A
HREF="power_management_functions.html#low_pow"
>low_pow</A
>, <A
HREF="power_management_functions.html#off_pow"
>off_pow</A
> があるが、これらは参考仕様であり、μT-Kernel内部でのみ使用する。デバイスドライバ、ミドルウェア、アプリケーションなどが本機能を直接呼び出して使うことはないので、本機能やそのAPIを独自の仕様とすることにより、より高度な省電力機能を実現しても構わない。ただし、本機能の参考仕様として定義されるAPIと同等程度の機能を実装するのであれば、プログラムの再利用性を高める意味で、参考仕様に合わせる方が望ましい。</P
><P
>本機能のAPIの呼出方法についても、実装定義である。単純な関数呼出でもよいし、トラップを使用してもよい。また、μT-Kernel以外のプログラムの中にこれらの機能を用意してもよい。ただし、拡張SVCなどのμT-Kernelの機能を利用する呼出方法は使用できない。</P
><DIV
CLASS="section"
><H2
CLASS="section"
><A
NAME="low_pow"
>low_pow - システムを低消費電力モードに移行</A
></H2
><DIV
CLASS="section"
><H3
CLASS="section"
><A
NAME="AEN25304"
>C言語インタフェース</A
></H3
><DIV
CLASS="funcsynopsis"
><P
></P
><A
NAME="AEN25306"
></A
><P
><CODE
><CODE
CLASS="FUNCDEF"
>void low_pow</CODE
>(void);</CODE
></P
><P
></P
></DIV
></DIV
><DIV
CLASS="section"
><H3
CLASS="section"
><A
NAME="AEN25311"
>パラメータ</A
></H3
><P
>なし</P
></DIV
><DIV
CLASS="section"
><H3
CLASS="section"
><A
NAME="AEN25314"
>リターンパラメータ</A
></H3
><P
>なし</P
></DIV
><DIV
CLASS="section"
><H3
CLASS="section"
><A
NAME="AEN25317"
>エラーコード</A
></H3
><P
>なし</P
></DIV
><DIV
CLASS="section"
><H3
CLASS="section"
><A
NAME="AEN25320"
>利用可能なコンテキスト</A
></H3
><DIV
CLASS="informaltable"
><P
></P
><A
NAME="AEN25322"
></A
><TABLE
BORDER="1"
FRAME="border"
RULES="all"
WIDTH="100%"
CLASS="CALSTABLE"
><COL
WIDTH="33%"><COL
WIDTH="33%"><COL
WIDTH="33%"><THEAD
><TR
><TH
ALIGN="center"
>タスク部</TH
><TH
ALIGN="center"
>準タスク部</TH
><TH
ALIGN="center"
>タスク独立部</TH
></TR
></THEAD
><TBODY
VALIGN="top"
><TR
><TD
ALIGN="center"
>×</TD
><TD
ALIGN="center"
>×</TD
><TD
ALIGN="center"
>×</TD
></TR
></TBODY
></TABLE
><P
></P
></DIV
></DIV
><DIV
CLASS="section"
><H3
CLASS="section"
><A
NAME="AEN25337"
>関連するサービスプロファイル</A
></H3
><P
>以下のサービスプロファイルが有効に設定されている場合に限り、本APIはサポートされる。</P
><DIV
CLASS="informaltable"
><P
></P
><A
NAME="AEN25340"
></A
><TABLE
BORDER="0"
FRAME="void"
RULES="none"
WIDTH="100%"
CLASS="CALSTABLE"
><COL
WIDTH="38%"
TITLE="c1"><COL
WIDTH="62%"><TBODY
VALIGN="top"
><TR
><TD
>&#13;                <TT
CLASS="literal"
>TK_SUPPORT_LOWPOWER</TT
>
              </TD
><TD
>省電力機能のサポート</TD
></TR
></TBODY
></TABLE
><P
></P
></DIV
></DIV
><DIV
CLASS="section"
><H3
CLASS="section"
><A
NAME="AEN25349"
>解説</A
></H3
><P
>μT-Kernelのタスクディスパッチャの中から呼び出され、CPUのハードウェアを低消費電力モードに移行する処理を行う。</P
><P
>低消費電力モードに移行した後は、<A
HREF="power_management_functions.html#low_pow"
>low_pow</A
> の処理の中で外部割込みの発生を待ち、外部割込みが発生したら、CPU周辺のハードウェアを通常モード(低消費電力ではないモード)に戻す処理を行ってから、<A
HREF="power_management_functions.html#low_pow"
>low_pow</A
> の呼出元に復帰する。</P
><P
><A
HREF="power_management_functions.html#low_pow"
>low_pow</A
> の具体的な処理手順は以下の通りである。</P
><P
></P
><OL
TYPE="1"
><LI
><P
>CPUを低消費電力モードへ移行する。たとえば、クロック周波数を下げる。</P
></LI
><LI
><P
>外部割込みの発生を待ってCPUを停止する。たとえば、そのような機能を持つCPU命令を実行する。</P
></LI
><LI
><P
>外部割込みの発生によりCPUが実行を再開する。(ハードウェアによる処理)</P
></LI
><LI
><P
>CPUを通常モードに戻す。たとえば、通常のクロック周波数に戻す。</P
></LI
><LI
><P
>呼出元に復帰する。呼出元は、実際にはμT-Kernel内部のディスパッチャである。</P
></LI
></OL
><P
><A
HREF="power_management_functions.html#low_pow"
>low_pow</A
> の実装にあたっては、以下の点に注意する必要がある。</P
><P
></P
><UL
><LI
><P
>割込み禁止状態で呼び出される。</P
></LI
><LI
><P
>割込みを許可してはいけない。</P
></LI
><LI
><P
>処理速度が割込み応答速度に影響するので、できる限り高速であることが要求される。</P
></LI
></UL
></DIV
><DIV
CLASS="section"
><H3
CLASS="section"
><A
NAME="AEN25377"
>補足事項</A
></H3
><P
>タスクディスパッチャは、実行すべきタスクが無くなった場合に、消費電力を下げる目的で <A
HREF="power_management_functions.html#low_pow"
>low_pow</A
> を呼び出す。</P
></DIV
></DIV
><DIV
CLASS="section"
><H2
CLASS="section"
><A
NAME="off_pow"
>off_pow - システムをサスペンド状態に移行</A
></H2
><DIV
CLASS="section"
><H3
CLASS="section"
><A
NAME="AEN25383"
>C言語インタフェース</A
></H3
><DIV
CLASS="funcsynopsis"
><P
></P
><A
NAME="AEN25385"
></A
><P
><CODE
><CODE
CLASS="FUNCDEF"
>void off_pow</CODE
>(void);</CODE
></P
><P
></P
></DIV
></DIV
><DIV
CLASS="section"
><H3
CLASS="section"
><A
NAME="AEN25390"
>パラメータ</A
></H3
><P
>なし</P
></DIV
><DIV
CLASS="section"
><H3
CLASS="section"
><A
NAME="AEN25393"
>リターンパラメータ</A
></H3
><P
>なし</P
></DIV
><DIV
CLASS="section"
><H3
CLASS="section"
><A
NAME="AEN25396"
>エラーコード</A
></H3
><P
>なし</P
></DIV
><DIV
CLASS="section"
><H3
CLASS="section"
><A
NAME="AEN25399"
>利用可能なコンテキスト</A
></H3
><DIV
CLASS="informaltable"
><P
></P
><A
NAME="AEN25401"
></A
><TABLE
BORDER="1"
FRAME="border"
RULES="all"
WIDTH="100%"
CLASS="CALSTABLE"
><COL
WIDTH="33%"><COL
WIDTH="33%"><COL
WIDTH="33%"><THEAD
><TR
><TH
ALIGN="center"
>タスク部</TH
><TH
ALIGN="center"
>準タスク部</TH
><TH
ALIGN="center"
>タスク独立部</TH
></TR
></THEAD
><TBODY
VALIGN="top"
><TR
><TD
ALIGN="center"
>×</TD
><TD
ALIGN="center"
>×</TD
><TD
ALIGN="center"
>×</TD
></TR
></TBODY
></TABLE
><P
></P
></DIV
></DIV
><DIV
CLASS="section"
><H3
CLASS="section"
><A
NAME="AEN25416"
>関連するサービスプロファイル</A
></H3
><P
>以下のサービスプロファイルが有効に設定されている場合に限り、本APIはサポートされる。</P
><DIV
CLASS="informaltable"
><P
></P
><A
NAME="AEN25419"
></A
><TABLE
BORDER="0"
FRAME="void"
RULES="none"
WIDTH="100%"
CLASS="CALSTABLE"
><COL
WIDTH="38%"
TITLE="c1"><COL
WIDTH="62%"><TBODY
VALIGN="top"
><TR
><TD
>&#13;                <TT
CLASS="literal"
>TK_SUPPORT_LOWPOWER</TT
>
              </TD
><TD
>省電力機能のサポート</TD
></TR
></TBODY
></TABLE
><P
></P
></DIV
></DIV
><DIV
CLASS="section"
><H3
CLASS="section"
><A
NAME="AEN25428"
>解説</A
></H3
><P
>μT-Kernelの中から、<CODE
CLASS="varname"
>powmode</CODE
>＝<TT
CLASS="literal"
>TPW_DOSUSPEND</TT
> を指定した <A
HREF="system_management_functions.html#tk_set_pow"
>tk_set_pow</A
> の処理中に呼び出され、CPU周辺のハードウェアをサスペンド状態(電源の切れた状態)に移行する処理を行う。</P
><P
>サスペンド状態に移行した後は、<A
HREF="power_management_functions.html#off_pow"
>off_pow</A
> の処理の中でリジューム要因(電源再投入など)の発生を待ち、リジューム要因が発生したら、サスペンド状態を解除して <A
HREF="power_management_functions.html#off_pow"
>off_pow</A
> の呼出元に復帰する。</P
><P
><A
HREF="power_management_functions.html#off_pow"
>off_pow</A
> の具体的な処理手順は以下の通りである。</P
><P
></P
><OL
TYPE="1"
><LI
><P
>CPUをサスペンド状態へ移行し、リジューム要因の発生を待つ。たとえば、クロックを停止する</P
></LI
><LI
><P
>リジューム要因の発生によりCPUが実行を再開する。(ハードウェアによる処理)</P
></LI
><LI
><P
>必要に応じて、CPUやハードウェアの状態を通常の状態に戻す。サスペンド状態を解除する。(前項と一緒にハードウェアで処理される場合もある)</P
></LI
><LI
><P
>呼出元に復帰する。呼出元は、実際にはμT-Kernel内部の <A
HREF="system_management_functions.html#tk_set_pow"
>tk_set_pow</A
> の処理部分である。</P
></LI
></OL
><P
><A
HREF="power_management_functions.html#off_pow"
>off_pow</A
> の実装にあたっては、以下の点に注意する必要がある。</P
><P
></P
><UL
><LI
><P
>割込み禁止状態で呼び出される。</P
></LI
><LI
><P
>割込みを許可してはいけない。</P
></LI
></UL
><P
>なお、周辺機器など各デバイスは、デバイスドライバによってサスペンド状態への移行および復帰を行う。詳細は <A
HREF="device_management_functions.html#tk_sus_dev"
>tk_sus_dev</A
> を参照。</P
></DIV
></DIV
></DIV
><DIV
CLASS="NAVFOOTER"
><HR
ALIGN="LEFT"
WIDTH="100%"><TABLE
SUMMARY="Footer navigation table"
WIDTH="100%"
BORDER="0"
CELLPADDING="0"
CELLSPACING="0"
><TR
><TD
WIDTH="33%"
ALIGN="left"
VALIGN="top"
><A
HREF="io_port_management_functions.html"
ACCESSKEY="P"
>前のページ</A
></TD
><TD
WIDTH="34%"
ALIGN="center"
VALIGN="top"
><A
HREF="index.html"
ACCESSKEY="H"
>ホーム</A
></TD
><TD
WIDTH="33%"
ALIGN="right"
VALIGN="top"
><A
HREF="system_configuration_information_management_functions.html"
ACCESSKEY="N"
>次のページ</A
></TD
></TR
><TR
><TD
WIDTH="33%"
ALIGN="left"
VALIGN="top"
>I/Oポートアクセスサポート機能</TD
><TD
WIDTH="34%"
ALIGN="center"
VALIGN="top"
><A
HREF="utk_sm_functions.html"
ACCESSKEY="U"
>上に戻る</A
></TD
><TD
WIDTH="33%"
ALIGN="right"
VALIGN="top"
>システム構成情報管理機能</TD
></TR
></TABLE
></DIV
></BODY
></HTML
>