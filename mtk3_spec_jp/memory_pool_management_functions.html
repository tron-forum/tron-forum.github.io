<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN""http://www.w3.org/TR/html4/loose.dtd">
<HTML
><HEAD
><TITLE
>メモリプール管理機能</TITLE
><META
NAME="GENERATOR"
CONTENT="Modular DocBook HTML Stylesheet Version 1.79"><LINK
REL="HOME"
TITLE="μT-Kernel 3.0仕様書"
HREF="index.html"><LINK
REL="UP"
TITLE="μT-Kernel/OSの機能"
HREF="utk_os_functions.html"><LINK
REL="PREVIOUS"
TITLE="拡張同期・通信機能"
HREF="extended_synchronization_and_communication_functions.html"><LINK
REL="NEXT"
TITLE="時間管理機能"
HREF="time_management_functions.html"></HEAD
><BODY
CLASS="section"
BGCOLOR="#FFFFFF"
TEXT="#000000"
LINK="#0000FF"
VLINK="#840084"
ALINK="#0000FF"
><DIV
CLASS="NAVHEADER"
><TABLE
SUMMARY="Header navigation table"
WIDTH="100%"
BORDER="0"
CELLPADDING="0"
CELLSPACING="0"
><TR
><TH
COLSPAN="3"
ALIGN="center"
>μT-Kernel 3.0仕様書</TH
></TR
><TR
><TD
WIDTH="10%"
ALIGN="left"
VALIGN="bottom"
><A
HREF="extended_synchronization_and_communication_functions.html"
ACCESSKEY="P"
>前のページ</A
></TD
><TD
WIDTH="80%"
ALIGN="center"
VALIGN="bottom"
>μT-Kernel/OSの機能</TD
><TD
WIDTH="10%"
ALIGN="right"
VALIGN="bottom"
><A
HREF="time_management_functions.html"
ACCESSKEY="N"
>次のページ</A
></TD
></TR
></TABLE
><HR
ALIGN="LEFT"
WIDTH="100%"></DIV
><DIV
CLASS="section"
><H1
CLASS="section"
><A
NAME="memory_pool_management_functions"
>メモリプール管理機能</A
></H1
><P
>メモリプール管理機能は、ソフトウェアによってメモリプールの管理やメモリブロックの割当てを行うための機能である。</P
><P
>メモリプールには、固定長メモリプールと可変長メモリプールがある。両者は別のオブジェクトであり、操作のためのシステムコールが異なっている。固定長メモリプールから獲得されるメモリブロックはサイズが固定されているのに対して、可変長メモリプールから獲得されるメモリブロックでは、任意のブロックサイズを指定することができる。</P
><DIV
CLASS="section"
><H2
CLASS="section"
><A
NAME="fixed_size_memory_pool"
>固定長メモリプール</A
></H2
><P
>固定長メモリプールは、固定されたサイズのメモリブロックを動的に管理するためのオブジェクトである。固定長メモリプール機能には、固定長メモリプールを生成／削除する機能、固定長メモリプールに対してメモリブロックを獲得／返却する機能、固定長メモリプールの状態を参照する機能が含まれる。固定長メモリプールはID番号で識別されるオブジェクトである。固定長メモリプールのID番号を固定長メモリプールIDと呼ぶ。</P
><P
>固定長メモリプールは、固定長メモリプールとして利用するメモリ領域(これを固定長メモリプール領域、または単にメモリプール領域と呼ぶ)と、メモリブロックの獲得を待つタスクの待ち行列を持つ。固定長メモリプールからメモリブロックを獲得するタスクは、メモリプール領域に空きがなくなった場合、次にメモリブロックが返却されるまで固定長メモリブロックの獲得待ち状態となる。固定長メモリブロックの獲得待ち状態になったタスクは、その固定長メモリプールの待ち行列につながれる。</P
><DIV
CLASS="note"
><P
></P
><TABLE
CLASS="note"
WIDTH="100%"
BORDER="0"
><TR
><TD
WIDTH="25"
ALIGN="CENTER"
VALIGN="TOP"
><IMG
SRC="../images/note.gif"
HSPACE="5"
ALT="注意"></TD
><TH
ALIGN="LEFT"
VALIGN="MIDDLE"
><B
>補足事項</B
></TH
></TR
><TR
><TD
>&nbsp;</TD
><TD
ALIGN="LEFT"
VALIGN="TOP"
><P
>固定長メモリプールの場合、何種類かのサイズのメモリブロックが必要となる場合には、サイズ毎に複数のメモリプールを用意する必要がある。</P
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="section"
><H3
CLASS="section"
><A
NAME="tk_cre_mpf"
>tk_cre_mpf - 固定長メモリプール生成</A
></H3
><DIV
CLASS="section"
><H4
CLASS="section"
><A
NAME="AEN11826"
>C言語インタフェース</A
></H4
><DIV
CLASS="funcsynopsis"
><P
></P
><A
NAME="AEN11828"
></A
><PRE
CLASS="funcsynopsisinfo"
>#include &#60;tk/tkernel.h&#62;</PRE
><P
><CODE
><CODE
CLASS="FUNCDEF"
>ID mpfid = tk_cre_mpf</CODE
>(CONST T_CMPF *pk_cmpf);</CODE
></P
><P
></P
></DIV
></DIV
><DIV
CLASS="section"
><H4
CLASS="section"
><A
NAME="AEN11835"
>パラメータ</A
></H4
><DIV
CLASS="informaltable"
><P
></P
><A
NAME="AEN11837"
></A
><TABLE
BORDER="0"
FRAME="void"
RULES="none"
WIDTH="100%"
CLASS="CALSTABLE"
><COL
WIDTH="21%"><COL
WIDTH="14%"><COL
WIDTH="29%"><COL
WIDTH="36%"><TBODY
VALIGN="top"
><TR
><TD
>CONST T_CMPF*</TD
><TD
>&#13;                <CODE
CLASS="varname"
>pk_cmpf</CODE
>
              </TD
><TD
>Packet to Create Memory Pool</TD
><TD
>固定長メモリプール生成情報</TD
></TR
></TBODY
></TABLE
><P
></P
></DIV
><P
><CODE
CLASS="varname"
>pk_cmpf</CODE
> の内容</P
><DIV
CLASS="informaltable"
><P
></P
><A
NAME="AEN11852"
></A
><TABLE
BORDER="0"
FRAME="void"
RULES="none"
WIDTH="100%"
CLASS="CALSTABLE"
><COL
WIDTH="21%"
TITLE="c1"><COL
WIDTH="14%"
TITLE="c2"><COL
WIDTH="29%"
TITLE="c3"><COL
WIDTH="36%"
TITLE="c4"><TBODY
VALIGN="top"
><TR
><TD
>void*</TD
><TD
>&#13;                <CODE
CLASS="varname"
>exinf</CODE
>
              </TD
><TD
>Extended Information</TD
><TD
>拡張情報</TD
></TR
><TR
><TD
>ATR</TD
><TD
>&#13;                <CODE
CLASS="varname"
>mpfatr</CODE
>
              </TD
><TD
>Memory Pool Attribute</TD
><TD
>メモリプール属性</TD
></TR
><TR
><TD
>SZ</TD
><TD
>&#13;                <CODE
CLASS="varname"
>mpfcnt</CODE
>
              </TD
><TD
>Memory Pool Block Count</TD
><TD
>メモリプール全体のブロック数</TD
></TR
><TR
><TD
>SZ</TD
><TD
>&#13;                <CODE
CLASS="varname"
>blfsz</CODE
>
              </TD
><TD
>Memory Block Size</TD
><TD
>固定長メモリブロックサイズ(バイト数)</TD
></TR
><TR
><TD
>UB</TD
><TD
>&#13;                <CODE
CLASS="varname"
>dsname[8]</CODE
>
              </TD
><TD
>DS Object name</TD
><TD
>DSオブジェクト名称</TD
></TR
><TR
><TD
>void*</TD
><TD
>&#13;                <CODE
CLASS="varname"
>bufptr</CODE
>
              </TD
><TD
>Buffer Pointer</TD
><TD
>ユーザバッファポインタ</TD
></TR
><TR
><TD
COLSPAN="4"
>──(以下に実装独自に他の情報を追加してもよい)──</TD
></TR
></TBODY
></TABLE
><P
></P
></DIV
></DIV
><DIV
CLASS="section"
><H4
CLASS="section"
><A
NAME="AEN11897"
>リターンパラメータ</A
></H4
><DIV
CLASS="informaltable"
><P
></P
><A
NAME="AEN11899"
></A
><TABLE
BORDER="0"
FRAME="void"
RULES="none"
WIDTH="100%"
CLASS="CALSTABLE"
><COL
WIDTH="21%"
TITLE="c1"><COL
WIDTH="14%"
TITLE="c2"><COL
WIDTH="29%"
TITLE="c3"><COL
WIDTH="36%"
TITLE="c4"><TBODY
VALIGN="top"
><TR
><TD
>ID</TD
><TD
>&#13;                <CODE
CLASS="varname"
>mpfid</CODE
>
              </TD
><TD
>Memory Pool ID</TD
><TD
>固定長メモリプールID</TD
></TR
><TR
><TD
COLSPAN="2"
ALIGN="right"
>または</TD
><TD
>Error Code</TD
><TD
>エラーコード</TD
></TR
></TBODY
></TABLE
><P
></P
></DIV
></DIV
><DIV
CLASS="section"
><H4
CLASS="section"
><A
NAME="AEN11916"
>エラーコード</A
></H4
><DIV
CLASS="informaltable"
><P
></P
><A
NAME="AEN11918"
></A
><TABLE
BORDER="0"
FRAME="void"
RULES="none"
WIDTH="100%"
CLASS="CALSTABLE"
><COL
WIDTH="17%"
TITLE="c1"><COL
WIDTH="83%"
TITLE="c2"><TBODY
VALIGN="top"
><TR
><TD
>&#13;                <SPAN
CLASS="errorname"
>E_NOMEM</SPAN
>
              </TD
><TD
>メモリ不足(管理ブロックやメモリプール用の領域が確保できない)</TD
></TR
><TR
><TD
>&#13;                <SPAN
CLASS="errorname"
>E_LIMIT</SPAN
>
              </TD
><TD
>固定長メモリプールの数がシステムの上限を超えた</TD
></TR
><TR
><TD
>&#13;                <SPAN
CLASS="errorname"
>E_RSATR</SPAN
>
              </TD
><TD
>予約属性(<CODE
CLASS="varname"
>mpfatr</CODE
> が不正あるいは利用できない)</TD
></TR
><TR
><TD
>&#13;                <SPAN
CLASS="errorname"
>E_PAR</SPAN
>
              </TD
><TD
>パラメータエラー(<CODE
CLASS="varname"
>pk_cmpf</CODE
> が不正, <CODE
CLASS="varname"
>mpfcnt</CODE
>, <CODE
CLASS="varname"
>blfsz</CODE
> が負または不正, <CODE
CLASS="varname"
>bufptr</CODE
> が不正)</TD
></TR
></TBODY
></TABLE
><P
></P
></DIV
></DIV
><DIV
CLASS="section"
><H4
CLASS="section"
><A
NAME="AEN11944"
>利用可能なコンテキスト</A
></H4
><DIV
CLASS="informaltable"
><P
></P
><A
NAME="AEN11946"
></A
><TABLE
BORDER="1"
FRAME="border"
RULES="all"
WIDTH="100%"
CLASS="CALSTABLE"
><COL
WIDTH="33%"><COL
WIDTH="33%"><COL
WIDTH="33%"><THEAD
><TR
><TH
ALIGN="center"
>タスク部</TH
><TH
ALIGN="center"
>準タスク部</TH
><TH
ALIGN="center"
>タスク独立部</TH
></TR
></THEAD
><TBODY
VALIGN="top"
><TR
><TD
ALIGN="center"
>○</TD
><TD
ALIGN="center"
>○</TD
><TD
ALIGN="center"
>×</TD
></TR
></TBODY
></TABLE
><P
></P
></DIV
></DIV
><DIV
CLASS="section"
><H4
CLASS="section"
><A
NAME="AEN11961"
>関連するサービスプロファイル</A
></H4
><DIV
CLASS="informaltable"
><P
></P
><A
NAME="AEN11963"
></A
><TABLE
BORDER="0"
FRAME="void"
RULES="none"
WIDTH="100%"
CLASS="CALSTABLE"
><COL
WIDTH="38%"
TITLE="c1"><COL
WIDTH="62%"><TBODY
VALIGN="top"
><TR
><TD
>&#13;                <TT
CLASS="literal"
>TK_SUPPORT_USERBUF</TT
>
              </TD
><TD
><TT
CLASS="literal"
>TA_USERBUF</TT
>の固定長メモリプール属性指定が可能</TD
></TR
><TR
><TD
>&#13;                <TT
CLASS="literal"
>TK_SUPPORT_AUTOBUF</TT
>
              </TD
><TD
>自動バッファ割当て(<TT
CLASS="literal"
>TA_USERBUF</TT
>の固定長メモリプール属性指定なし)が可能</TD
></TR
><TR
><TD
>&#13;                <TT
CLASS="literal"
>TK_SUPPORT_DISWAI</TT
>
              </TD
><TD
>固定長メモリプール属性として<TT
CLASS="literal"
>TA_NODISWAI</TT
>(待ち禁止の拒否)が指定可能</TD
></TR
><TR
><TD
>&#13;                <TT
CLASS="literal"
>TK_SUPPORT_DSNAME</TT
>
              </TD
><TD
><TT
CLASS="literal"
>TA_DSNAME</TT
>の固定長メモリプール属性指定が可能</TD
></TR
></TBODY
></TABLE
><P
></P
></DIV
></DIV
><DIV
CLASS="section"
><H4
CLASS="section"
><A
NAME="AEN11988"
>解説</A
></H4
><P
>固定長メモリプールを生成し固定長メモリプールIDを割り当てる。具体的には、<CODE
CLASS="varname"
>mpfcnt</CODE
>, <CODE
CLASS="varname"
>blfsz</CODE
> の情報を元に、メモリプールとして利用するメモリ領域を確保する。また、生成したメモリプールに対して管理ブロックを割り付ける。ここで生成されたメモリプールに対して <A
HREF="memory_pool_management_functions.html#tk_get_mpf"
>tk_get_mpf</A
> システムコールを発行することにより、<CODE
CLASS="varname"
>blfsz</CODE
> のサイズ(バイト数)をもつメモリブロックを獲得することができる。</P
><P
><CODE
CLASS="varname"
>exinf</CODE
> は、対象メモリプールに関する情報を入れておくためにユーザが自由に利用できる。ここで設定した情報は、<A
HREF="memory_pool_management_functions.html#tk_ref_mpf"
>tk_ref_mpf</A
> で取り出すことができる。なお、ユーザの情報を入れるためにもっと大きな領域がほしい場合や、途中で内容を変更したい場合には、自分でそのためのメモリを確保し、そのメモリパケットのアドレスを <CODE
CLASS="varname"
>exinf</CODE
> に入れる。カーネルでは <CODE
CLASS="varname"
>exinf</CODE
> の内容について関知しない。</P
><P
><CODE
CLASS="varname"
>mpfatr</CODE
> は、下位側がシステム属性を表し、上位側が実装独自属性を表す。<CODE
CLASS="varname"
>mpfatr</CODE
> のシステム属性の部分では、次のような指定を行う。</P
><PRE
CLASS="synopsis"
>&#13;mpfatr := (TA_TFIFO || TA_TPRI) | [TA_DSNAME] | [TA_USERBUF] | [TA_NODISWAI]
       | (TA_RNG0 || TA_RNG1 || TA_RNG2 || TA_RNG3)
</PRE
><DIV
CLASS="informaltable"
><P
></P
><A
NAME="AEN12004"
></A
><TABLE
BORDER="0"
FRAME="void"
RULES="none"
WIDTH="100%"
CLASS="CALSTABLE"
><COL
WIDTH="17%"
TITLE="c1"><COL
WIDTH="83%"><TBODY
VALIGN="top"
><TR
><TD
>&#13;                <TT
CLASS="literal"
>TA_TFIFO</TT
>
              </TD
><TD
>メモリ獲得待ちタスクのキューイングはFIFO</TD
></TR
><TR
><TD
>&#13;                <TT
CLASS="literal"
>TA_TPRI</TT
>
              </TD
><TD
>メモリ獲得待ちタスクのキューイングは優先度順</TD
></TR
><TR
><TD
>&#13;                <TT
CLASS="literal"
>TA_RNGn</TT
>
              </TD
><TD
>メモリのアクセス制限を保護レベルnとする</TD
></TR
><TR
><TD
>&#13;                <TT
CLASS="literal"
>TA_DSNAME</TT
>
              </TD
><TD
>DSオブジェクト名称を指定する</TD
></TR
><TR
><TD
>&#13;                <TT
CLASS="literal"
>TA_USERBUF</TT
>
              </TD
><TD
>メモリプール領域としてユーザが指定した領域を利用する</TD
></TR
><TR
><TD
>&#13;                <TT
CLASS="literal"
>TA_NODISWAI</TT
>
              </TD
><TD
><A
HREF="task_dependent_synchronization_functions.html#tk_dis_wai"
>tk_dis_wai</A
> による待ち禁止を拒否する</TD
></TR
></TBODY
></TABLE
><P
></P
></DIV
><PRE
CLASS="programlisting"
>&#13;#define TA_TFIFO        0x00000000      /* 待ちタスクをFIFOで管理 */
#define TA_TPRI         0x00000001      /* 待ちタスクを優先度順で管理 */
#define TA_USERBUF      0x00000020      /* ユーザバッファポインタを指定 */
#define TA_DSNAME       0x00000040      /* DSオブジェクト名称を指定 */
#define TA_NODISWAI     0x00000080      /* 待ち禁止拒否 */
#define TA_RNG0         0x00000000      /* 保護レベル0 */
#define TA_RNG1         0x00000100      /* 保護レベル1 */
#define TA_RNG2         0x00000200      /* 保護レベル2 */
#define TA_RNG3         0x00000300      /* 保護レベル3 */
</PRE
><P
><TT
CLASS="literal"
>TA_TFIFO</TT
>, <TT
CLASS="literal"
>TA_TPRI</TT
> では、タスクがメモリ獲得のためにメモリプールの待ち行列に並ぶ際の並び方を指定することができる。属性が <TT
CLASS="literal"
>TA_TFIFO</TT
> であればタスクの待ち行列はFIFOとなり、属性が <TT
CLASS="literal"
>TA_TPRI</TT
> であればタスクの待ち行列はタスクの優先度順となる。</P
><P
><TT
CLASS="literal"
>TA_RNGn</TT
> では、メモリのアクセスを制限する保護レベルを指定する。指定された保護レベルと同じかより高い保護レベルで実行しているタスクからのみアクセス可能である。低いレベルで実行しているタスクがアクセスするとCPUの保護違反の例外が発生する。例えば、<TT
CLASS="literal"
>TA_RNG1</TT
> を指定して作成したメモリプールから獲得したメモリは、<TT
CLASS="literal"
>TA_RNG0</TT
> や <TT
CLASS="literal"
>TA_RNG1</TT
> で動作しているタスクからはアクセス可能だが、<TT
CLASS="literal"
>TA_RNG2</TT
> や <TT
CLASS="literal"
>TA_RNG3</TT
> で動作しているタスクからはアクセスできない。</P
><P
><TT
CLASS="literal"
>TA_DSNAME</TT
> を指定した場合に <CODE
CLASS="varname"
>dsname</CODE
> が有効となり、DSオブジェクト名称として設定される。DSオブジェクト名称はデバッガがオブジェクトを識別するために使用され、T-Kernel/DSのシステムコール <A
HREF="utk_ds_functions.html#td_ref_dsname"
>td_ref_dsname</A
> と <A
HREF="utk_ds_functions.html#td_set_dsname"
>td_set_dsname</A
> からのみ操作可能である。詳細は <A
HREF="utk_ds_functions.html#td_ref_dsname"
>td_ref_dsname</A
> 、<A
HREF="utk_ds_functions.html#td_set_dsname"
>td_set_dsname</A
> を参照のこと。<TT
CLASS="literal"
>TA_DSNAME</TT
> を指定しなかった場合は、<CODE
CLASS="varname"
>dsname</CODE
> が無視され、<A
HREF="utk_ds_functions.html#td_ref_dsname"
>td_ref_dsname</A
> や <A
HREF="utk_ds_functions.html#td_set_dsname"
>td_set_dsname</A
> が、<SPAN
CLASS="errorname"
>E_OBJ</SPAN
> エラーとなる。</P
></DIV
><DIV
CLASS="section"
><H4
CLASS="section"
><A
NAME="AEN12059"
>補足事項</A
></H4
><P
>固定長メモリプールの場合、ブロックサイズを変えるためには別のメモリプールを用意しなければならない。すなわち、何種類かのメモリブロックサイズが必要となる場合は、サイズごとに複数のメモリプールを設ける必要がある。</P
><P
>CPUの実行モードがないシステムにおいても、移植性確保のために <TT
CLASS="literal"
>TA_RNGn</TT
> 属性を受け付けなければならない。例えば、<TT
CLASS="literal"
>TA_RNGn</TT
> の指定はすべて <TT
CLASS="literal"
>TA_RNG0</TT
> 相当として処理してもよいが、エラーとはしない。</P
></DIV
><DIV
CLASS="section"
><H4
CLASS="section"
><A
NAME="AEN12066"
>移植ガイドライン</A
></H4
><P
>T-Kernel 2.0には<TT
CLASS="literal"
>TA_USERBUF</TT
>と<CODE
CLASS="varname"
>bufptr</CODE
>が存在しない。そのため、この機能を使っている場合はT-Kernel 2.0への移植の際に修正が必要となるが、正しく<CODE
CLASS="varname"
>mpfcnt</CODE
>と<CODE
CLASS="varname"
>blfsz</CODE
>を設定してあれば、<TT
CLASS="literal"
>TA_USERBUF</TT
>と<CODE
CLASS="varname"
>bufptr</CODE
>を削除するだけで移植ができる。</P
></DIV
></DIV
><DIV
CLASS="section"
><H3
CLASS="section"
><A
NAME="tk_del_mpf"
>tk_del_mpf - 固定長メモリプール削除</A
></H3
><DIV
CLASS="section"
><H4
CLASS="section"
><A
NAME="AEN12077"
>C言語インタフェース</A
></H4
><DIV
CLASS="funcsynopsis"
><P
></P
><A
NAME="AEN12079"
></A
><PRE
CLASS="funcsynopsisinfo"
>#include &#60;tk/tkernel.h&#62;</PRE
><P
><CODE
><CODE
CLASS="FUNCDEF"
>ER ercd = tk_del_mpf</CODE
>(ID mpfid);</CODE
></P
><P
></P
></DIV
></DIV
><DIV
CLASS="section"
><H4
CLASS="section"
><A
NAME="AEN12086"
>パラメータ</A
></H4
><DIV
CLASS="informaltable"
><P
></P
><A
NAME="AEN12088"
></A
><TABLE
BORDER="0"
FRAME="void"
RULES="none"
WIDTH="100%"
CLASS="CALSTABLE"
><COL
WIDTH="8%"
TITLE="c1"><COL
WIDTH="17%"
TITLE="c2"><COL
WIDTH="33%"
TITLE="c3"><COL
WIDTH="42%"
TITLE="c4"><TBODY
VALIGN="top"
><TR
><TD
>ID</TD
><TD
>&#13;                <CODE
CLASS="varname"
>mpfid</CODE
>
              </TD
><TD
>Memory Pool ID</TD
><TD
>固定長メモリプールID</TD
></TR
></TBODY
></TABLE
><P
></P
></DIV
></DIV
><DIV
CLASS="section"
><H4
CLASS="section"
><A
NAME="AEN12101"
>リターンパラメータ</A
></H4
><DIV
CLASS="informaltable"
><P
></P
><A
NAME="AEN12103"
></A
><TABLE
BORDER="0"
FRAME="void"
RULES="none"
WIDTH="100%"
CLASS="CALSTABLE"
><COL
WIDTH="8%"
TITLE="c1"><COL
WIDTH="17%"
TITLE="c2"><COL
WIDTH="33%"
TITLE="c3"><COL
WIDTH="42%"
TITLE="c4"><TBODY
VALIGN="top"
><TR
><TD
>ER</TD
><TD
>&#13;                <CODE
CLASS="varname"
>ercd</CODE
>
              </TD
><TD
>Error Code</TD
><TD
>エラーコード</TD
></TR
></TBODY
></TABLE
><P
></P
></DIV
></DIV
><DIV
CLASS="section"
><H4
CLASS="section"
><A
NAME="AEN12116"
>エラーコード</A
></H4
><DIV
CLASS="informaltable"
><P
></P
><A
NAME="AEN12118"
></A
><TABLE
BORDER="0"
FRAME="void"
RULES="none"
WIDTH="100%"
CLASS="CALSTABLE"
><COL
WIDTH="17%"
TITLE="c1"><COL
WIDTH="83%"
TITLE="c2"><TBODY
VALIGN="top"
><TR
><TD
>&#13;                <SPAN
CLASS="errorname"
>E_OK</SPAN
>
              </TD
><TD
>正常終了</TD
></TR
><TR
><TD
>&#13;                <SPAN
CLASS="errorname"
>E_ID</SPAN
>
              </TD
><TD
>不正ID番号(<CODE
CLASS="varname"
>mpfid</CODE
> が不正あるいは利用できない)</TD
></TR
><TR
><TD
>&#13;                <SPAN
CLASS="errorname"
>E_NOEXS</SPAN
>
              </TD
><TD
>オブジェクトが存在していない(<CODE
CLASS="varname"
>mpfid</CODE
> の固定長メモリプールが存在しない)</TD
></TR
></TBODY
></TABLE
><P
></P
></DIV
></DIV
><DIV
CLASS="section"
><H4
CLASS="section"
><A
NAME="AEN12137"
>利用可能なコンテキスト</A
></H4
><DIV
CLASS="informaltable"
><P
></P
><A
NAME="AEN12139"
></A
><TABLE
BORDER="1"
FRAME="border"
RULES="all"
WIDTH="100%"
CLASS="CALSTABLE"
><COL
WIDTH="33%"><COL
WIDTH="33%"><COL
WIDTH="33%"><THEAD
><TR
><TH
ALIGN="center"
>タスク部</TH
><TH
ALIGN="center"
>準タスク部</TH
><TH
ALIGN="center"
>タスク独立部</TH
></TR
></THEAD
><TBODY
VALIGN="top"
><TR
><TD
ALIGN="center"
>○</TD
><TD
ALIGN="center"
>○</TD
><TD
ALIGN="center"
>×</TD
></TR
></TBODY
></TABLE
><P
></P
></DIV
></DIV
><DIV
CLASS="section"
><H4
CLASS="section"
><A
NAME="AEN12154"
>関連するサービスプロファイル</A
></H4
><P
>なし</P
></DIV
><DIV
CLASS="section"
><H4
CLASS="section"
><A
NAME="AEN12157"
>解説</A
></H4
><P
><CODE
CLASS="varname"
>mpfid</CODE
> で示される固定長メモリプールを削除する。</P
><P
>このメモリプールからメモリを獲得しているタスクが存在しても、そのチェックや通知は行われない。すべてのメモリブロックが返却されていなくても、このシステムコールは正常終了する。</P
><P
>本システムコールの発行により、対象メモリプールのID番号および管理ブロック用の領域やメモリプール本体の領域は解放される。</P
><P
>対象メモリプールにおいてメモリ獲得を待っているタスクがあった場合にも、本システムコールは正常終了するが、待ち状態にあったタスクにはエラー <SPAN
CLASS="errorname"
>E_DLT</SPAN
> が返される。</P
></DIV
></DIV
><DIV
CLASS="section"
><H3
CLASS="section"
><A
NAME="tk_get_mpf"
>tk_get_mpf - 固定長メモリブロック獲得</A
></H3
><DIV
CLASS="section"
><H4
CLASS="section"
><A
NAME="AEN12167"
>C言語インタフェース</A
></H4
><DIV
CLASS="funcsynopsis"
><P
></P
><A
NAME="AEN12169"
></A
><PRE
CLASS="funcsynopsisinfo"
>#include &#60;tk/tkernel.h&#62;</PRE
><P
><CODE
><CODE
CLASS="FUNCDEF"
>ER ercd = tk_get_mpf</CODE
>(ID mpfid, void **p_blf, TMO tmout);</CODE
></P
><P
></P
></DIV
></DIV
><DIV
CLASS="section"
><H4
CLASS="section"
><A
NAME="AEN12180"
>パラメータ</A
></H4
><DIV
CLASS="informaltable"
><P
></P
><A
NAME="AEN12182"
></A
><TABLE
BORDER="0"
FRAME="void"
RULES="none"
WIDTH="100%"
CLASS="CALSTABLE"
><COL
WIDTH="8%"
TITLE="c1"><COL
WIDTH="17%"
TITLE="c2"><COL
WIDTH="33%"
TITLE="c3"><COL
WIDTH="42%"
TITLE="c4"><TBODY
VALIGN="top"
><TR
><TD
>ID</TD
><TD
>&#13;                <CODE
CLASS="varname"
>mpfid</CODE
>
              </TD
><TD
>Memory Pool ID</TD
><TD
>固定長メモリプールID</TD
></TR
><TR
><TD
>void**</TD
><TD
>&#13;                <CODE
CLASS="varname"
>p_blf</CODE
>
              </TD
><TD
>Pointer to Block Start Address</TD
><TD
>リターンパラメータ <CODE
CLASS="varname"
>blf</CODE
> を返す領域へのポインタ</TD
></TR
><TR
><TD
>TMO</TD
><TD
>&#13;                <CODE
CLASS="varname"
>tmout</CODE
>
              </TD
><TD
>Timeout</TD
><TD
>タイムアウト指定(ミリ秒)</TD
></TR
></TBODY
></TABLE
><P
></P
></DIV
></DIV
><DIV
CLASS="section"
><H4
CLASS="section"
><A
NAME="AEN12208"
>リターンパラメータ</A
></H4
><DIV
CLASS="informaltable"
><P
></P
><A
NAME="AEN12210"
></A
><TABLE
BORDER="0"
FRAME="void"
RULES="none"
WIDTH="100%"
CLASS="CALSTABLE"
><COL
WIDTH="8%"
TITLE="c1"><COL
WIDTH="17%"
TITLE="c2"><COL
WIDTH="33%"
TITLE="c3"><COL
WIDTH="42%"
TITLE="c4"><TBODY
VALIGN="top"
><TR
><TD
>ER</TD
><TD
>&#13;                <CODE
CLASS="varname"
>ercd</CODE
>
              </TD
><TD
>Error Code</TD
><TD
>エラーコード</TD
></TR
><TR
><TD
>void*</TD
><TD
>&#13;                <CODE
CLASS="varname"
>blf</CODE
>
              </TD
><TD
>Block Start Address</TD
><TD
>メモリブロックの先頭アドレス</TD
></TR
></TBODY
></TABLE
><P
></P
></DIV
></DIV
><DIV
CLASS="section"
><H4
CLASS="section"
><A
NAME="AEN12229"
>エラーコード</A
></H4
><DIV
CLASS="informaltable"
><P
></P
><A
NAME="AEN12231"
></A
><TABLE
BORDER="0"
FRAME="void"
RULES="none"
WIDTH="100%"
CLASS="CALSTABLE"
><COL
WIDTH="17%"
TITLE="c1"><COL
WIDTH="83%"
TITLE="c2"><TBODY
VALIGN="top"
><TR
><TD
>&#13;                <SPAN
CLASS="errorname"
>E_OK</SPAN
>
              </TD
><TD
>正常終了</TD
></TR
><TR
><TD
>&#13;                <SPAN
CLASS="errorname"
>E_ID</SPAN
>
              </TD
><TD
>不正ID番号(<CODE
CLASS="varname"
>mpfid</CODE
> が不正あるいは利用できない)</TD
></TR
><TR
><TD
>&#13;                <SPAN
CLASS="errorname"
>E_NOEXS</SPAN
>
              </TD
><TD
>オブジェクトが存在していない(<CODE
CLASS="varname"
>mpfid</CODE
> の固定長メモリプールが存在しない)</TD
></TR
><TR
><TD
>&#13;                <SPAN
CLASS="errorname"
>E_PAR</SPAN
>
              </TD
><TD
>パラメータエラー(<CODE
CLASS="varname"
>tmout</CODE
>≦(-2))</TD
></TR
><TR
><TD
>&#13;                <SPAN
CLASS="errorname"
>E_DLT</SPAN
>
              </TD
><TD
>待ちオブジェクトが削除された(待ちの間に対象メモリプールが削除)</TD
></TR
><TR
><TD
>&#13;                <SPAN
CLASS="errorname"
>E_RLWAI</SPAN
>
              </TD
><TD
>待ち状態強制解除(待ちの間に <A
HREF="task_dependent_synchronization_functions.html#tk_rel_wai"
>tk_rel_wai</A
> を受け付け)</TD
></TR
><TR
><TD
>&#13;                <SPAN
CLASS="errorname"
>E_DISWAI</SPAN
>
              </TD
><TD
>待ち禁止による待ち解除</TD
></TR
><TR
><TD
>&#13;                <SPAN
CLASS="errorname"
>E_TMOUT</SPAN
>
              </TD
><TD
>ポーリング失敗またはタイムアウト</TD
></TR
><TR
><TD
>&#13;                <SPAN
CLASS="errorname"
>E_CTX</SPAN
>
              </TD
><TD
>コンテキストエラー(タスク独立部またはディスパッチ禁止状態で実行)</TD
></TR
></TBODY
></TABLE
><P
></P
></DIV
></DIV
><DIV
CLASS="section"
><H4
CLASS="section"
><A
NAME="AEN12276"
>利用可能なコンテキスト</A
></H4
><DIV
CLASS="informaltable"
><P
></P
><A
NAME="AEN12278"
></A
><TABLE
BORDER="1"
FRAME="border"
RULES="all"
WIDTH="100%"
CLASS="CALSTABLE"
><COL
WIDTH="33%"><COL
WIDTH="33%"><COL
WIDTH="33%"><THEAD
><TR
><TH
ALIGN="center"
>タスク部</TH
><TH
ALIGN="center"
>準タスク部</TH
><TH
ALIGN="center"
>タスク独立部</TH
></TR
></THEAD
><TBODY
VALIGN="top"
><TR
><TD
ALIGN="center"
>○</TD
><TD
ALIGN="center"
>○</TD
><TD
ALIGN="center"
>×</TD
></TR
></TBODY
></TABLE
><P
></P
></DIV
></DIV
><DIV
CLASS="section"
><H4
CLASS="section"
><A
NAME="AEN12293"
>関連するサービスプロファイル</A
></H4
><P
>なし</P
></DIV
><DIV
CLASS="section"
><H4
CLASS="section"
><A
NAME="AEN12296"
>解説</A
></H4
><P
><CODE
CLASS="varname"
>mpfid</CODE
> で示される固定長メモリプールからメモリブロックを獲得する。獲得したメモリブロックの先頭アドレスが <CODE
CLASS="varname"
>blf</CODE
> に返される。獲得されるメモリブロックのサイズは、固定長メモリプール生成時に <CODE
CLASS="varname"
>blfsz</CODE
> パラメータで指定された値となる。</P
><P
>獲得したメモリのゼロクリアは行われず、獲得されたメモリブロックの内容は不定となる。</P
><P
>指定したメモリプールからメモリブロックが獲得できなければ、<A
HREF="memory_pool_management_functions.html#tk_get_mpf"
>tk_get_mpf</A
> 発行タスクがそのメモリプールのメモリ獲得待ち行列につながれ、メモリを獲得できるようになるまで待つ。</P
><P
><CODE
CLASS="varname"
>tmout</CODE
> により待ち時間の最大値(タイムアウト値)を指定することができる。<CODE
CLASS="varname"
>tmout</CODE
> の基準時間(時間の単位)はシステム時刻の基準時間(＝1ミリ秒)と同じである。タイムアウト指定が行われた場合、待ち解除の条件が満足されない(空きメモリができない)まま <CODE
CLASS="varname"
>tmout</CODE
> の時間が経過すると、タイムアウトエラー <SPAN
CLASS="errorname"
>E_TMOUT</SPAN
> となってシステムコールが終了する。</P
><P
><CODE
CLASS="varname"
>tmout</CODE
> として <TT
CLASS="literal"
>TMO_POL</TT
>＝0を指定した場合は、タイムアウト値として0を指定したことを示し、メモリが獲得できなかった場合も待ちに入ることなく <SPAN
CLASS="errorname"
>E_TMOUT</SPAN
> を返す。</P
><P
><CODE
CLASS="varname"
>tmout</CODE
> として <TT
CLASS="literal"
>TMO_FEVR</TT
>＝(-1)を指定した場合は、タイムアウト値として無限大の時間を指定したことを示し、タイムアウトせずにメモリが獲得できるまで待ち続ける。</P
><P
>メモリブロック獲得待ちを行う場合の待ち行列の順序は、メモリプールの属性によって、FIFOまたはタスク優先度順のいずれかとなる。</P
></DIV
></DIV
><DIV
CLASS="section"
><H3
CLASS="section"
><A
NAME="tk_get_mpf_u"
>tk_get_mpf_u - 固定長メモリブロック獲得(マイクロ秒単位)</A
></H3
><DIV
CLASS="section"
><H4
CLASS="section"
><A
NAME="AEN12320"
>C言語インタフェース</A
></H4
><DIV
CLASS="funcsynopsis"
><P
></P
><A
NAME="AEN12322"
></A
><PRE
CLASS="funcsynopsisinfo"
>#include &#60;tk/tkernel.h&#62;</PRE
><P
><CODE
><CODE
CLASS="FUNCDEF"
>ER ercd = tk_get_mpf_u</CODE
>(ID mpfid, void **p_blf, TMO_U tmout_u);</CODE
></P
><P
></P
></DIV
></DIV
><DIV
CLASS="section"
><H4
CLASS="section"
><A
NAME="AEN12333"
>パラメータ</A
></H4
><DIV
CLASS="informaltable"
><P
></P
><A
NAME="AEN12335"
></A
><TABLE
BORDER="0"
FRAME="void"
RULES="none"
WIDTH="100%"
CLASS="CALSTABLE"
><COL
WIDTH="8%"
TITLE="c1"><COL
WIDTH="17%"
TITLE="c2"><COL
WIDTH="33%"
TITLE="c3"><COL
WIDTH="42%"
TITLE="c4"><TBODY
VALIGN="top"
><TR
><TD
>ID</TD
><TD
>&#13;                <CODE
CLASS="varname"
>mpfid</CODE
>
              </TD
><TD
>Memory Pool ID</TD
><TD
>固定長メモリプールID</TD
></TR
><TR
><TD
>void**</TD
><TD
>&#13;                <CODE
CLASS="varname"
>p_blf</CODE
>
              </TD
><TD
>Pointer to Block Start Address</TD
><TD
>リターンパラメータ <CODE
CLASS="varname"
>blf</CODE
> を返す領域へのポインタ</TD
></TR
><TR
><TD
>TMO_U</TD
><TD
>&#13;                <CODE
CLASS="varname"
>tmout_u</CODE
>
              </TD
><TD
>Timeout</TD
><TD
>タイムアウト指定(マイクロ秒)</TD
></TR
></TBODY
></TABLE
><P
></P
></DIV
></DIV
><DIV
CLASS="section"
><H4
CLASS="section"
><A
NAME="AEN12361"
>リターンパラメータ</A
></H4
><DIV
CLASS="informaltable"
><P
></P
><A
NAME="AEN12363"
></A
><TABLE
BORDER="0"
FRAME="void"
RULES="none"
WIDTH="100%"
CLASS="CALSTABLE"
><COL
WIDTH="8%"
TITLE="c1"><COL
WIDTH="17%"
TITLE="c2"><COL
WIDTH="33%"
TITLE="c3"><COL
WIDTH="42%"
TITLE="c4"><TBODY
VALIGN="top"
><TR
><TD
>ER</TD
><TD
>&#13;                <CODE
CLASS="varname"
>ercd</CODE
>
              </TD
><TD
>Error Code</TD
><TD
>エラーコード</TD
></TR
><TR
><TD
>void*</TD
><TD
>&#13;                <CODE
CLASS="varname"
>blf</CODE
>
              </TD
><TD
>Block Start Address</TD
><TD
>メモリブロックの先頭アドレス</TD
></TR
></TBODY
></TABLE
><P
></P
></DIV
></DIV
><DIV
CLASS="section"
><H4
CLASS="section"
><A
NAME="AEN12382"
>エラーコード</A
></H4
><DIV
CLASS="informaltable"
><P
></P
><A
NAME="AEN12384"
></A
><TABLE
BORDER="0"
FRAME="void"
RULES="none"
WIDTH="100%"
CLASS="CALSTABLE"
><COL
WIDTH="17%"
TITLE="c1"><COL
WIDTH="83%"
TITLE="c2"><TBODY
VALIGN="top"
><TR
><TD
>&#13;                <SPAN
CLASS="errorname"
>E_OK</SPAN
>
              </TD
><TD
>正常終了</TD
></TR
><TR
><TD
>&#13;                <SPAN
CLASS="errorname"
>E_ID</SPAN
>
              </TD
><TD
>不正ID番号(<CODE
CLASS="varname"
>mpfid</CODE
> が不正あるいは利用できない)</TD
></TR
><TR
><TD
>&#13;                <SPAN
CLASS="errorname"
>E_NOEXS</SPAN
>
              </TD
><TD
>オブジェクトが存在していない(<CODE
CLASS="varname"
>mpfid</CODE
> の固定長メモリプールが存在しない)</TD
></TR
><TR
><TD
>&#13;                <SPAN
CLASS="errorname"
>E_PAR</SPAN
>
              </TD
><TD
>パラメータエラー(<CODE
CLASS="varname"
>tmout_u</CODE
>≦(-2))</TD
></TR
><TR
><TD
>&#13;                <SPAN
CLASS="errorname"
>E_DLT</SPAN
>
              </TD
><TD
>待ちオブジェクトが削除された(待ちの間に対象メモリプールが削除)</TD
></TR
><TR
><TD
>&#13;                <SPAN
CLASS="errorname"
>E_RLWAI</SPAN
>
              </TD
><TD
>待ち状態強制解除(待ちの間に <A
HREF="task_dependent_synchronization_functions.html#tk_rel_wai"
>tk_rel_wai</A
> を受け付け)</TD
></TR
><TR
><TD
>&#13;                <SPAN
CLASS="errorname"
>E_DISWAI</SPAN
>
              </TD
><TD
>待ち禁止による待ち解除</TD
></TR
><TR
><TD
>&#13;                <SPAN
CLASS="errorname"
>E_TMOUT</SPAN
>
              </TD
><TD
>ポーリング失敗またはタイムアウト</TD
></TR
><TR
><TD
>&#13;                <SPAN
CLASS="errorname"
>E_CTX</SPAN
>
              </TD
><TD
>コンテキストエラー(タスク独立部またはディスパッチ禁止状態で実行)</TD
></TR
></TBODY
></TABLE
><P
></P
></DIV
></DIV
><DIV
CLASS="section"
><H4
CLASS="section"
><A
NAME="AEN12429"
>利用可能なコンテキスト</A
></H4
><DIV
CLASS="informaltable"
><P
></P
><A
NAME="AEN12431"
></A
><TABLE
BORDER="1"
FRAME="border"
RULES="all"
WIDTH="100%"
CLASS="CALSTABLE"
><COL
WIDTH="33%"><COL
WIDTH="33%"><COL
WIDTH="33%"><THEAD
><TR
><TH
ALIGN="center"
>タスク部</TH
><TH
ALIGN="center"
>準タスク部</TH
><TH
ALIGN="center"
>タスク独立部</TH
></TR
></THEAD
><TBODY
VALIGN="top"
><TR
><TD
ALIGN="center"
>○</TD
><TD
ALIGN="center"
>○</TD
><TD
ALIGN="center"
>×</TD
></TR
></TBODY
></TABLE
><P
></P
></DIV
></DIV
><DIV
CLASS="section"
><H4
CLASS="section"
><A
NAME="AEN12446"
>関連するサービスプロファイル</A
></H4
><P
>以下のサービスプロファイルが有効に設定されている場合に限り、本システムコールはサポートされる。</P
><DIV
CLASS="informaltable"
><P
></P
><A
NAME="AEN12449"
></A
><TABLE
BORDER="0"
FRAME="void"
RULES="none"
WIDTH="100%"
CLASS="CALSTABLE"
><COL
WIDTH="38%"
TITLE="c1"><COL
WIDTH="62%"><TBODY
VALIGN="top"
><TR
><TD
>&#13;                <TT
CLASS="literal"
>TK_SUPPORT_USEC</TT
>
              </TD
><TD
>マイクロ秒のサポート</TD
></TR
></TBODY
></TABLE
><P
></P
></DIV
></DIV
><DIV
CLASS="section"
><H4
CLASS="section"
><A
NAME="AEN12458"
>解説</A
></H4
><P
><A
HREF="memory_pool_management_functions.html#tk_get_mpf"
>tk_get_mpf</A
> のパラメータである <CODE
CLASS="varname"
>tmout</CODE
> を64ビットマイクロ秒単位の <CODE
CLASS="varname"
>tmout_u</CODE
> としたシステムコールである。</P
><P
>パラメータが <CODE
CLASS="varname"
>tmout_u</CODE
> となった点を除き、本システムコールの仕様は <A
HREF="memory_pool_management_functions.html#tk_get_mpf"
>tk_get_mpf</A
> と同じである。詳細は <A
HREF="memory_pool_management_functions.html#tk_get_mpf"
>tk_get_mpf</A
> の説明を参照のこと。</P
></DIV
></DIV
><DIV
CLASS="section"
><H3
CLASS="section"
><A
NAME="tk_rel_mpf"
>tk_rel_mpf - 固定長メモリブロック返却</A
></H3
><DIV
CLASS="section"
><H4
CLASS="section"
><A
NAME="AEN12470"
>C言語インタフェース</A
></H4
><DIV
CLASS="funcsynopsis"
><P
></P
><A
NAME="AEN12472"
></A
><PRE
CLASS="funcsynopsisinfo"
>#include &#60;tk/tkernel.h&#62;</PRE
><P
><CODE
><CODE
CLASS="FUNCDEF"
>ER ercd = tk_rel_mpf</CODE
>(ID mpfid, void *blf);</CODE
></P
><P
></P
></DIV
></DIV
><DIV
CLASS="section"
><H4
CLASS="section"
><A
NAME="AEN12481"
>パラメータ</A
></H4
><DIV
CLASS="informaltable"
><P
></P
><A
NAME="AEN12483"
></A
><TABLE
BORDER="0"
FRAME="void"
RULES="none"
WIDTH="100%"
CLASS="CALSTABLE"
><COL
WIDTH="8%"
TITLE="c1"><COL
WIDTH="17%"
TITLE="c2"><COL
WIDTH="33%"
TITLE="c3"><COL
WIDTH="42%"
TITLE="c4"><TBODY
VALIGN="top"
><TR
><TD
>ID</TD
><TD
>&#13;                <CODE
CLASS="varname"
>mpfid</CODE
>
              </TD
><TD
>Memory Pool ID</TD
><TD
>固定長メモリプールID</TD
></TR
><TR
><TD
>void*</TD
><TD
>&#13;                <CODE
CLASS="varname"
>blf</CODE
>
              </TD
><TD
>Block Start Address</TD
><TD
>メモリブロックの先頭アドレス</TD
></TR
></TBODY
></TABLE
><P
></P
></DIV
></DIV
><DIV
CLASS="section"
><H4
CLASS="section"
><A
NAME="AEN12502"
>リターンパラメータ</A
></H4
><DIV
CLASS="informaltable"
><P
></P
><A
NAME="AEN12504"
></A
><TABLE
BORDER="0"
FRAME="void"
RULES="none"
WIDTH="100%"
CLASS="CALSTABLE"
><COL
WIDTH="8%"
TITLE="c1"><COL
WIDTH="17%"
TITLE="c2"><COL
WIDTH="33%"
TITLE="c3"><COL
WIDTH="42%"
TITLE="c4"><TBODY
VALIGN="top"
><TR
><TD
>ER</TD
><TD
>&#13;                <CODE
CLASS="varname"
>ercd</CODE
>
              </TD
><TD
>Error Code</TD
><TD
>エラーコード</TD
></TR
></TBODY
></TABLE
><P
></P
></DIV
></DIV
><DIV
CLASS="section"
><H4
CLASS="section"
><A
NAME="AEN12517"
>エラーコード</A
></H4
><DIV
CLASS="informaltable"
><P
></P
><A
NAME="AEN12519"
></A
><TABLE
BORDER="0"
FRAME="void"
RULES="none"
WIDTH="100%"
CLASS="CALSTABLE"
><COL
WIDTH="17%"
TITLE="c1"><COL
WIDTH="83%"
TITLE="c2"><TBODY
VALIGN="top"
><TR
><TD
>&#13;                <SPAN
CLASS="errorname"
>E_OK</SPAN
>
              </TD
><TD
>正常終了</TD
></TR
><TR
><TD
>&#13;                <SPAN
CLASS="errorname"
>E_ID</SPAN
>
              </TD
><TD
>不正ID番号(<CODE
CLASS="varname"
>mpfid</CODE
> が不正あるいは利用できない)</TD
></TR
><TR
><TD
>&#13;                <SPAN
CLASS="errorname"
>E_NOEXS</SPAN
>
              </TD
><TD
>オブジェクトが存在していない(<CODE
CLASS="varname"
>mpfid</CODE
> の固定長メモリプールが存在しない)</TD
></TR
><TR
><TD
>&#13;                <SPAN
CLASS="errorname"
>E_PAR</SPAN
>
              </TD
><TD
>パラメータエラー(<CODE
CLASS="varname"
>blf</CODE
> が不正, 異なるメモリプールへの返却)</TD
></TR
></TBODY
></TABLE
><P
></P
></DIV
></DIV
><DIV
CLASS="section"
><H4
CLASS="section"
><A
NAME="AEN12543"
>利用可能なコンテキスト</A
></H4
><DIV
CLASS="informaltable"
><P
></P
><A
NAME="AEN12545"
></A
><TABLE
BORDER="1"
FRAME="border"
RULES="all"
WIDTH="100%"
CLASS="CALSTABLE"
><COL
WIDTH="33%"><COL
WIDTH="33%"><COL
WIDTH="33%"><THEAD
><TR
><TH
ALIGN="center"
>タスク部</TH
><TH
ALIGN="center"
>準タスク部</TH
><TH
ALIGN="center"
>タスク独立部</TH
></TR
></THEAD
><TBODY
VALIGN="top"
><TR
><TD
ALIGN="center"
>○</TD
><TD
ALIGN="center"
>○</TD
><TD
ALIGN="center"
>×</TD
></TR
></TBODY
></TABLE
><P
></P
></DIV
></DIV
><DIV
CLASS="section"
><H4
CLASS="section"
><A
NAME="AEN12560"
>関連するサービスプロファイル</A
></H4
><P
>なし</P
></DIV
><DIV
CLASS="section"
><H4
CLASS="section"
><A
NAME="AEN12563"
>解説</A
></H4
><P
><CODE
CLASS="varname"
>blf</CODE
> で示されるメモリブロックを、<CODE
CLASS="varname"
>mpfid</CODE
> で示される固定長メモリプールへ返却する。</P
><P
><A
HREF="memory_pool_management_functions.html#tk_rel_mpf"
>tk_rel_mpf</A
> の実行により、<CODE
CLASS="varname"
>mpfid</CODE
> のメモリプールでメモリを待っていた別のタスクがメモリを獲得し、そのタスクの待ち状態が解除される場合がある。</P
><P
>メモリブロックの返却を行う固定長メモリプールは、メモリブロックの獲得を行った固定長メモリプールと同じものでなければならない。メモリブロックの返却を行うメモリプールが、メモリブロックの獲得を行ったメモリプールと異なっていることが検出された場合には、<SPAN
CLASS="errorname"
>E_PAR</SPAN
> のエラーとなる。ただし、エラーを検出するか否かは実装依存である。</P
></DIV
></DIV
><DIV
CLASS="section"
><H3
CLASS="section"
><A
NAME="tk_ref_mpf"
>tk_ref_mpf - 固定長メモリプール状態参照</A
></H3
><DIV
CLASS="section"
><H4
CLASS="section"
><A
NAME="AEN12575"
>C言語インタフェース</A
></H4
><DIV
CLASS="funcsynopsis"
><P
></P
><A
NAME="AEN12577"
></A
><PRE
CLASS="funcsynopsisinfo"
>#include &#60;tk/tkernel.h&#62;</PRE
><P
><CODE
><CODE
CLASS="FUNCDEF"
>ER ercd = tk_ref_mpf</CODE
>(ID mpfid, T_RMPF *pk_rmpf);</CODE
></P
><P
></P
></DIV
></DIV
><DIV
CLASS="section"
><H4
CLASS="section"
><A
NAME="AEN12586"
>パラメータ</A
></H4
><DIV
CLASS="informaltable"
><P
></P
><A
NAME="AEN12588"
></A
><TABLE
BORDER="0"
FRAME="void"
RULES="none"
WIDTH="100%"
CLASS="CALSTABLE"
><COL
WIDTH="8%"
TITLE="c1"><COL
WIDTH="17%"
TITLE="c2"><COL
WIDTH="33%"
TITLE="c3"><COL
WIDTH="42%"
TITLE="c4"><TBODY
VALIGN="top"
><TR
><TD
>ID</TD
><TD
>&#13;                <CODE
CLASS="varname"
>mpfid</CODE
>
              </TD
><TD
>Memory Pool ID</TD
><TD
>固定長メモリプールID</TD
></TR
><TR
><TD
>T_RMPF*</TD
><TD
>&#13;                <CODE
CLASS="varname"
>pk_rmpf</CODE
>
              </TD
><TD
>Packet to Refer Memory Pool Status</TD
><TD
>メモリプール状態を返す領域へのポインタ</TD
></TR
></TBODY
></TABLE
><P
></P
></DIV
></DIV
><DIV
CLASS="section"
><H4
CLASS="section"
><A
NAME="AEN12607"
>リターンパラメータ</A
></H4
><DIV
CLASS="informaltable"
><P
></P
><A
NAME="AEN12609"
></A
><TABLE
BORDER="0"
FRAME="void"
RULES="none"
WIDTH="100%"
CLASS="CALSTABLE"
><COL
WIDTH="8%"><COL
WIDTH="17%"><COL
WIDTH="33%"><COL
WIDTH="42%"><TBODY
VALIGN="top"
><TR
><TD
>ER</TD
><TD
>&#13;                <CODE
CLASS="varname"
>ercd</CODE
>
              </TD
><TD
>Error Code</TD
><TD
>エラーコード</TD
></TR
></TBODY
></TABLE
><P
></P
></DIV
><P
><CODE
CLASS="varname"
>pk_rmpf</CODE
> の内容</P
><DIV
CLASS="informaltable"
><P
></P
><A
NAME="AEN12624"
></A
><TABLE
BORDER="0"
FRAME="void"
RULES="none"
WIDTH="100%"
CLASS="CALSTABLE"
><COL
WIDTH="8%"
TITLE="c1"><COL
WIDTH="17%"
TITLE="c2"><COL
WIDTH="33%"
TITLE="c3"><COL
WIDTH="42%"
TITLE="c4"><TBODY
VALIGN="top"
><TR
><TD
>void*</TD
><TD
>&#13;                <CODE
CLASS="varname"
>exinf</CODE
>
              </TD
><TD
>Extended Information</TD
><TD
>拡張情報</TD
></TR
><TR
><TD
>ID</TD
><TD
>&#13;                <CODE
CLASS="varname"
>wtsk</CODE
>
              </TD
><TD
>Waiting Task ID</TD
><TD
>待ちタスクのID</TD
></TR
><TR
><TD
>SZ</TD
><TD
>&#13;                <CODE
CLASS="varname"
>frbcnt</CODE
>
              </TD
><TD
>Free Block Count</TD
><TD
>空き領域のブロック数</TD
></TR
><TR
><TD
COLSPAN="4"
>──(以下に実装独自に他の情報を追加してもよい)──</TD
></TR
></TBODY
></TABLE
><P
></P
></DIV
></DIV
><DIV
CLASS="section"
><H4
CLASS="section"
><A
NAME="AEN12651"
>エラーコード</A
></H4
><DIV
CLASS="informaltable"
><P
></P
><A
NAME="AEN12653"
></A
><TABLE
BORDER="0"
FRAME="void"
RULES="none"
WIDTH="100%"
CLASS="CALSTABLE"
><COL
WIDTH="17%"
TITLE="c1"><COL
WIDTH="83%"
TITLE="c2"><TBODY
VALIGN="top"
><TR
><TD
>&#13;                <SPAN
CLASS="errorname"
>E_OK</SPAN
>
              </TD
><TD
>正常終了</TD
></TR
><TR
><TD
>&#13;                <SPAN
CLASS="errorname"
>E_ID</SPAN
>
              </TD
><TD
>不正ID番号(<CODE
CLASS="varname"
>mpfid</CODE
> が不正あるいは利用できない)</TD
></TR
><TR
><TD
>&#13;                <SPAN
CLASS="errorname"
>E_NOEXS</SPAN
>
              </TD
><TD
>オブジェクトが存在していない(<CODE
CLASS="varname"
>mpfid</CODE
> の固定長メモリプールが存在しない)</TD
></TR
><TR
><TD
>&#13;                <SPAN
CLASS="errorname"
>E_PAR</SPAN
>
              </TD
><TD
>パラメータエラー(<CODE
CLASS="varname"
>pk_rmpf</CODE
> が不正)</TD
></TR
></TBODY
></TABLE
><P
></P
></DIV
></DIV
><DIV
CLASS="section"
><H4
CLASS="section"
><A
NAME="AEN12677"
>利用可能なコンテキスト</A
></H4
><DIV
CLASS="informaltable"
><P
></P
><A
NAME="AEN12679"
></A
><TABLE
BORDER="1"
FRAME="border"
RULES="all"
WIDTH="100%"
CLASS="CALSTABLE"
><COL
WIDTH="33%"><COL
WIDTH="33%"><COL
WIDTH="33%"><THEAD
><TR
><TH
ALIGN="center"
>タスク部</TH
><TH
ALIGN="center"
>準タスク部</TH
><TH
ALIGN="center"
>タスク独立部</TH
></TR
></THEAD
><TBODY
VALIGN="top"
><TR
><TD
ALIGN="center"
>○</TD
><TD
ALIGN="center"
>○</TD
><TD
ALIGN="center"
>×</TD
></TR
></TBODY
></TABLE
><P
></P
></DIV
></DIV
><DIV
CLASS="section"
><H4
CLASS="section"
><A
NAME="AEN12694"
>関連するサービスプロファイル</A
></H4
><P
>なし</P
></DIV
><DIV
CLASS="section"
><H4
CLASS="section"
><A
NAME="AEN12697"
>解説</A
></H4
><P
><CODE
CLASS="varname"
>mpfid</CODE
> で示された対象固定長メモリプールの各種の状態を参照し、リターンパラメータとして現在の空きブロック数(<CODE
CLASS="varname"
>frbcnt</CODE
>)、待ちタスクのID(<CODE
CLASS="varname"
>wtsk</CODE
>)、拡張情報(<CODE
CLASS="varname"
>exinf</CODE
>) を返す。</P
><P
><CODE
CLASS="varname"
>wtsk</CODE
> は、この固定長メモリプールで待っているタスクのIDを示す。この固定長メモリプールで複数のタスクが待っている場合には、待ち行列の先頭のタスクのIDを返す。待ちタスクが無い場合は <CODE
CLASS="varname"
>wtsk</CODE
>＝0となる。</P
><P
><A
HREF="memory_pool_management_functions.html#tk_ref_mpf"
>tk_ref_mpf</A
> で、対象固定長メモリプールが存在しない場合には、エラー <SPAN
CLASS="errorname"
>E_NOEXS</SPAN
> となる。</P
><P
>どんな場合でも、<CODE
CLASS="varname"
>frbcnt</CODE
>＝0と<CODE
CLASS="varname"
>wtsk</CODE
>＝0の少なくとも一方は成り立つ。</P
></DIV
><DIV
CLASS="section"
><H4
CLASS="section"
><A
NAME="AEN12713"
>補足事項</A
></H4
><P
><A
HREF="memory_pool_management_functions.html#tk_ref_mpl"
>tk_ref_mpl</A
> の <CODE
CLASS="varname"
>frsz</CODE
> ではメモリの空き領域の合計サイズがバイト数で返るのに対して、<A
HREF="memory_pool_management_functions.html#tk_ref_mpf"
>tk_ref_mpf</A
> の <CODE
CLASS="varname"
>frbcnt</CODE
> では空きブロックの数が返る。</P
></DIV
></DIV
></DIV
><DIV
CLASS="section"
><H2
CLASS="section"
><A
NAME="variable_size_memory_pool"
>可変長メモリプール</A
></H2
><P
>可変長メモリプールは、任意のサイズのメモリブロックを動的に管理するためのオブジェクトである。可変長メモリプール機能には、可変長メモリプールを生成／削除する機能、可変長メモリプールに対してメモリブロックを獲得／返却する機能、可変長メモリプールの状態を参照する機能が含まれる。可変長メモリプールはID番号で識別されるオブジェクトである。可変長メモリプールのID番号を可変長メモリプールIDと呼ぶ。</P
><P
>可変長メモリプールは、可変長メモリプールとして利用するメモリ領域(これを可変長メモリプール領域、または単にメモリプール領域と呼ぶ)と、メモリブロックの獲得を待つタスクの待ち行列を持つ。可変長メモリプールからメモリブロックを獲得するタスクは、メモリプール領域の空き領域が足りなくなった場合、十分なサイズのメモリブロックが返却されるまで可変長メモリブロックの獲得待ち状態となる。可変長メモリブロックの獲得待ち状態になったタスクは、その可変長メモリプールの待ち行列につながれる。</P
><DIV
CLASS="note"
><P
></P
><TABLE
CLASS="note"
WIDTH="100%"
BORDER="0"
><TR
><TD
WIDTH="25"
ALIGN="CENTER"
VALIGN="TOP"
><IMG
SRC="../images/note.gif"
HSPACE="5"
ALT="注意"></TD
><TH
ALIGN="LEFT"
VALIGN="MIDDLE"
><B
>補足事項</B
></TH
></TR
><TR
><TD
>&nbsp;</TD
><TD
ALIGN="LEFT"
VALIGN="TOP"
><P
>可変長メモリプールでメモリブロックの獲得を待っているタスクは、待ち行列につながれている順序でメモリブロックを獲得する。例えば、ある可変長メモリプールに対して400バイトのメモリブロックを獲得しようとしているタスクAと、100バイトのメモリブロックを獲得しようとしているタスクBが、この順で待ち行列につながれている時に、別のタスクからのメモリブロックの返却により200バイトの連続空きメモリ領域ができたとする。このような場合でも、タスクAがメモリブロックを獲得するまで、タスクBはメモリブロックを獲得できない。</P
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="section"
><H3
CLASS="section"
><A
NAME="tk_cre_mpl"
>tk_cre_mpl - 可変長メモリプール生成</A
></H3
><DIV
CLASS="section"
><H4
CLASS="section"
><A
NAME="AEN12729"
>C言語インタフェース</A
></H4
><DIV
CLASS="funcsynopsis"
><P
></P
><A
NAME="AEN12731"
></A
><PRE
CLASS="funcsynopsisinfo"
>#include &#60;tk/tkernel.h&#62;</PRE
><P
><CODE
><CODE
CLASS="FUNCDEF"
>ID mplid = tk_cre_mpl</CODE
>(CONST T_CMPL *pk_cmpl);</CODE
></P
><P
></P
></DIV
></DIV
><DIV
CLASS="section"
><H4
CLASS="section"
><A
NAME="AEN12738"
>パラメータ</A
></H4
><DIV
CLASS="informaltable"
><P
></P
><A
NAME="AEN12740"
></A
><TABLE
BORDER="0"
FRAME="void"
RULES="none"
WIDTH="100%"
CLASS="CALSTABLE"
><COL
WIDTH="21%"><COL
WIDTH="14%"><COL
WIDTH="29%"><COL
WIDTH="36%"><TBODY
VALIGN="top"
><TR
><TD
>CONST T_CMPL*</TD
><TD
>&#13;                <CODE
CLASS="varname"
>pk_cmpl</CODE
>
              </TD
><TD
>Packet to Create Memory Pool</TD
><TD
>可変長メモリプール生成情報</TD
></TR
></TBODY
></TABLE
><P
></P
></DIV
><P
><CODE
CLASS="varname"
>pk_cmpl</CODE
> の内容</P
><DIV
CLASS="informaltable"
><P
></P
><A
NAME="AEN12755"
></A
><TABLE
BORDER="0"
FRAME="void"
RULES="none"
WIDTH="100%"
CLASS="CALSTABLE"
><COL
WIDTH="21%"
TITLE="c1"><COL
WIDTH="14%"
TITLE="c2"><COL
WIDTH="29%"
TITLE="c3"><COL
WIDTH="36%"
TITLE="c4"><TBODY
VALIGN="top"
><TR
><TD
>void*</TD
><TD
>&#13;                <CODE
CLASS="varname"
>exinf</CODE
>
              </TD
><TD
>Extended Information</TD
><TD
>拡張情報</TD
></TR
><TR
><TD
>ATR</TD
><TD
>&#13;                <CODE
CLASS="varname"
>mplatr</CODE
>
              </TD
><TD
>Memory Pool Attribute</TD
><TD
>メモリプール属性</TD
></TR
><TR
><TD
>SZ</TD
><TD
>&#13;                <CODE
CLASS="varname"
>mplsz</CODE
>
              </TD
><TD
>Memory Pool Size</TD
><TD
>メモリプール全体のサイズ(バイト数)</TD
></TR
><TR
><TD
>UB</TD
><TD
>&#13;                <CODE
CLASS="varname"
>dsname[8]</CODE
>
              </TD
><TD
>DS Object name</TD
><TD
>DSオブジェクト名称</TD
></TR
><TR
><TD
>void*</TD
><TD
>&#13;                <CODE
CLASS="varname"
>bufptr</CODE
>
              </TD
><TD
>Buffer Pointer</TD
><TD
>ユーザバッファポインタ</TD
></TR
><TR
><TD
COLSPAN="4"
>──(以下に実装独自に他の情報を追加してもよい)──</TD
></TR
></TBODY
></TABLE
><P
></P
></DIV
></DIV
><DIV
CLASS="section"
><H4
CLASS="section"
><A
NAME="AEN12794"
>リターンパラメータ</A
></H4
><DIV
CLASS="informaltable"
><P
></P
><A
NAME="AEN12796"
></A
><TABLE
BORDER="0"
FRAME="void"
RULES="none"
WIDTH="100%"
CLASS="CALSTABLE"
><COL
WIDTH="21%"
TITLE="c1"><COL
WIDTH="14%"
TITLE="c2"><COL
WIDTH="29%"
TITLE="c3"><COL
WIDTH="36%"
TITLE="c4"><TBODY
VALIGN="top"
><TR
><TD
>ID</TD
><TD
>&#13;                <CODE
CLASS="varname"
>mplid</CODE
>
              </TD
><TD
>Memory Pool ID</TD
><TD
>可変長メモリプールID</TD
></TR
><TR
><TD
COLSPAN="2"
ALIGN="right"
>または</TD
><TD
>Error Code</TD
><TD
>エラーコード</TD
></TR
></TBODY
></TABLE
><P
></P
></DIV
></DIV
><DIV
CLASS="section"
><H4
CLASS="section"
><A
NAME="AEN12813"
>エラーコード</A
></H4
><DIV
CLASS="informaltable"
><P
></P
><A
NAME="AEN12815"
></A
><TABLE
BORDER="0"
FRAME="void"
RULES="none"
WIDTH="100%"
CLASS="CALSTABLE"
><COL
WIDTH="17%"
TITLE="c1"><COL
WIDTH="83%"
TITLE="c2"><TBODY
VALIGN="top"
><TR
><TD
>&#13;                <SPAN
CLASS="errorname"
>E_NOMEM</SPAN
>
              </TD
><TD
>メモリ不足(管理ブロックやメモリプール用の領域が確保できない)</TD
></TR
><TR
><TD
>&#13;                <SPAN
CLASS="errorname"
>E_LIMIT</SPAN
>
              </TD
><TD
>可変長メモリプールの数がシステムの上限を超えた</TD
></TR
><TR
><TD
>&#13;                <SPAN
CLASS="errorname"
>E_RSATR</SPAN
>
              </TD
><TD
>予約属性(<CODE
CLASS="varname"
>mplatr</CODE
> が不正あるいは利用できない)</TD
></TR
><TR
><TD
>&#13;                <SPAN
CLASS="errorname"
>E_PAR</SPAN
>
              </TD
><TD
>パラメータエラー(<CODE
CLASS="varname"
>pk_cmpl</CODE
> が不正, <CODE
CLASS="varname"
>mplsz</CODE
> が負または不正, <CODE
CLASS="varname"
>bufptr</CODE
> が不正)</TD
></TR
></TBODY
></TABLE
><P
></P
></DIV
></DIV
><DIV
CLASS="section"
><H4
CLASS="section"
><A
NAME="AEN12840"
>利用可能なコンテキスト</A
></H4
><DIV
CLASS="informaltable"
><P
></P
><A
NAME="AEN12842"
></A
><TABLE
BORDER="1"
FRAME="border"
RULES="all"
WIDTH="100%"
CLASS="CALSTABLE"
><COL
WIDTH="33%"><COL
WIDTH="33%"><COL
WIDTH="33%"><THEAD
><TR
><TH
ALIGN="center"
>タスク部</TH
><TH
ALIGN="center"
>準タスク部</TH
><TH
ALIGN="center"
>タスク独立部</TH
></TR
></THEAD
><TBODY
VALIGN="top"
><TR
><TD
ALIGN="center"
>○</TD
><TD
ALIGN="center"
>○</TD
><TD
ALIGN="center"
>×</TD
></TR
></TBODY
></TABLE
><P
></P
></DIV
></DIV
><DIV
CLASS="section"
><H4
CLASS="section"
><A
NAME="AEN12857"
>関連するサービスプロファイル</A
></H4
><DIV
CLASS="informaltable"
><P
></P
><A
NAME="AEN12859"
></A
><TABLE
BORDER="0"
FRAME="void"
RULES="none"
WIDTH="100%"
CLASS="CALSTABLE"
><COL
WIDTH="38%"
TITLE="c1"><COL
WIDTH="62%"><TBODY
VALIGN="top"
><TR
><TD
>&#13;                <TT
CLASS="literal"
>TK_SUPPORT_USERBUF</TT
>
              </TD
><TD
><TT
CLASS="literal"
>TA_USERBUF</TT
>の可変長メモリプール属性指定が可能</TD
></TR
><TR
><TD
>&#13;                <TT
CLASS="literal"
>TK_SUPPORT_AUTOBUF</TT
>
              </TD
><TD
>自動バッファ割当て(<TT
CLASS="literal"
>TA_USERBUF</TT
>の可変長メモリプール属性指定なし)が可能</TD
></TR
><TR
><TD
>&#13;                <TT
CLASS="literal"
>TK_SUPPORT_DISWAI</TT
>
              </TD
><TD
>可変長メモリプール属性として<TT
CLASS="literal"
>TA_NODISWAI</TT
>(待ち禁止の拒否)が指定可能</TD
></TR
><TR
><TD
>&#13;                <TT
CLASS="literal"
>TK_SUPPORT_DSNAME</TT
>
              </TD
><TD
><TT
CLASS="literal"
>TA_DSNAME</TT
>の可変長メモリプール属性指定が可能</TD
></TR
></TBODY
></TABLE
><P
></P
></DIV
></DIV
><DIV
CLASS="section"
><H4
CLASS="section"
><A
NAME="AEN12884"
>解説</A
></H4
><P
>可変長メモリプールを生成し可変長メモリプールIDを割り当てる。具体的には、<CODE
CLASS="varname"
>mplsz</CODE
> の情報を元に、メモリプールとして利用するメモリ領域を確保する。また、生成したメモリプールに対して管理ブロックを割り付ける。</P
><P
><CODE
CLASS="varname"
>exinf</CODE
> は、対象メモリプールに関する情報を入れておくためにユーザが自由に利用できる。ここで設定した情報は、<A
HREF="memory_pool_management_functions.html#tk_ref_mpl"
>tk_ref_mpl</A
> で取り出すことができる。なお、ユーザの情報を入れるためにもっと大きな領域がほしい場合や、途中で内容を変更したい場合には、自分でそのためのメモリを確保し、そのメモリパケットのアドレスを <CODE
CLASS="varname"
>exinf</CODE
> に入れる。カーネルでは <CODE
CLASS="varname"
>exinf</CODE
> の内容について関知しない。</P
><P
><CODE
CLASS="varname"
>mplatr</CODE
> は、下位側がシステム属性を表し、上位側が実装独自属性を表す。<CODE
CLASS="varname"
>mplatr</CODE
> のシステム属性の部分では、次のような指定を行う。</P
><PRE
CLASS="synopsis"
>&#13;mplatr := (TA_TFIFO || TA_TPRI) | [TA_DSNAME] | [TA_USERBUF] | [TA_NODISWAI]
       | (TA_RNG0 || TA_RNG1 || TA_RNG2 || TA_RNG3)
</PRE
><DIV
CLASS="informaltable"
><P
></P
><A
NAME="AEN12897"
></A
><TABLE
BORDER="0"
FRAME="void"
RULES="none"
WIDTH="100%"
CLASS="CALSTABLE"
><COL
WIDTH="17%"
TITLE="c1"><COL
WIDTH="83%"><TBODY
VALIGN="top"
><TR
><TD
>&#13;                <TT
CLASS="literal"
>TA_TFIFO</TT
>
              </TD
><TD
>メモリ獲得待ちタスクのキューイングはFIFO</TD
></TR
><TR
><TD
>&#13;                <TT
CLASS="literal"
>TA_TPRI</TT
>
              </TD
><TD
>メモリ獲得待ちタスクのキューイングは優先度順</TD
></TR
><TR
><TD
>&#13;                <TT
CLASS="literal"
>TA_RNGn</TT
>
              </TD
><TD
>メモリのアクセス制限を保護レベルnとする</TD
></TR
><TR
><TD
>&#13;                <TT
CLASS="literal"
>TA_DSNAME</TT
>
              </TD
><TD
>DSオブジェクト名称を指定する</TD
></TR
><TR
><TD
>&#13;                <TT
CLASS="literal"
>TA_USERBUF</TT
>
              </TD
><TD
>メモリプール領域としてユーザが指定した領域を利用する</TD
></TR
><TR
><TD
>&#13;                <TT
CLASS="literal"
>TA_NODISWAI</TT
>
              </TD
><TD
><A
HREF="task_dependent_synchronization_functions.html#tk_dis_wai"
>tk_dis_wai</A
> による待ち禁止を拒否する</TD
></TR
></TBODY
></TABLE
><P
></P
></DIV
><PRE
CLASS="programlisting"
>&#13;#define TA_TFIFO        0x00000000      /* 待ちタスクをFIFOで管理 */
#define TA_TPRI         0x00000001      /* 待ちタスクを優先度順で管理 */
#define TA_USERBUF      0x00000020      /* ユーザバッファポインタを指定 */
#define TA_DSNAME       0x00000040      /* DSオブジェクト名称を指定 */
#define TA_NODISWAI     0x00000080      /* 待ち禁止拒否 */
#define TA_RNG0         0x00000000      /* 保護レベル0 */
#define TA_RNG1         0x00000100      /* 保護レベル1 */
#define TA_RNG2         0x00000200      /* 保護レベル2 */
#define TA_RNG3         0x00000300      /* 保護レベル3 */
</PRE
><P
><TT
CLASS="literal"
>TA_TFIFO</TT
>, <TT
CLASS="literal"
>TA_TPRI</TT
> では、タスクがメモリ獲得のためにメモリプールの待ち行列に並ぶ際の並び方を指定することができる。属性が <TT
CLASS="literal"
>TA_TFIFO</TT
> であればタスクの待ち行列はFIFOとなり、属性が <TT
CLASS="literal"
>TA_TPRI</TT
> であればタスクの待ち行列はタスクの優先度順となる。</P
><P
>タスクがメモリ獲得待ちの行列を作った場合は、待ち行列先頭のタスクに優先してメモリを割り当てる。待ち行列の２番目以降により少ないメモリサイズを要求しているタスクがあった場合も、そのタスクが先にメモリを獲得することはない。例えば、ある可変長メモリプールに対して 要求メモリサイズ＝400のタスクAと要求メモリサイズ＝100のタスクBがこの順で待っており、別のタスクの <A
HREF="memory_pool_management_functions.html#tk_rel_mpl"
>tk_rel_mpl</A
> により メモリサイズ＝200の連続空きメモリ領域ができたとする。このとき、行列の先頭ではないが要求サイズの少ないタスクBが先にメモリを獲得することはない。</P
><P
><TT
CLASS="literal"
>TA_RNGn</TT
> では、メモリのアクセスを制限する保護レベルを指定する。指定された保護レベルと同じかより高い保護レベルで実行しているタスクからのみアクセス可能である。低いレベルで実行しているタスクがアクセスするとCPUの保護違反の例外が発生する。例えば、<TT
CLASS="literal"
>TA_RNG1</TT
> を指定して作成したメモリプールから獲得したメモリは、<TT
CLASS="literal"
>TA_RNG0</TT
> や <TT
CLASS="literal"
>TA_RNG1</TT
> で動作しているタスクからはアクセス可能だが、<TT
CLASS="literal"
>TA_RNG2</TT
> や <TT
CLASS="literal"
>TA_RNG3</TT
> で動作しているタスクからはアクセスできない。</P
><P
><TT
CLASS="literal"
>TA_DSNAME</TT
> を指定した場合に <CODE
CLASS="varname"
>dsname</CODE
> が有効となり、DSオブジェクト名称として設定される。DSオブジェクト名称はデバッガがオブジェクトを識別するために使用され、T-Kernel/DSのシステムコール <A
HREF="utk_ds_functions.html#td_ref_dsname"
>td_ref_dsname</A
> と <A
HREF="utk_ds_functions.html#td_set_dsname"
>td_set_dsname</A
> からのみ操作可能である。詳細は <A
HREF="utk_ds_functions.html#td_ref_dsname"
>td_ref_dsname</A
> 、<A
HREF="utk_ds_functions.html#td_set_dsname"
>td_set_dsname</A
> を参照のこと。<TT
CLASS="literal"
>TA_DSNAME</TT
> を指定しなかった場合は、<CODE
CLASS="varname"
>dsname</CODE
> が無視され、<A
HREF="utk_ds_functions.html#td_ref_dsname"
>td_ref_dsname</A
> や <A
HREF="utk_ds_functions.html#td_set_dsname"
>td_set_dsname</A
> が、<SPAN
CLASS="errorname"
>E_OBJ</SPAN
> エラーとなる。</P
></DIV
><DIV
CLASS="section"
><H4
CLASS="section"
><A
NAME="AEN12954"
>補足事項</A
></H4
><P
>メモリ獲得待ち行列の先頭のタスクの待ちが強制解除されたり、タスク優先度が変更されるなどで待ち行列の順序が変化した場合は、新たに待ち行列の先頭になったタスクに対してメモリ割当てが試みられる。メモリを割り当てることができれば、そのタスクの待ちは解除される。したがって、<A
HREF="memory_pool_management_functions.html#tk_rel_mpl"
>tk_rel_mpl</A
> によるメモリの解放がなくても、状況によってはメモリの獲得が行われ、待ちが解除される場合がある。</P
><P
>CPUの実行モードがないシステムにおいても、移植性確保のために <TT
CLASS="literal"
>TA_RNGn</TT
> 属性を受け付けなければならない。例えば、<TT
CLASS="literal"
>TA_RNGn</TT
> の指定はすべて <TT
CLASS="literal"
>TA_RNG0</TT
> 相当として処理してもよいが、エラーとはしない。</P
></DIV
><DIV
CLASS="section"
><H4
CLASS="section"
><A
NAME="AEN12962"
>仕様決定の理由</A
></H4
><P
>複数個の可変長メモリプールを設ける機能は、エラー処理時や緊急時などにメモリを確保するためのメモリプールを分離しておくために利用できる。</P
></DIV
><DIV
CLASS="section"
><H4
CLASS="section"
><A
NAME="AEN12965"
>移植ガイドライン</A
></H4
><P
>T-Kernel 2.0には<TT
CLASS="literal"
>TA_USERBUF</TT
>と<CODE
CLASS="varname"
>bufptr</CODE
>が存在しない。そのため、この機能を使っている場合はT-Kernel 2.0への移植の際に修正が必要となるが、正しく<CODE
CLASS="varname"
>mplsz</CODE
>を設定してあれば、<TT
CLASS="literal"
>TA_USERBUF</TT
>と<CODE
CLASS="varname"
>bufptr</CODE
>を削除するだけで移植ができる。</P
></DIV
></DIV
><DIV
CLASS="section"
><H3
CLASS="section"
><A
NAME="tk_del_mpl"
>tk_del_mpl - 可変長メモリプール削除</A
></H3
><DIV
CLASS="section"
><H4
CLASS="section"
><A
NAME="AEN12975"
>C言語インタフェース</A
></H4
><DIV
CLASS="funcsynopsis"
><P
></P
><A
NAME="AEN12977"
></A
><PRE
CLASS="funcsynopsisinfo"
>#include &#60;tk/tkernel.h&#62;</PRE
><P
><CODE
><CODE
CLASS="FUNCDEF"
>ER ercd = tk_del_mpl</CODE
>(ID mplid);</CODE
></P
><P
></P
></DIV
></DIV
><DIV
CLASS="section"
><H4
CLASS="section"
><A
NAME="AEN12984"
>パラメータ</A
></H4
><DIV
CLASS="informaltable"
><P
></P
><A
NAME="AEN12986"
></A
><TABLE
BORDER="0"
FRAME="void"
RULES="none"
WIDTH="100%"
CLASS="CALSTABLE"
><COL
WIDTH="8%"
TITLE="c1"><COL
WIDTH="17%"
TITLE="c2"><COL
WIDTH="33%"
TITLE="c3"><COL
WIDTH="42%"
TITLE="c4"><TBODY
VALIGN="top"
><TR
><TD
>ID</TD
><TD
>&#13;                <CODE
CLASS="varname"
>mplid</CODE
>
              </TD
><TD
>Memory Pool ID</TD
><TD
>可変長メモリプールID</TD
></TR
></TBODY
></TABLE
><P
></P
></DIV
></DIV
><DIV
CLASS="section"
><H4
CLASS="section"
><A
NAME="AEN12999"
>リターンパラメータ</A
></H4
><DIV
CLASS="informaltable"
><P
></P
><A
NAME="AEN13001"
></A
><TABLE
BORDER="0"
FRAME="void"
RULES="none"
WIDTH="100%"
CLASS="CALSTABLE"
><COL
WIDTH="8%"
TITLE="c1"><COL
WIDTH="17%"
TITLE="c2"><COL
WIDTH="33%"
TITLE="c3"><COL
WIDTH="42%"
TITLE="c4"><TBODY
VALIGN="top"
><TR
><TD
>ER</TD
><TD
>&#13;                <CODE
CLASS="varname"
>ercd</CODE
>
              </TD
><TD
>Error Code</TD
><TD
>エラーコード</TD
></TR
></TBODY
></TABLE
><P
></P
></DIV
></DIV
><DIV
CLASS="section"
><H4
CLASS="section"
><A
NAME="AEN13014"
>エラーコード</A
></H4
><DIV
CLASS="informaltable"
><P
></P
><A
NAME="AEN13016"
></A
><TABLE
BORDER="0"
FRAME="void"
RULES="none"
WIDTH="100%"
CLASS="CALSTABLE"
><COL
WIDTH="17%"
TITLE="c1"><COL
WIDTH="83%"
TITLE="c2"><TBODY
VALIGN="top"
><TR
><TD
>&#13;                <SPAN
CLASS="errorname"
>E_OK</SPAN
>
              </TD
><TD
>正常終了</TD
></TR
><TR
><TD
>&#13;                <SPAN
CLASS="errorname"
>E_ID</SPAN
>
              </TD
><TD
>不正ID番号(<CODE
CLASS="varname"
>mplid</CODE
> が不正あるいは利用できない)</TD
></TR
><TR
><TD
>&#13;                <SPAN
CLASS="errorname"
>E_NOEXS</SPAN
>
              </TD
><TD
>オブジェクトが存在していない(<CODE
CLASS="varname"
>mplid</CODE
> の可変長メモリプールが存在しない)</TD
></TR
></TBODY
></TABLE
><P
></P
></DIV
></DIV
><DIV
CLASS="section"
><H4
CLASS="section"
><A
NAME="AEN13035"
>利用可能なコンテキスト</A
></H4
><DIV
CLASS="informaltable"
><P
></P
><A
NAME="AEN13037"
></A
><TABLE
BORDER="1"
FRAME="border"
RULES="all"
WIDTH="100%"
CLASS="CALSTABLE"
><COL
WIDTH="33%"><COL
WIDTH="33%"><COL
WIDTH="33%"><THEAD
><TR
><TH
ALIGN="center"
>タスク部</TH
><TH
ALIGN="center"
>準タスク部</TH
><TH
ALIGN="center"
>タスク独立部</TH
></TR
></THEAD
><TBODY
VALIGN="top"
><TR
><TD
ALIGN="center"
>○</TD
><TD
ALIGN="center"
>○</TD
><TD
ALIGN="center"
>×</TD
></TR
></TBODY
></TABLE
><P
></P
></DIV
></DIV
><DIV
CLASS="section"
><H4
CLASS="section"
><A
NAME="AEN13052"
>関連するサービスプロファイル</A
></H4
><P
>なし</P
></DIV
><DIV
CLASS="section"
><H4
CLASS="section"
><A
NAME="AEN13055"
>解説</A
></H4
><P
><CODE
CLASS="varname"
>mplid</CODE
> で示される可変長メモリプールを削除する。</P
><P
>このメモリプールからメモリを獲得しているタスクが存在しても、そのチェックや通知は行われない。すべてのメモリブロックが返却されていなくても、このシステムコールは正常終了する。</P
><P
>本システムコールの発行により、対象メモリプールのID番号および管理ブロック用の領域やメモリプール本体の領域は解放される。</P
><P
>対象メモリプールにおいてメモリ獲得を待っているタスクがあった場合にも、本システムコールは正常終了するが、待ち状態にあったタスクにはエラー <SPAN
CLASS="errorname"
>E_DLT</SPAN
> が返される。</P
></DIV
></DIV
><DIV
CLASS="section"
><H3
CLASS="section"
><A
NAME="tk_get_mpl"
>tk_get_mpl - 可変長メモリブロック獲得</A
></H3
><DIV
CLASS="section"
><H4
CLASS="section"
><A
NAME="AEN13065"
>C言語インタフェース</A
></H4
><DIV
CLASS="funcsynopsis"
><P
></P
><A
NAME="AEN13067"
></A
><PRE
CLASS="funcsynopsisinfo"
>#include &#60;tk/tkernel.h&#62;</PRE
><P
><CODE
><CODE
CLASS="FUNCDEF"
>ER ercd = tk_get_mpl</CODE
>(ID mplid, SZ blksz, void **p_blk, TMO tmout);</CODE
></P
><P
></P
></DIV
></DIV
><DIV
CLASS="section"
><H4
CLASS="section"
><A
NAME="AEN13080"
>パラメータ</A
></H4
><DIV
CLASS="informaltable"
><P
></P
><A
NAME="AEN13082"
></A
><TABLE
BORDER="0"
FRAME="void"
RULES="none"
WIDTH="100%"
CLASS="CALSTABLE"
><COL
WIDTH="8%"
TITLE="c1"><COL
WIDTH="17%"
TITLE="c2"><COL
WIDTH="33%"
TITLE="c3"><COL
WIDTH="42%"
TITLE="c4"><TBODY
VALIGN="top"
><TR
><TD
>ID</TD
><TD
>&#13;                <CODE
CLASS="varname"
>mplid</CODE
>
              </TD
><TD
>Memory Pool ID</TD
><TD
>可変長メモリプールID</TD
></TR
><TR
><TD
>SZ</TD
><TD
>&#13;                <CODE
CLASS="varname"
>blksz</CODE
>
              </TD
><TD
>Memory Block Size</TD
><TD
>メモリブロックサイズ(バイト数)</TD
></TR
><TR
><TD
>void**</TD
><TD
>&#13;                <CODE
CLASS="varname"
>p_blk</CODE
>
              </TD
><TD
>Pointer to Block Start Address</TD
><TD
>リターンパラメータ <CODE
CLASS="varname"
>blk</CODE
> を返す領域へのポインタ</TD
></TR
><TR
><TD
>TMO</TD
><TD
>&#13;                <CODE
CLASS="varname"
>tmout</CODE
>
              </TD
><TD
>Timeout</TD
><TD
>タイムアウト指定(ミリ秒)</TD
></TR
></TBODY
></TABLE
><P
></P
></DIV
></DIV
><DIV
CLASS="section"
><H4
CLASS="section"
><A
NAME="AEN13114"
>リターンパラメータ</A
></H4
><DIV
CLASS="informaltable"
><P
></P
><A
NAME="AEN13116"
></A
><TABLE
BORDER="0"
FRAME="void"
RULES="none"
WIDTH="100%"
CLASS="CALSTABLE"
><COL
WIDTH="8%"
TITLE="c1"><COL
WIDTH="17%"
TITLE="c2"><COL
WIDTH="33%"
TITLE="c3"><COL
WIDTH="42%"
TITLE="c4"><TBODY
VALIGN="top"
><TR
><TD
>ER</TD
><TD
>&#13;                <CODE
CLASS="varname"
>ercd</CODE
>
              </TD
><TD
>Error Code</TD
><TD
>エラーコード</TD
></TR
><TR
><TD
>void*</TD
><TD
>&#13;                <CODE
CLASS="varname"
>blk</CODE
>
              </TD
><TD
>Block Start Address</TD
><TD
>メモリブロックの先頭アドレス</TD
></TR
></TBODY
></TABLE
><P
></P
></DIV
></DIV
><DIV
CLASS="section"
><H4
CLASS="section"
><A
NAME="AEN13135"
>エラーコード</A
></H4
><DIV
CLASS="informaltable"
><P
></P
><A
NAME="AEN13137"
></A
><TABLE
BORDER="0"
FRAME="void"
RULES="none"
WIDTH="100%"
CLASS="CALSTABLE"
><COL
WIDTH="17%"
TITLE="c1"><COL
WIDTH="83%"
TITLE="c2"><TBODY
VALIGN="top"
><TR
><TD
>&#13;                <SPAN
CLASS="errorname"
>E_OK</SPAN
>
              </TD
><TD
>正常終了</TD
></TR
><TR
><TD
>&#13;                <SPAN
CLASS="errorname"
>E_ID</SPAN
>
              </TD
><TD
>不正ID番号(<CODE
CLASS="varname"
>mplid</CODE
> が不正あるいは利用できない)</TD
></TR
><TR
><TD
>&#13;                <SPAN
CLASS="errorname"
>E_NOEXS</SPAN
>
              </TD
><TD
>オブジェクトが存在していない(<CODE
CLASS="varname"
>mplid</CODE
> の可変長メモリプールが存在しない)</TD
></TR
><TR
><TD
>&#13;                <SPAN
CLASS="errorname"
>E_PAR</SPAN
>
              </TD
><TD
>パラメータエラー(<CODE
CLASS="varname"
>tmout</CODE
>≦(-2))</TD
></TR
><TR
><TD
>&#13;                <SPAN
CLASS="errorname"
>E_DLT</SPAN
>
              </TD
><TD
>待ちオブジェクトが削除された(待ちの間に対象メモリプールが削除)</TD
></TR
><TR
><TD
>&#13;                <SPAN
CLASS="errorname"
>E_RLWAI</SPAN
>
              </TD
><TD
>待ち状態強制解除(待ちの間に <A
HREF="task_dependent_synchronization_functions.html#tk_rel_wai"
>tk_rel_wai</A
> を受け付け)</TD
></TR
><TR
><TD
>&#13;                <SPAN
CLASS="errorname"
>E_DISWAI</SPAN
>
              </TD
><TD
>待ち禁止による待ち解除</TD
></TR
><TR
><TD
>&#13;                <SPAN
CLASS="errorname"
>E_TMOUT</SPAN
>
              </TD
><TD
>ポーリング失敗またはタイムアウト</TD
></TR
><TR
><TD
>&#13;                <SPAN
CLASS="errorname"
>E_CTX</SPAN
>
              </TD
><TD
>コンテキストエラー(タスク独立部またはディスパッチ禁止状態で実行)</TD
></TR
></TBODY
></TABLE
><P
></P
></DIV
></DIV
><DIV
CLASS="section"
><H4
CLASS="section"
><A
NAME="AEN13182"
>利用可能なコンテキスト</A
></H4
><DIV
CLASS="informaltable"
><P
></P
><A
NAME="AEN13184"
></A
><TABLE
BORDER="1"
FRAME="border"
RULES="all"
WIDTH="100%"
CLASS="CALSTABLE"
><COL
WIDTH="33%"><COL
WIDTH="33%"><COL
WIDTH="33%"><THEAD
><TR
><TH
ALIGN="center"
>タスク部</TH
><TH
ALIGN="center"
>準タスク部</TH
><TH
ALIGN="center"
>タスク独立部</TH
></TR
></THEAD
><TBODY
VALIGN="top"
><TR
><TD
ALIGN="center"
>○</TD
><TD
ALIGN="center"
>○</TD
><TD
ALIGN="center"
>×</TD
></TR
></TBODY
></TABLE
><P
></P
></DIV
></DIV
><DIV
CLASS="section"
><H4
CLASS="section"
><A
NAME="AEN13199"
>関連するサービスプロファイル</A
></H4
><P
>なし</P
></DIV
><DIV
CLASS="section"
><H4
CLASS="section"
><A
NAME="AEN13202"
>解説</A
></H4
><P
><CODE
CLASS="varname"
>mplid</CODE
> で示される可変長メモリプールから、<CODE
CLASS="varname"
>blksz</CODE
> で指定されるサイズ(バイト数)のメモリブロックを獲得する。獲得したメモリブロックの先頭アドレスが <CODE
CLASS="varname"
>blk</CODE
> に返される。</P
><P
>獲得したメモリのゼロクリアは行われず、獲得されたメモリブロックの内容は不定となる。</P
><P
>メモリが獲得できなければ、本システムコールを発行したタスクは待ち状態に入る。</P
><P
><CODE
CLASS="varname"
>tmout</CODE
> により待ち時間の最大値(タイムアウト値)を指定することができる。<CODE
CLASS="varname"
>tmout</CODE
> の基準時間(時間の単位)はシステム時刻の基準時間(＝1ミリ秒)と同じである。タイムアウト指定が行われた場合、待ち解除の条件が満足されない(空きメモリができない)まま <CODE
CLASS="varname"
>tmout</CODE
> の時間が経過すると、タイムアウトエラー <SPAN
CLASS="errorname"
>E_TMOUT</SPAN
> となってシステムコールが終了する。</P
><P
><CODE
CLASS="varname"
>tmout</CODE
> として <TT
CLASS="literal"
>TMO_POL</TT
>＝0を指定した場合は、タイムアウト値として0を指定したことを示し、メモリが獲得できなかった場合も待ちに入ることなく <SPAN
CLASS="errorname"
>E_TMOUT</SPAN
> を返す。</P
><P
><CODE
CLASS="varname"
>tmout</CODE
> として <TT
CLASS="literal"
>TMO_FEVR</TT
>＝(-1)を指定した場合は、タイムアウト値として無限大の時間を指定したことを示し、タイムアウトせずにメモリが獲得できるまで待ち続ける。</P
><P
>メモリブロック獲得待ちを行う場合の待ち行列の順序は、メモリプールの属性によって、FIFOまたはタスク優先度順のいずれかとなる。</P
></DIV
></DIV
><DIV
CLASS="section"
><H3
CLASS="section"
><A
NAME="tk_get_mpl_u"
>tk_get_mpl_u - 可変長メモリブロック獲得(マイクロ秒単位)</A
></H3
><DIV
CLASS="section"
><H4
CLASS="section"
><A
NAME="AEN13225"
>C言語インタフェース</A
></H4
><DIV
CLASS="funcsynopsis"
><P
></P
><A
NAME="AEN13227"
></A
><PRE
CLASS="funcsynopsisinfo"
>#include &#60;tk/tkernel.h&#62;</PRE
><P
><CODE
><CODE
CLASS="FUNCDEF"
>ER ercd = tk_get_mpl_u</CODE
>(ID mplid, SZ blksz, void **p_blk, TMO_U tmout_u);</CODE
></P
><P
></P
></DIV
></DIV
><DIV
CLASS="section"
><H4
CLASS="section"
><A
NAME="AEN13240"
>パラメータ</A
></H4
><DIV
CLASS="informaltable"
><P
></P
><A
NAME="AEN13242"
></A
><TABLE
BORDER="0"
FRAME="void"
RULES="none"
WIDTH="100%"
CLASS="CALSTABLE"
><COL
WIDTH="8%"
TITLE="c1"><COL
WIDTH="17%"
TITLE="c2"><COL
WIDTH="33%"
TITLE="c3"><COL
WIDTH="42%"
TITLE="c4"><TBODY
VALIGN="top"
><TR
><TD
>ID</TD
><TD
>&#13;                <CODE
CLASS="varname"
>mplid</CODE
>
              </TD
><TD
>Memory Pool ID</TD
><TD
>可変長メモリプールID</TD
></TR
><TR
><TD
>SZ</TD
><TD
>&#13;                <CODE
CLASS="varname"
>blksz</CODE
>
              </TD
><TD
>Memory Block Size</TD
><TD
>メモリブロックサイズ(バイト数)</TD
></TR
><TR
><TD
>void**</TD
><TD
>&#13;                <CODE
CLASS="varname"
>p_blk</CODE
>
              </TD
><TD
>Pointer to Block Start Address</TD
><TD
>リターンパラメータ <CODE
CLASS="varname"
>blk</CODE
> を返す領域へのポインタ</TD
></TR
><TR
><TD
>TMO_U</TD
><TD
>&#13;                <CODE
CLASS="varname"
>tmout_u</CODE
>
              </TD
><TD
>Timeout</TD
><TD
>タイムアウト指定(マイクロ秒)</TD
></TR
></TBODY
></TABLE
><P
></P
></DIV
></DIV
><DIV
CLASS="section"
><H4
CLASS="section"
><A
NAME="AEN13274"
>リターンパラメータ</A
></H4
><DIV
CLASS="informaltable"
><P
></P
><A
NAME="AEN13276"
></A
><TABLE
BORDER="0"
FRAME="void"
RULES="none"
WIDTH="100%"
CLASS="CALSTABLE"
><COL
WIDTH="8%"
TITLE="c1"><COL
WIDTH="17%"
TITLE="c2"><COL
WIDTH="33%"
TITLE="c3"><COL
WIDTH="42%"
TITLE="c4"><TBODY
VALIGN="top"
><TR
><TD
>ER</TD
><TD
>&#13;                <CODE
CLASS="varname"
>ercd</CODE
>
              </TD
><TD
>Error Code</TD
><TD
>エラーコード</TD
></TR
><TR
><TD
>void*</TD
><TD
>&#13;                <CODE
CLASS="varname"
>blk</CODE
>
              </TD
><TD
>Block Start Address</TD
><TD
>メモリブロックの先頭アドレス</TD
></TR
></TBODY
></TABLE
><P
></P
></DIV
></DIV
><DIV
CLASS="section"
><H4
CLASS="section"
><A
NAME="AEN13295"
>エラーコード</A
></H4
><DIV
CLASS="informaltable"
><P
></P
><A
NAME="AEN13297"
></A
><TABLE
BORDER="0"
FRAME="void"
RULES="none"
WIDTH="100%"
CLASS="CALSTABLE"
><COL
WIDTH="17%"
TITLE="c1"><COL
WIDTH="83%"
TITLE="c2"><TBODY
VALIGN="top"
><TR
><TD
>&#13;                <SPAN
CLASS="errorname"
>E_OK</SPAN
>
              </TD
><TD
>正常終了</TD
></TR
><TR
><TD
>&#13;                <SPAN
CLASS="errorname"
>E_ID</SPAN
>
              </TD
><TD
>不正ID番号(<CODE
CLASS="varname"
>mplid</CODE
> が不正あるいは利用できない)</TD
></TR
><TR
><TD
>&#13;                <SPAN
CLASS="errorname"
>E_NOEXS</SPAN
>
              </TD
><TD
>オブジェクトが存在していない(<CODE
CLASS="varname"
>mplid</CODE
> の可変長メモリプールが存在しない)</TD
></TR
><TR
><TD
>&#13;                <SPAN
CLASS="errorname"
>E_PAR</SPAN
>
              </TD
><TD
>パラメータエラー(<CODE
CLASS="varname"
>tmout_u</CODE
>≦(-2))</TD
></TR
><TR
><TD
>&#13;                <SPAN
CLASS="errorname"
>E_DLT</SPAN
>
              </TD
><TD
>待ちオブジェクトが削除された(待ちの間に対象メモリプールが削除)</TD
></TR
><TR
><TD
>&#13;                <SPAN
CLASS="errorname"
>E_RLWAI</SPAN
>
              </TD
><TD
>待ち状態強制解除(待ちの間に <A
HREF="task_dependent_synchronization_functions.html#tk_rel_wai"
>tk_rel_wai</A
> を受け付け)</TD
></TR
><TR
><TD
>&#13;                <SPAN
CLASS="errorname"
>E_DISWAI</SPAN
>
              </TD
><TD
>待ち禁止による待ち解除</TD
></TR
><TR
><TD
>&#13;                <SPAN
CLASS="errorname"
>E_TMOUT</SPAN
>
              </TD
><TD
>ポーリング失敗またはタイムアウト</TD
></TR
><TR
><TD
>&#13;                <SPAN
CLASS="errorname"
>E_CTX</SPAN
>
              </TD
><TD
>コンテキストエラー(タスク独立部またはディスパッチ禁止状態で実行)</TD
></TR
></TBODY
></TABLE
><P
></P
></DIV
></DIV
><DIV
CLASS="section"
><H4
CLASS="section"
><A
NAME="AEN13342"
>利用可能なコンテキスト</A
></H4
><DIV
CLASS="informaltable"
><P
></P
><A
NAME="AEN13344"
></A
><TABLE
BORDER="1"
FRAME="border"
RULES="all"
WIDTH="100%"
CLASS="CALSTABLE"
><COL
WIDTH="33%"><COL
WIDTH="33%"><COL
WIDTH="33%"><THEAD
><TR
><TH
ALIGN="center"
>タスク部</TH
><TH
ALIGN="center"
>準タスク部</TH
><TH
ALIGN="center"
>タスク独立部</TH
></TR
></THEAD
><TBODY
VALIGN="top"
><TR
><TD
ALIGN="center"
>○</TD
><TD
ALIGN="center"
>○</TD
><TD
ALIGN="center"
>×</TD
></TR
></TBODY
></TABLE
><P
></P
></DIV
></DIV
><DIV
CLASS="section"
><H4
CLASS="section"
><A
NAME="AEN13359"
>関連するサービスプロファイル</A
></H4
><P
>以下のサービスプロファイルが有効に設定されている場合に限り、本システムコールはサポートされる。</P
><DIV
CLASS="informaltable"
><P
></P
><A
NAME="AEN13362"
></A
><TABLE
BORDER="0"
FRAME="void"
RULES="none"
WIDTH="100%"
CLASS="CALSTABLE"
><COL
WIDTH="38%"
TITLE="c1"><COL
WIDTH="62%"><TBODY
VALIGN="top"
><TR
><TD
>&#13;                <TT
CLASS="literal"
>TK_SUPPORT_USEC</TT
>
              </TD
><TD
>マイクロ秒のサポート</TD
></TR
></TBODY
></TABLE
><P
></P
></DIV
></DIV
><DIV
CLASS="section"
><H4
CLASS="section"
><A
NAME="AEN13371"
>解説</A
></H4
><P
><A
HREF="memory_pool_management_functions.html#tk_get_mpl"
>tk_get_mpl</A
> のパラメータである <CODE
CLASS="varname"
>tmout</CODE
> を64ビットマイクロ秒単位の <CODE
CLASS="varname"
>tmout_u</CODE
> としたシステムコールである。</P
><P
>パラメータが <CODE
CLASS="varname"
>tmout_u</CODE
> となった点を除き、本システムコールの仕様は <A
HREF="memory_pool_management_functions.html#tk_get_mpl"
>tk_get_mpl</A
> と同じである。詳細は <A
HREF="memory_pool_management_functions.html#tk_get_mpl"
>tk_get_mpl</A
> の説明を参照のこと。</P
></DIV
></DIV
><DIV
CLASS="section"
><H3
CLASS="section"
><A
NAME="tk_rel_mpl"
>tk_rel_mpl - 可変長メモリブロック返却</A
></H3
><DIV
CLASS="section"
><H4
CLASS="section"
><A
NAME="AEN13383"
>C言語インタフェース</A
></H4
><DIV
CLASS="funcsynopsis"
><P
></P
><A
NAME="AEN13385"
></A
><PRE
CLASS="funcsynopsisinfo"
>#include &#60;tk/tkernel.h&#62;</PRE
><P
><CODE
><CODE
CLASS="FUNCDEF"
>ER ercd = tk_rel_mpl</CODE
>(ID mplid, void *blk);</CODE
></P
><P
></P
></DIV
></DIV
><DIV
CLASS="section"
><H4
CLASS="section"
><A
NAME="AEN13394"
>パラメータ</A
></H4
><DIV
CLASS="informaltable"
><P
></P
><A
NAME="AEN13396"
></A
><TABLE
BORDER="0"
FRAME="void"
RULES="none"
WIDTH="100%"
CLASS="CALSTABLE"
><COL
WIDTH="8%"
TITLE="c1"><COL
WIDTH="17%"
TITLE="c2"><COL
WIDTH="33%"
TITLE="c3"><COL
WIDTH="42%"
TITLE="c4"><TBODY
VALIGN="top"
><TR
><TD
>ID</TD
><TD
>&#13;                <CODE
CLASS="varname"
>mplid</CODE
>
              </TD
><TD
>Memory Pool ID</TD
><TD
>可変長メモリプールID</TD
></TR
><TR
><TD
>void*</TD
><TD
>&#13;                <CODE
CLASS="varname"
>blk</CODE
>
              </TD
><TD
>Block Start Address</TD
><TD
>メモリブロックの先頭アドレス</TD
></TR
></TBODY
></TABLE
><P
></P
></DIV
></DIV
><DIV
CLASS="section"
><H4
CLASS="section"
><A
NAME="AEN13415"
>リターンパラメータ</A
></H4
><DIV
CLASS="informaltable"
><P
></P
><A
NAME="AEN13417"
></A
><TABLE
BORDER="0"
FRAME="void"
RULES="none"
WIDTH="100%"
CLASS="CALSTABLE"
><COL
WIDTH="8%"
TITLE="c1"><COL
WIDTH="17%"
TITLE="c2"><COL
WIDTH="33%"
TITLE="c3"><COL
WIDTH="42%"
TITLE="c4"><TBODY
VALIGN="top"
><TR
><TD
>ER</TD
><TD
>&#13;                <CODE
CLASS="varname"
>ercd</CODE
>
              </TD
><TD
>Error Code</TD
><TD
>エラーコード</TD
></TR
></TBODY
></TABLE
><P
></P
></DIV
></DIV
><DIV
CLASS="section"
><H4
CLASS="section"
><A
NAME="AEN13430"
>エラーコード</A
></H4
><DIV
CLASS="informaltable"
><P
></P
><A
NAME="AEN13432"
></A
><TABLE
BORDER="0"
FRAME="void"
RULES="none"
WIDTH="100%"
CLASS="CALSTABLE"
><COL
WIDTH="17%"
TITLE="c1"><COL
WIDTH="83%"
TITLE="c2"><TBODY
VALIGN="top"
><TR
><TD
>&#13;                <SPAN
CLASS="errorname"
>E_OK</SPAN
>
              </TD
><TD
>正常終了</TD
></TR
><TR
><TD
>&#13;                <SPAN
CLASS="errorname"
>E_ID</SPAN
>
              </TD
><TD
>不正ID番号(<CODE
CLASS="varname"
>mplid</CODE
> が不正あるいは利用できない)</TD
></TR
><TR
><TD
>&#13;                <SPAN
CLASS="errorname"
>E_NOEXS</SPAN
>
              </TD
><TD
>オブジェクトが存在していない(<CODE
CLASS="varname"
>mplid</CODE
> の可変長メモリプールが存在しない)</TD
></TR
><TR
><TD
>&#13;                <SPAN
CLASS="errorname"
>E_PAR</SPAN
>
              </TD
><TD
>パラメータエラー(<CODE
CLASS="varname"
>blk</CODE
> が不正, 異なるメモリプールへの返却)</TD
></TR
></TBODY
></TABLE
><P
></P
></DIV
></DIV
><DIV
CLASS="section"
><H4
CLASS="section"
><A
NAME="AEN13456"
>利用可能なコンテキスト</A
></H4
><DIV
CLASS="informaltable"
><P
></P
><A
NAME="AEN13458"
></A
><TABLE
BORDER="1"
FRAME="border"
RULES="all"
WIDTH="100%"
CLASS="CALSTABLE"
><COL
WIDTH="33%"><COL
WIDTH="33%"><COL
WIDTH="33%"><THEAD
><TR
><TH
ALIGN="center"
>タスク部</TH
><TH
ALIGN="center"
>準タスク部</TH
><TH
ALIGN="center"
>タスク独立部</TH
></TR
></THEAD
><TBODY
VALIGN="top"
><TR
><TD
ALIGN="center"
>○</TD
><TD
ALIGN="center"
>○</TD
><TD
ALIGN="center"
>×</TD
></TR
></TBODY
></TABLE
><P
></P
></DIV
></DIV
><DIV
CLASS="section"
><H4
CLASS="section"
><A
NAME="AEN13473"
>関連するサービスプロファイル</A
></H4
><P
>なし</P
></DIV
><DIV
CLASS="section"
><H4
CLASS="section"
><A
NAME="AEN13476"
>解説</A
></H4
><P
><CODE
CLASS="varname"
>blk</CODE
> で示されるメモリブロックを、<CODE
CLASS="varname"
>mplid</CODE
> で示される可変長メモリプールへ返却する。</P
><P
><A
HREF="memory_pool_management_functions.html#tk_rel_mpl"
>tk_rel_mpl</A
> の実行により、<CODE
CLASS="varname"
>mplid</CODE
> のメモリプールでメモリを待っていた別のタスクがメモリを獲得し、そのタスクの待ち状態が解除される場合がある。</P
><P
>メモリブロックの返却を行う可変長メモリプールは、メモリブロックの獲得を行った可変長メモリプールと同じものでなければならない。メモリブロックの返却を行うメモリプールが、メモリブロックの獲得を行ったメモリプールと異なっていることが検出された場合には、<SPAN
CLASS="errorname"
>E_PAR</SPAN
> のエラーとなる。ただし、エラーを検出するか否かは実装依存である。</P
></DIV
><DIV
CLASS="section"
><H4
CLASS="section"
><A
NAME="AEN13486"
>補足事項</A
></H4
><P
>複数のタスクが待っている可変長メモリプールに対してメモリを返却する場合は、要求メモリ数との関係により、複数のタスクが同時に待ち解除となることがある。この場合の待ち解除後のタスクの優先順位は、同じ優先度を持つタスクの間では待ち行列に並んでいたときと同じ順序となる。</P
></DIV
></DIV
><DIV
CLASS="section"
><H3
CLASS="section"
><A
NAME="tk_ref_mpl"
>tk_ref_mpl - 可変長メモリプール状態参照</A
></H3
><DIV
CLASS="section"
><H4
CLASS="section"
><A
NAME="AEN13491"
>C言語インタフェース</A
></H4
><DIV
CLASS="funcsynopsis"
><P
></P
><A
NAME="AEN13493"
></A
><PRE
CLASS="funcsynopsisinfo"
>#include &#60;tk/tkernel.h&#62;</PRE
><P
><CODE
><CODE
CLASS="FUNCDEF"
>ER ercd = tk_ref_mpl</CODE
>(ID mplid, T_RMPL *pk_rmpl);</CODE
></P
><P
></P
></DIV
></DIV
><DIV
CLASS="section"
><H4
CLASS="section"
><A
NAME="AEN13502"
>パラメータ</A
></H4
><DIV
CLASS="informaltable"
><P
></P
><A
NAME="AEN13504"
></A
><TABLE
BORDER="0"
FRAME="void"
RULES="none"
WIDTH="100%"
CLASS="CALSTABLE"
><COL
WIDTH="8%"
TITLE="c1"><COL
WIDTH="17%"
TITLE="c2"><COL
WIDTH="33%"
TITLE="c3"><COL
WIDTH="42%"
TITLE="c4"><TBODY
VALIGN="top"
><TR
><TD
>ID</TD
><TD
>&#13;                <CODE
CLASS="varname"
>mplid</CODE
>
              </TD
><TD
>Memory Pool ID</TD
><TD
>可変長メモリプールID</TD
></TR
><TR
><TD
>T_RMPL*</TD
><TD
>&#13;                <CODE
CLASS="varname"
>pk_rmpl</CODE
>
              </TD
><TD
>Packet to Refer Memory Pool Status</TD
><TD
>メモリプール状態を返す領域へのポインタ</TD
></TR
></TBODY
></TABLE
><P
></P
></DIV
></DIV
><DIV
CLASS="section"
><H4
CLASS="section"
><A
NAME="AEN13523"
>リターンパラメータ</A
></H4
><DIV
CLASS="informaltable"
><P
></P
><A
NAME="AEN13525"
></A
><TABLE
BORDER="0"
FRAME="void"
RULES="none"
WIDTH="100%"
CLASS="CALSTABLE"
><COL
WIDTH="8%"><COL
WIDTH="17%"><COL
WIDTH="33%"><COL
WIDTH="42%"><TBODY
VALIGN="top"
><TR
><TD
>ER</TD
><TD
>&#13;                <CODE
CLASS="varname"
>ercd</CODE
>
              </TD
><TD
>Error Code</TD
><TD
>エラーコード</TD
></TR
></TBODY
></TABLE
><P
></P
></DIV
><P
><CODE
CLASS="varname"
>pk_rmpl</CODE
> の内容</P
><DIV
CLASS="informaltable"
><P
></P
><A
NAME="AEN13540"
></A
><TABLE
BORDER="0"
FRAME="void"
RULES="none"
WIDTH="100%"
CLASS="CALSTABLE"
><COL
WIDTH="8%"
TITLE="c1"><COL
WIDTH="17%"
TITLE="c2"><COL
WIDTH="33%"
TITLE="c3"><COL
WIDTH="42%"
TITLE="c4"><TBODY
VALIGN="top"
><TR
><TD
>void*</TD
><TD
>&#13;                <CODE
CLASS="varname"
>exinf</CODE
>
              </TD
><TD
>Extended Information</TD
><TD
>拡張情報</TD
></TR
><TR
><TD
>ID</TD
><TD
>&#13;                <CODE
CLASS="varname"
>wtsk</CODE
>
              </TD
><TD
>Waiting Task ID</TD
><TD
>待ちタスクのID</TD
></TR
><TR
><TD
>SZ</TD
><TD
>&#13;                <CODE
CLASS="varname"
>frsz</CODE
>
              </TD
><TD
>Free Memory Size</TD
><TD
>空き領域の合計サイズ(バイト数)</TD
></TR
><TR
><TD
>SZ</TD
><TD
>&#13;                <CODE
CLASS="varname"
>maxsz</CODE
>
              </TD
><TD
>Max Memory Size</TD
><TD
>最大の空き領域のサイズ(バイト数)</TD
></TR
><TR
><TD
COLSPAN="4"
>──(以下に実装独自に他の情報を追加してもよい)──</TD
></TR
></TBODY
></TABLE
><P
></P
></DIV
></DIV
><DIV
CLASS="section"
><H4
CLASS="section"
><A
NAME="AEN13573"
>エラーコード</A
></H4
><DIV
CLASS="informaltable"
><P
></P
><A
NAME="AEN13575"
></A
><TABLE
BORDER="0"
FRAME="void"
RULES="none"
WIDTH="100%"
CLASS="CALSTABLE"
><COL
WIDTH="17%"
TITLE="c1"><COL
WIDTH="83%"
TITLE="c2"><TBODY
VALIGN="top"
><TR
><TD
>&#13;                <SPAN
CLASS="errorname"
>E_OK</SPAN
>
              </TD
><TD
>正常終了</TD
></TR
><TR
><TD
>&#13;                <SPAN
CLASS="errorname"
>E_ID</SPAN
>
              </TD
><TD
>不正ID番号(<CODE
CLASS="varname"
>mplid</CODE
> が不正あるいは利用できない)</TD
></TR
><TR
><TD
>&#13;                <SPAN
CLASS="errorname"
>E_NOEXS</SPAN
>
              </TD
><TD
>オブジェクトが存在していない(<CODE
CLASS="varname"
>mplid</CODE
> の可変長メモリプールが存在しない)</TD
></TR
><TR
><TD
>&#13;                <SPAN
CLASS="errorname"
>E_PAR</SPAN
>
              </TD
><TD
>パラメータエラー(<CODE
CLASS="varname"
>pk_rmpl</CODE
> が不正)</TD
></TR
></TBODY
></TABLE
><P
></P
></DIV
></DIV
><DIV
CLASS="section"
><H4
CLASS="section"
><A
NAME="AEN13599"
>利用可能なコンテキスト</A
></H4
><DIV
CLASS="informaltable"
><P
></P
><A
NAME="AEN13601"
></A
><TABLE
BORDER="1"
FRAME="border"
RULES="all"
WIDTH="100%"
CLASS="CALSTABLE"
><COL
WIDTH="33%"><COL
WIDTH="33%"><COL
WIDTH="33%"><THEAD
><TR
><TH
ALIGN="center"
>タスク部</TH
><TH
ALIGN="center"
>準タスク部</TH
><TH
ALIGN="center"
>タスク独立部</TH
></TR
></THEAD
><TBODY
VALIGN="top"
><TR
><TD
ALIGN="center"
>○</TD
><TD
ALIGN="center"
>○</TD
><TD
ALIGN="center"
>×</TD
></TR
></TBODY
></TABLE
><P
></P
></DIV
></DIV
><DIV
CLASS="section"
><H4
CLASS="section"
><A
NAME="AEN13616"
>関連するサービスプロファイル</A
></H4
><P
>なし</P
></DIV
><DIV
CLASS="section"
><H4
CLASS="section"
><A
NAME="AEN13619"
>解説</A
></H4
><P
><CODE
CLASS="varname"
>mplid</CODE
> で示された対象可変長メモリプールの各種の状態を参照し、リターンパラメータとして現在の空き領域の合計サイズ(<CODE
CLASS="varname"
>frsz</CODE
>)、すぐに獲得可能な最大の空き領域のサイズ(<CODE
CLASS="varname"
>maxsz</CODE
>)、待ちタスクのID(<CODE
CLASS="varname"
>wtsk</CODE
>)、拡張情報(<CODE
CLASS="varname"
>exinf</CODE
>) を返す。</P
><P
><CODE
CLASS="varname"
>wtsk</CODE
> は、この可変長メモリプールで待っているタスクのIDを示す。この可変長メモリプールで複数のタスクが待っている場合には、待ち行列の先頭のタスクのIDを返す。待ちタスクが無い場合は <CODE
CLASS="varname"
>wtsk</CODE
>＝0となる。</P
><P
><A
HREF="memory_pool_management_functions.html#tk_ref_mpl"
>tk_ref_mpl</A
> で、対象可変長メモリプールが存在しない場合には、エラー <SPAN
CLASS="errorname"
>E_NOEXS</SPAN
> となる。</P
></DIV
></DIV
></DIV
></DIV
><DIV
CLASS="NAVFOOTER"
><HR
ALIGN="LEFT"
WIDTH="100%"><TABLE
SUMMARY="Footer navigation table"
WIDTH="100%"
BORDER="0"
CELLPADDING="0"
CELLSPACING="0"
><TR
><TD
WIDTH="33%"
ALIGN="left"
VALIGN="top"
><A
HREF="extended_synchronization_and_communication_functions.html"
ACCESSKEY="P"
>前のページ</A
></TD
><TD
WIDTH="34%"
ALIGN="center"
VALIGN="top"
><A
HREF="index.html"
ACCESSKEY="H"
>ホーム</A
></TD
><TD
WIDTH="33%"
ALIGN="right"
VALIGN="top"
><A
HREF="time_management_functions.html"
ACCESSKEY="N"
>次のページ</A
></TD
></TR
><TR
><TD
WIDTH="33%"
ALIGN="left"
VALIGN="top"
>拡張同期・通信機能</TD
><TD
WIDTH="34%"
ALIGN="center"
VALIGN="top"
><A
HREF="utk_os_functions.html"
ACCESSKEY="U"
>上に戻る</A
></TD
><TD
WIDTH="33%"
ALIGN="right"
VALIGN="top"
>時間管理機能</TD
></TR
></TABLE
></DIV
></BODY
></HTML
>