<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN""http://www.w3.org/TR/html4/loose.dtd">
<HTML
><HEAD
><TITLE
>μT-Kernel/SMの機能</TITLE
><META
NAME="GENERATOR"
CONTENT="Modular DocBook HTML Stylesheet Version 1.79"><LINK
REL="HOME"
TITLE="μT-Kernel 3.0仕様書"
HREF="index.html"><LINK
REL="PREVIOUS"
TITLE="サブシステム管理機能"
HREF="subsystem_management_functions.html"><LINK
REL="NEXT"
TITLE="デバイス管理機能"
HREF="device_management_functions.html"></HEAD
><BODY
CLASS="chapter"
BGCOLOR="#FFFFFF"
TEXT="#000000"
LINK="#0000FF"
VLINK="#840084"
ALINK="#0000FF"
><DIV
CLASS="NAVHEADER"
><TABLE
SUMMARY="Header navigation table"
WIDTH="100%"
BORDER="0"
CELLPADDING="0"
CELLSPACING="0"
><TR
><TH
COLSPAN="3"
ALIGN="center"
>μT-Kernel 3.0仕様書</TH
></TR
><TR
><TD
WIDTH="10%"
ALIGN="left"
VALIGN="bottom"
><A
HREF="subsystem_management_functions.html"
ACCESSKEY="P"
>前のページ</A
></TD
><TD
WIDTH="80%"
ALIGN="center"
VALIGN="bottom"
></TD
><TD
WIDTH="10%"
ALIGN="right"
VALIGN="bottom"
><A
HREF="device_management_functions.html"
ACCESSKEY="N"
>次のページ</A
></TD
></TR
></TABLE
><HR
ALIGN="LEFT"
WIDTH="100%"></DIV
><DIV
CLASS="chapter"
><H1
><A
NAME="utk_sm_functions"
></A
>μT-Kernel/SMの機能</H1
><P
>この章では、μT-Kernel/SM(System Manager)で提供している機能の詳細について説明を行う。</P
><DIV
CLASS="note"
><P
></P
><TABLE
CLASS="note"
WIDTH="100%"
BORDER="0"
><TR
><TD
WIDTH="25"
ALIGN="CENTER"
VALIGN="TOP"
><IMG
SRC="../images/note.gif"
HSPACE="5"
ALT="注意"></TD
><TH
ALIGN="LEFT"
VALIGN="MIDDLE"
><B
>全般的な注意・補足事項</B
></TH
></TR
><TR
><TD
>&nbsp;</TD
><TD
ALIGN="LEFT"
VALIGN="TOP"
><P
></P
><UL
><LI
><P
>μT-Kernel/SMの仕様で定義されているAPIには、tk_～の名称を持つものと、それ以外の名称を持つものがある。tk_～の名称を持つAPIは、サブシステム管理機能の拡張SVCを使って実装することを想定したAPIであり、それ以外の名称を持つAPIは、ライブラリ関数(インライン関数を含む)またはC言語のマクロで実装することを想定したAPIである。ただし、μT-Kernelの仕様でこれらのAPIの実装方法を規定しているわけではなく、別の実装方法を使っても構わない。また、ライブラリまたはマクロであっても、間接的に拡張SVCやシステムコールを呼び出す場合がある。</P
></LI
><LI
><P
>常に発生する可能性のあるエラー <SPAN
CLASS="errorname"
>E_PAR</SPAN
>, <SPAN
CLASS="errorname"
>E_MACV</SPAN
>, <SPAN
CLASS="errorname"
>E_NOMEM</SPAN
> などは、特に説明を必要とする場合以外は省略している。</P
></LI
><LI
><P
>μT-Kernel/SM APIは、特に明記されているものを除き、タスク独立部およびディスパッチ禁止中・割込み禁止中状態から呼び出すことはできない(<SPAN
CLASS="errorname"
>E_CTX</SPAN
>)。</P
></LI
><LI
><P
>μT-Kernel/SM APIは、特に明記されているものを除き、μT-Kernel/OSのシステムコールの呼出可能な保護レベルより低い保護レベル(<TT
CLASS="literal"
>TSVCLimit</TT
> より低い保護レベル)から呼び出すことはできない(<SPAN
CLASS="errorname"
>E_OACV</SPAN
>)。</P
></LI
><LI
><P
>μT-Kernel/SM APIは、特に明記されているものを除き、再入可能(reentrant)である。ただし、内部で排他制御を行っている場合がある。</P
></LI
></UL
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="section"
><H1
CLASS="section"
><A
NAME="system_memory_management_functions"
>システムメモリ管理機能</A
></H1
><P
>システムメモリ管理機能は、μT-Kernelが動的に割り当てるすべてのメモリ(システムメモリ)を管理するための機能である。μT-Kernel内部で使用しているメモリやタスクのスタック、メッセージバッファ、メモリプールなどもここから割り当てる。</P
><P
>システムメモリ管理機能は、システムメモリを細分化して管理するメモリ割当てライブラリからなる。</P
><P
>システムメモリ管理機能は、μT-Kernelの内部で利用するほか、アプリケーションやサブシステム、デバイスドライバなどからも利用可能である。</P
><DIV
CLASS="section"
><H2
CLASS="section"
><A
NAME="memory_allocation_libraries"
>メモリ割当てライブラリ</A
></H2
><P
>メモリ割当てライブラリは、C言語標準ライブラリの <CODE
CLASS="function"
>malloc</CODE
>／<CODE
CLASS="function"
>calloc</CODE
>／<CODE
CLASS="function"
>realloc</CODE
>／<CODE
CLASS="function"
>free</CODE
> と同等の機能が提供される。</P
><P
>これらのメモリは、すべて <CODE
CLASS="function"
>TSVCLimit</CODE
> で指定された保護レベルのメモリとして割り当てられる。</P
><DIV
CLASS="section"
><H3
CLASS="section"
><A
NAME="Kmalloc"
>Kmalloc - メモリの割当て</A
></H3
><DIV
CLASS="section"
><H4
CLASS="section"
><A
NAME="AEN18537"
>C言語インタフェース</A
></H4
><DIV
CLASS="funcsynopsis"
><P
></P
><A
NAME="AEN18539"
></A
><PRE
CLASS="funcsynopsisinfo"
>#include &#60;tk/tkernel.h&#62;</PRE
><P
><CODE
><CODE
CLASS="FUNCDEF"
>void* Kmalloc</CODE
>(size_t size);</CODE
></P
><P
></P
></DIV
></DIV
><DIV
CLASS="section"
><H4
CLASS="section"
><A
NAME="AEN18546"
>パラメータ</A
></H4
><DIV
CLASS="informaltable"
><P
></P
><A
NAME="AEN18548"
></A
><TABLE
BORDER="0"
FRAME="void"
RULES="none"
WIDTH="100%"
CLASS="CALSTABLE"
><COL
WIDTH="8%"><COL
WIDTH="17%"><COL
WIDTH="33%"><COL
WIDTH="42%"><TBODY
VALIGN="top"
><TR
><TD
>size_t</TD
><TD
>&#13;                <CODE
CLASS="varname"
>size</CODE
>
              </TD
><TD
>Size</TD
><TD
>割り当てるメモリサイズ(バイト数)</TD
></TR
></TBODY
></TABLE
><P
></P
></DIV
></DIV
><DIV
CLASS="section"
><H4
CLASS="section"
><A
NAME="AEN18561"
>リターンパラメータ</A
></H4
><DIV
CLASS="informaltable"
><P
></P
><A
NAME="AEN18563"
></A
><TABLE
BORDER="0"
FRAME="void"
RULES="none"
WIDTH="100%"
CLASS="CALSTABLE"
><COL
WIDTH="8%"><COL
WIDTH="17%"><COL
WIDTH="33%"><COL
WIDTH="42%"><TBODY
VALIGN="top"
><TR
><TD
>void*</TD
><TD
>&#13;                <CODE
CLASS="varname"
>addr</CODE
>
              </TD
><TD
>Memory Start Address</TD
><TD
>割り当てたメモリの先頭アドレス</TD
></TR
></TBODY
></TABLE
><P
></P
></DIV
></DIV
><DIV
CLASS="section"
><H4
CLASS="section"
><A
NAME="AEN18576"
>エラーコード</A
></H4
><P
>なし</P
></DIV
><DIV
CLASS="section"
><H4
CLASS="section"
><A
NAME="AEN18579"
>利用可能なコンテキスト</A
></H4
><DIV
CLASS="informaltable"
><P
></P
><A
NAME="AEN18581"
></A
><TABLE
BORDER="1"
FRAME="border"
RULES="all"
WIDTH="100%"
CLASS="CALSTABLE"
><COL
WIDTH="33%"><COL
WIDTH="33%"><COL
WIDTH="33%"><THEAD
><TR
><TH
ALIGN="center"
>タスク部</TH
><TH
ALIGN="center"
>準タスク部</TH
><TH
ALIGN="center"
>タスク独立部</TH
></TR
></THEAD
><TBODY
VALIGN="top"
><TR
><TD
ALIGN="center"
>○</TD
><TD
ALIGN="center"
>○</TD
><TD
ALIGN="center"
>×</TD
></TR
></TBODY
></TABLE
><P
></P
></DIV
></DIV
><DIV
CLASS="section"
><H4
CLASS="section"
><A
NAME="AEN18596"
>関連するサービスプロファイル</A
></H4
><P
>以下のサービスプロファイルが有効に設定されている場合に限り、本APIはサポートされる。</P
><DIV
CLASS="informaltable"
><P
></P
><A
NAME="AEN18599"
></A
><TABLE
BORDER="0"
FRAME="void"
RULES="none"
WIDTH="100%"
CLASS="CALSTABLE"
><COL
WIDTH="38%"
TITLE="c1"><COL
WIDTH="62%"><TBODY
VALIGN="top"
><TR
><TD
>&#13;                <TT
CLASS="literal"
>TK_SUPPORT_MEMLIB</TT
>
              </TD
><TD
>メモリ割当てライブラリのサポート</TD
></TR
></TBODY
></TABLE
><P
></P
></DIV
></DIV
><DIV
CLASS="section"
><H4
CLASS="section"
><A
NAME="AEN18608"
>解説</A
></H4
><P
><CODE
CLASS="varname"
>size</CODE
> で指定したバイト数のメモリを割り当て、その先頭アドレスを <CODE
CLASS="varname"
>addr</CODE
> に返す。</P
><P
>指定したサイズのメモリの割当てができなかった場合や、<CODE
CLASS="varname"
>size</CODE
> に0が指定された場合は、<CODE
CLASS="varname"
>addr</CODE
> に <TT
CLASS="literal"
>NULL</TT
> が返る。</P
><P
><A
HREF="utk_sm_functions.html#Kmalloc"
>Kmalloc</A
> を含むメモリ割当てライブラリのAPIは、タスク独立部およびディスパッチ禁止中、割込み禁止中に呼び出すことはできない。呼び出した場合の動作は、システムダウンの可能性も含めて不定であり、呼出時の状態を保証するのは、呼出側の責任である。</P
></DIV
><DIV
CLASS="section"
><H4
CLASS="section"
><A
NAME="AEN18619"
>補足事項</A
></H4
><P
><CODE
CLASS="varname"
>size</CODE
> には任意の値を指定できるが、管理領域の確保や、割り当てるメモリアドレスのアラインメントの調整といった理由により、内部的には、<CODE
CLASS="varname"
>size</CODE
> で指定したバイト数よりも大きなメモリが割り当てられる場合がある。たとえば、割当て可能なメモリサイズの最低が16バイトで、アラインメントが8バイト単位という実装の場合には、<CODE
CLASS="varname"
>size</CODE
> に16バイト未満の値を指定した場合でも、内部的には16バイトのメモリが割り当てられる。また、<CODE
CLASS="varname"
>size</CODE
> に20バイトの値を指定した場合でも、内部的には24バイトのメモリが割り当てられる。</P
></DIV
></DIV
><DIV
CLASS="section"
><H3
CLASS="section"
><A
NAME="Kcalloc"
>Kcalloc - メモリの割当てとクリア</A
></H3
><DIV
CLASS="section"
><H4
CLASS="section"
><A
NAME="AEN18628"
>C言語インタフェース</A
></H4
><DIV
CLASS="funcsynopsis"
><P
></P
><A
NAME="AEN18630"
></A
><PRE
CLASS="funcsynopsisinfo"
>#include &#60;tk/tkernel.h&#62;</PRE
><P
><CODE
><CODE
CLASS="FUNCDEF"
>void* Kcalloc</CODE
>(size_t nmemb, size_t size);</CODE
></P
><P
></P
></DIV
></DIV
><DIV
CLASS="section"
><H4
CLASS="section"
><A
NAME="AEN18639"
>パラメータ</A
></H4
><DIV
CLASS="informaltable"
><P
></P
><A
NAME="AEN18641"
></A
><TABLE
BORDER="0"
FRAME="void"
RULES="none"
WIDTH="100%"
CLASS="CALSTABLE"
><COL
WIDTH="8%"><COL
WIDTH="17%"><COL
WIDTH="33%"><COL
WIDTH="42%"><TBODY
VALIGN="top"
><TR
><TD
>size_t</TD
><TD
>&#13;                <CODE
CLASS="varname"
>nmemb</CODE
>
              </TD
><TD
>Number of Memory Blocks</TD
><TD
>割り当てるメモリブロックの個数</TD
></TR
><TR
><TD
>size_t</TD
><TD
>&#13;                <CODE
CLASS="varname"
>size</CODE
>
              </TD
><TD
>Size</TD
><TD
>割り当てるメモリブロックのサイズ(バイト数)</TD
></TR
></TBODY
></TABLE
><P
></P
></DIV
></DIV
><DIV
CLASS="section"
><H4
CLASS="section"
><A
NAME="AEN18660"
>リターンパラメータ</A
></H4
><DIV
CLASS="informaltable"
><P
></P
><A
NAME="AEN18662"
></A
><TABLE
BORDER="0"
FRAME="void"
RULES="none"
WIDTH="100%"
CLASS="CALSTABLE"
><COL
WIDTH="8%"><COL
WIDTH="17%"><COL
WIDTH="33%"><COL
WIDTH="42%"><TBODY
VALIGN="top"
><TR
><TD
>void*</TD
><TD
>&#13;                <CODE
CLASS="varname"
>addr</CODE
>
              </TD
><TD
>Memory Start Address</TD
><TD
>割り当てたメモリの先頭アドレス</TD
></TR
></TBODY
></TABLE
><P
></P
></DIV
></DIV
><DIV
CLASS="section"
><H4
CLASS="section"
><A
NAME="AEN18675"
>エラーコード</A
></H4
><P
>なし</P
></DIV
><DIV
CLASS="section"
><H4
CLASS="section"
><A
NAME="AEN18678"
>利用可能なコンテキスト</A
></H4
><DIV
CLASS="informaltable"
><P
></P
><A
NAME="AEN18680"
></A
><TABLE
BORDER="1"
FRAME="border"
RULES="all"
WIDTH="100%"
CLASS="CALSTABLE"
><COL
WIDTH="33%"><COL
WIDTH="33%"><COL
WIDTH="33%"><THEAD
><TR
><TH
ALIGN="center"
>タスク部</TH
><TH
ALIGN="center"
>準タスク部</TH
><TH
ALIGN="center"
>タスク独立部</TH
></TR
></THEAD
><TBODY
VALIGN="top"
><TR
><TD
ALIGN="center"
>○</TD
><TD
ALIGN="center"
>○</TD
><TD
ALIGN="center"
>×</TD
></TR
></TBODY
></TABLE
><P
></P
></DIV
></DIV
><DIV
CLASS="section"
><H4
CLASS="section"
><A
NAME="AEN18695"
>関連するサービスプロファイル</A
></H4
><P
>以下のサービスプロファイルが有効に設定されている場合に限り、本APIはサポートされる。</P
><DIV
CLASS="informaltable"
><P
></P
><A
NAME="AEN18698"
></A
><TABLE
BORDER="0"
FRAME="void"
RULES="none"
WIDTH="100%"
CLASS="CALSTABLE"
><COL
WIDTH="38%"
TITLE="c1"><COL
WIDTH="62%"><TBODY
VALIGN="top"
><TR
><TD
>&#13;                <TT
CLASS="literal"
>TK_SUPPORT_MEMLIB</TT
>
              </TD
><TD
>メモリ割当てライブラリのサポート</TD
></TR
></TBODY
></TABLE
><P
></P
></DIV
></DIV
><DIV
CLASS="section"
><H4
CLASS="section"
><A
NAME="AEN18707"
>解説</A
></H4
><P
><CODE
CLASS="varname"
>size</CODE
> で指定したバイト数のメモリブロックを、<CODE
CLASS="varname"
>nmemb</CODE
> で指定された個数だけ連続して割り当て、0クリアしてから、その先頭アドレスを <CODE
CLASS="varname"
>addr</CODE
> に返す。メモリ割当ての動作は、<CODE
CLASS="varname"
>size</CODE
> と <CODE
CLASS="varname"
>nmemb</CODE
> を乗じたバイト数のメモリブロック1個を割り当てるのと同じである。</P
><P
>指定した個数のメモリブロックの割当てができなかった場合や、<CODE
CLASS="varname"
>nmemb</CODE
> または <CODE
CLASS="varname"
>size</CODE
> に0が指定された場合は、<CODE
CLASS="varname"
>addr</CODE
> に <TT
CLASS="literal"
>NULL</TT
> が返る。</P
><P
><A
HREF="utk_sm_functions.html#Kcalloc"
>Kcalloc</A
> を含むメモリ割当てライブラリのAPIは、タスク独立部およびディスパッチ禁止中、割込み禁止中に呼び出すことはできない。呼び出した場合の動作は、システムダウンの可能性も含めて不定であり、呼出時の状態を保証するのは、呼出側の責任である。</P
></DIV
><DIV
CLASS="section"
><H4
CLASS="section"
><A
NAME="AEN18722"
>補足事項</A
></H4
><P
>内部的には、<CODE
CLASS="varname"
>size</CODE
> と <CODE
CLASS="varname"
>nmemb</CODE
> を乗じたバイト数よりも大きなメモリが割り当てられる場合がある。詳細は <A
HREF="utk_sm_functions.html#Kmalloc"
>Kmalloc</A
> の補足事項を参照のこと。</P
></DIV
></DIV
><DIV
CLASS="section"
><H3
CLASS="section"
><A
NAME="Krealloc"
>Krealloc - メモリの再割当て</A
></H3
><DIV
CLASS="section"
><H4
CLASS="section"
><A
NAME="AEN18730"
>C言語インタフェース</A
></H4
><DIV
CLASS="funcsynopsis"
><P
></P
><A
NAME="AEN18732"
></A
><PRE
CLASS="funcsynopsisinfo"
>#include &#60;tk/tkernel.h&#62;</PRE
><P
><CODE
><CODE
CLASS="FUNCDEF"
>void* Krealloc</CODE
>(void *ptr, size_t size);</CODE
></P
><P
></P
></DIV
></DIV
><DIV
CLASS="section"
><H4
CLASS="section"
><A
NAME="AEN18741"
>パラメータ</A
></H4
><DIV
CLASS="informaltable"
><P
></P
><A
NAME="AEN18743"
></A
><TABLE
BORDER="0"
FRAME="void"
RULES="none"
WIDTH="100%"
CLASS="CALSTABLE"
><COL
WIDTH="8%"><COL
WIDTH="17%"><COL
WIDTH="33%"><COL
WIDTH="42%"><TBODY
VALIGN="top"
><TR
><TD
>void*</TD
><TD
>&#13;                <CODE
CLASS="varname"
>ptr</CODE
>
              </TD
><TD
>Pointer to Memory</TD
><TD
>再割当て対象のメモリアドレス</TD
></TR
><TR
><TD
>size_t</TD
><TD
>&#13;                <CODE
CLASS="varname"
>size</CODE
>
              </TD
><TD
>Size</TD
><TD
>再割当て後のメモリサイズ(バイト数)</TD
></TR
></TBODY
></TABLE
><P
></P
></DIV
></DIV
><DIV
CLASS="section"
><H4
CLASS="section"
><A
NAME="AEN18762"
>リターンパラメータ</A
></H4
><DIV
CLASS="informaltable"
><P
></P
><A
NAME="AEN18764"
></A
><TABLE
BORDER="0"
FRAME="void"
RULES="none"
WIDTH="100%"
CLASS="CALSTABLE"
><COL
WIDTH="8%"><COL
WIDTH="17%"><COL
WIDTH="33%"><COL
WIDTH="42%"><TBODY
VALIGN="top"
><TR
><TD
>void*</TD
><TD
>&#13;                <CODE
CLASS="varname"
>addr</CODE
>
              </TD
><TD
>Memory Start Address</TD
><TD
>再割当てされたメモリの先頭アドレス</TD
></TR
></TBODY
></TABLE
><P
></P
></DIV
></DIV
><DIV
CLASS="section"
><H4
CLASS="section"
><A
NAME="AEN18777"
>エラーコード</A
></H4
><P
>なし</P
></DIV
><DIV
CLASS="section"
><H4
CLASS="section"
><A
NAME="AEN18780"
>利用可能なコンテキスト</A
></H4
><DIV
CLASS="informaltable"
><P
></P
><A
NAME="AEN18782"
></A
><TABLE
BORDER="1"
FRAME="border"
RULES="all"
WIDTH="100%"
CLASS="CALSTABLE"
><COL
WIDTH="33%"><COL
WIDTH="33%"><COL
WIDTH="33%"><THEAD
><TR
><TH
ALIGN="center"
>タスク部</TH
><TH
ALIGN="center"
>準タスク部</TH
><TH
ALIGN="center"
>タスク独立部</TH
></TR
></THEAD
><TBODY
VALIGN="top"
><TR
><TD
ALIGN="center"
>○</TD
><TD
ALIGN="center"
>○</TD
><TD
ALIGN="center"
>×</TD
></TR
></TBODY
></TABLE
><P
></P
></DIV
></DIV
><DIV
CLASS="section"
><H4
CLASS="section"
><A
NAME="AEN18797"
>関連するサービスプロファイル</A
></H4
><P
>以下のサービスプロファイルが有効に設定されている場合に限り、本APIはサポートされる。</P
><DIV
CLASS="informaltable"
><P
></P
><A
NAME="AEN18800"
></A
><TABLE
BORDER="0"
FRAME="void"
RULES="none"
WIDTH="100%"
CLASS="CALSTABLE"
><COL
WIDTH="38%"
TITLE="c1"><COL
WIDTH="62%"><TBODY
VALIGN="top"
><TR
><TD
>&#13;                <TT
CLASS="literal"
>TK_SUPPORT_MEMLIB</TT
>
              </TD
><TD
>メモリ割当てライブラリのサポート</TD
></TR
></TBODY
></TABLE
><P
></P
></DIV
></DIV
><DIV
CLASS="section"
><H4
CLASS="section"
><A
NAME="AEN18809"
>解説</A
></H4
><P
><CODE
CLASS="varname"
>ptr</CODE
> で指定した割当て済のメモリのサイズを、<CODE
CLASS="varname"
>size</CODE
> で指定されたサイズに変更する。その際にメモリの再割当てを行い、再割当て後のメモリの先頭アドレスを <CODE
CLASS="varname"
>addr</CODE
> に返す。</P
><P
>サイズ変更をともなうメモリの再割当てにより、一般にはメモリの先頭アドレスが移動し、<CODE
CLASS="varname"
>addr</CODE
> は <CODE
CLASS="varname"
>ptr</CODE
> と異なった値になる。ただし、その場合でも、再割当ての対象となったメモリの内容は保存される。このため、<A
HREF="utk_sm_functions.html#Krealloc"
>Krealloc</A
> の処理の中でメモリ内容のコピーを行う。また、再割当てにより不要になったメモリは解放される。</P
><P
><CODE
CLASS="varname"
>ptr</CODE
> には、<A
HREF="utk_sm_functions.html#Kmalloc"
>Kmalloc</A
>、<A
HREF="utk_sm_functions.html#Kcalloc"
>Kcalloc</A
>、<A
HREF="utk_sm_functions.html#Krealloc"
>Krealloc</A
> で割り当てられたメモリの先頭アドレスを指定する必要がある。<CODE
CLASS="varname"
>ptr</CODE
> の正当性は呼出側で保証しなければならない。</P
><P
><CODE
CLASS="varname"
>ptr</CODE
> に <TT
CLASS="literal"
>NULL</TT
> を指定した場合は、新しいメモリの割当てのみを行う。この場合の動作は <A
HREF="utk_sm_functions.html#Kmalloc"
>Kmalloc</A
> と同一である。</P
><P
>指定したサイズのメモリの再割当てができなかった場合や、<CODE
CLASS="varname"
>size</CODE
> に0が指定された場合は、<CODE
CLASS="varname"
>addr</CODE
> に <TT
CLASS="literal"
>NULL</TT
> が返る。このとき、<CODE
CLASS="varname"
>ptr</CODE
> に <TT
CLASS="literal"
>NULL</TT
> 以外が指定されていれば、<CODE
CLASS="varname"
>ptr</CODE
> のメモリの解放だけを行う。この場合の動作は <A
HREF="utk_sm_functions.html#Kfree"
>Kfree</A
> と同一である。</P
><P
><A
HREF="utk_sm_functions.html#Krealloc"
>Krealloc</A
> を含むメモリ割当てライブラリのAPIは、タスク独立部およびディスパッチ禁止中、割込み禁止中に呼び出すことはできない。呼び出した場合の動作は、システムダウンの可能性も含めて不定であり、呼出時の状態を保証するのは、呼出側の責任である。</P
></DIV
><DIV
CLASS="section"
><H4
CLASS="section"
><A
NAME="AEN18839"
>補足事項</A
></H4
><P
>再割当てによりメモリサイズが小さくなる場合や、<CODE
CLASS="varname"
>ptr</CODE
> で指定されるメモリの周辺に未割当てのメモリが残っている場合など、状況によっては、<CODE
CLASS="varname"
>addr</CODE
> に返るメモリアドレスが <CODE
CLASS="varname"
>ptr</CODE
> と同一となることがある。</P
><P
>内部的には、<CODE
CLASS="varname"
>size</CODE
>で指定したバイト数よりも大きなメモリが割り当てられる場合がある。詳細は <A
HREF="utk_sm_functions.html#Kmalloc"
>Kmalloc</A
> の補足事項を参照のこと。</P
></DIV
></DIV
><DIV
CLASS="section"
><H3
CLASS="section"
><A
NAME="Kfree"
>Kfree - メモリの解放</A
></H3
><DIV
CLASS="section"
><H4
CLASS="section"
><A
NAME="AEN18850"
>C言語インタフェース</A
></H4
><DIV
CLASS="funcsynopsis"
><P
></P
><A
NAME="AEN18852"
></A
><PRE
CLASS="funcsynopsisinfo"
>#include &#60;tk/tkernel.h&#62;</PRE
><P
><CODE
><CODE
CLASS="FUNCDEF"
>void Kfree</CODE
>(void *ptr);</CODE
></P
><P
></P
></DIV
></DIV
><DIV
CLASS="section"
><H4
CLASS="section"
><A
NAME="AEN18859"
>パラメータ</A
></H4
><DIV
CLASS="informaltable"
><P
></P
><A
NAME="AEN18861"
></A
><TABLE
BORDER="0"
FRAME="void"
RULES="none"
WIDTH="100%"
CLASS="CALSTABLE"
><COL
WIDTH="8%"><COL
WIDTH="17%"><COL
WIDTH="33%"><COL
WIDTH="42%"><TBODY
VALIGN="top"
><TR
><TD
>void*</TD
><TD
>&#13;                <CODE
CLASS="varname"
>ptr</CODE
>
              </TD
><TD
>Pointer to Memory</TD
><TD
>解放するメモリの先頭アドレス</TD
></TR
></TBODY
></TABLE
><P
></P
></DIV
></DIV
><DIV
CLASS="section"
><H4
CLASS="section"
><A
NAME="AEN18874"
>リターンパラメータ</A
></H4
><P
>なし</P
></DIV
><DIV
CLASS="section"
><H4
CLASS="section"
><A
NAME="AEN18877"
>エラーコード</A
></H4
><P
>なし</P
></DIV
><DIV
CLASS="section"
><H4
CLASS="section"
><A
NAME="AEN18880"
>利用可能なコンテキスト</A
></H4
><DIV
CLASS="informaltable"
><P
></P
><A
NAME="AEN18882"
></A
><TABLE
BORDER="1"
FRAME="border"
RULES="all"
WIDTH="100%"
CLASS="CALSTABLE"
><COL
WIDTH="33%"><COL
WIDTH="33%"><COL
WIDTH="33%"><THEAD
><TR
><TH
ALIGN="center"
>タスク部</TH
><TH
ALIGN="center"
>準タスク部</TH
><TH
ALIGN="center"
>タスク独立部</TH
></TR
></THEAD
><TBODY
VALIGN="top"
><TR
><TD
ALIGN="center"
>○</TD
><TD
ALIGN="center"
>○</TD
><TD
ALIGN="center"
>×</TD
></TR
></TBODY
></TABLE
><P
></P
></DIV
></DIV
><DIV
CLASS="section"
><H4
CLASS="section"
><A
NAME="AEN18897"
>関連するサービスプロファイル</A
></H4
><P
>以下のサービスプロファイルが有効に設定されている場合に限り、本APIはサポートされる。</P
><DIV
CLASS="informaltable"
><P
></P
><A
NAME="AEN18900"
></A
><TABLE
BORDER="0"
FRAME="void"
RULES="none"
WIDTH="100%"
CLASS="CALSTABLE"
><COL
WIDTH="38%"
TITLE="c1"><COL
WIDTH="62%"><TBODY
VALIGN="top"
><TR
><TD
>&#13;                <TT
CLASS="literal"
>TK_SUPPORT_MEMLIB</TT
>
              </TD
><TD
>メモリ割当てライブラリのサポート</TD
></TR
></TBODY
></TABLE
><P
></P
></DIV
></DIV
><DIV
CLASS="section"
><H4
CLASS="section"
><A
NAME="AEN18909"
>解説</A
></H4
><P
><CODE
CLASS="varname"
>ptr</CODE
> で指定したメモリを解放する。</P
><P
><CODE
CLASS="varname"
>ptr</CODE
> には、<A
HREF="utk_sm_functions.html#Kmalloc"
>Kmalloc</A
>、<A
HREF="utk_sm_functions.html#Kcalloc"
>Kcalloc</A
>、<A
HREF="utk_sm_functions.html#Krealloc"
>Krealloc</A
> で割り当てられたメモリの先頭アドレスを指定する必要がある。<CODE
CLASS="varname"
>ptr</CODE
> の正当性は呼出側で保証しなければならない。</P
><P
><A
HREF="utk_sm_functions.html#Kfree"
>Kfree</A
> を含むメモリ割当てライブラリのAPIは、タスク独立部およびディスパッチ禁止中、割込み禁止中に呼び出すことはできない。呼び出した場合の動作は、システムダウンの可能性も含めて不定であり、呼出時の状態を保証するのは、呼出側の責任である。</P
></DIV
></DIV
></DIV
></DIV
></DIV
><DIV
CLASS="NAVFOOTER"
><HR
ALIGN="LEFT"
WIDTH="100%"><TABLE
SUMMARY="Footer navigation table"
WIDTH="100%"
BORDER="0"
CELLPADDING="0"
CELLSPACING="0"
><TR
><TD
WIDTH="33%"
ALIGN="left"
VALIGN="top"
><A
HREF="subsystem_management_functions.html"
ACCESSKEY="P"
>前のページ</A
></TD
><TD
WIDTH="34%"
ALIGN="center"
VALIGN="top"
><A
HREF="index.html"
ACCESSKEY="H"
>ホーム</A
></TD
><TD
WIDTH="33%"
ALIGN="right"
VALIGN="top"
><A
HREF="device_management_functions.html"
ACCESSKEY="N"
>次のページ</A
></TD
></TR
><TR
><TD
WIDTH="33%"
ALIGN="left"
VALIGN="top"
>サブシステム管理機能</TD
><TD
WIDTH="34%"
ALIGN="center"
VALIGN="top"
>&nbsp;</TD
><TD
WIDTH="33%"
ALIGN="right"
VALIGN="top"
>デバイス管理機能</TD
></TR
></TABLE
></DIV
></BODY
></HTML
>